
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Laravel: From Zero to Production</title>
            <style>
        @page {
            size: A4;
            margin: 2cm;
            @top-center {
                content: "Laravel: From Zero to Production";
                font-size: 10pt;
                color: #666;
            }
            @bottom-center {
                content: counter(page);
                font-size: 10pt;
                color: #666;
            }
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 100%;
        }
        
        h1 {
            color: #ff2d20;
            border-bottom: 3px solid #ff2d20;
            padding-bottom: 10px;
            page-break-after: avoid;
        }
        
        h2 {
            color: #636b6f;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
            page-break-after: avoid;
        }
        
        h3 {
            color: #495057;
            page-break-after: avoid;
        }
        
        code {
            background-color: #f8f9fa;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        pre {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 15px;
            overflow-x: auto;
            page-break-inside: avoid;
        }
        
        pre code {
            background: none;
            padding: 0;
        }
        
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
            page-break-inside: avoid;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 8px 12px;
            text-align: left;
        }
        
        th {
            background-color: #ff2d20;
            color: white;
            font-weight: bold;
        }
        
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        blockquote {
            border-left: 4px solid #ff2d20;
            margin: 20px 0;
            padding: 10px 20px;
            background-color: #f8f9fa;
            font-style: italic;
        }
        
        .toc {
            page-break-after: always;
        }
        
        .toc h1 {
            text-align: center;
            border: none;
            margin-bottom: 30px;
        }
        
        .toc ul {
            list-style: none;
            padding: 0;
        }
        
        .toc li {
            margin: 10px 0;
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }
        
        .toc a {
            text-decoration: none;
            color: #333;
        }
        
        .chapter {
            page-break-before: always;
        }
        
        .chapter:first-child {
            page-break-before: avoid;
        }
        
        .cover {
            text-align: center;
            page-break-after: always;
        }
        
        .cover h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
            border: none;
        }
        
        .cover .subtitle {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 40px;
        }
        
        .cover .author {
            font-size: 1.1em;
            margin-bottom: 60px;
        }
        
        .cover .date {
            font-size: 1em;
            color: #666;
        }
        </style>
        </head>
        <body>
        
        <div class="cover">
            <h1>Laravel: From Zero to Production</h1>
            <div class="subtitle">A comprehensive guide to building modern web applications with Laravel</div>
            <div class="author">By Laravel Book Team</div>
            <div class="date">Generated on August 21, 2025</div>
        </div>
        
        <div class="toc">
            <h1>Table of Contents</h1>
            <ul>
        <li><a href="#01-introduction.md">01. 01 Introduction</a></li><li><a href="#02-installation.md">02. 02 Installation</a></li><li><a href="#03-routing.md">03. 03 Routing</a></li><li><a href="#04-controllers.md">04. 04 Controllers</a></li><li><a href="#05-blade.md">05. 05 Blade</a></li><li><a href="#06-eloquent.md">06. 06 Eloquent</a></li><li><a href="#07-migrations.md">07. 07 Migrations</a></li><li><a href="#08-middleware.md">08. 08 Middleware</a></li><li><a href="#09-auth.md">09. 09 Auth</a></li><li><a href="#10-events-queues.md">10. 10 Events Queues</a></li><li><a href="#11-testing.md">11. 11 Testing</a></li><li><a href="#12-deployment.md">12. 12 Deployment</a></li><li><a href="#13-caching.md">13. 13 Caching</a></li><li><a href="#14-performance.md">14. 14 Performance</a></li><li><a href="#15-microservices.md">15. 15 Microservices</a></li>
            </ul>
        </div>
        <div class="chapter" id="01-introduction"><h1 id="chapter-1-introduction-to-laravel">Chapter 1: Introduction to Laravel</h1>
<h2 id="what-is-laravel">What is Laravel?</h2>
<p>Laravel is a free, open-source PHP web application framework designed to make the development process more enjoyable for developers by taking care of common tasks used in many web projects. Created by Taylor Otwell in 2011, Laravel has grown to become one of the most popular PHP frameworks in the world.</p>
<h2 id="why-choose-laravel">Why Choose Laravel?</h2>
<h3 id="1-elegant-syntax">1. <strong>Elegant Syntax</strong></h3>
<p>Laravel provides a clean, expressive syntax that makes your code readable and maintainable. The framework follows the "Convention over Configuration" principle, reducing the amount of code you need to write.</p>
<h3 id="2-rich-ecosystem">2. <strong>Rich Ecosystem</strong></h3>
<p>Laravel comes with a comprehensive set of tools and libraries:
- <strong>Artisan CLI</strong>: Command-line interface for common tasks
- <strong>Eloquent ORM</strong>: Powerful database abstraction layer
- <strong>Blade Templating</strong>: Lightweight, powerful templating engine
- <strong>Built-in Authentication</strong>: Ready-to-use authentication system
- <strong>Queue System</strong>: Background job processing
- <strong>Task Scheduling</strong>: Automated task execution
- <strong>Testing Tools</strong>: Built-in testing support</p>
<h3 id="3-security-features">3. <strong>Security Features</strong></h3>
<p>Laravel includes several security features out of the box:
- <strong>CSRF Protection</strong>: Cross-site request forgery protection
- <strong>SQL Injection Prevention</strong>: Parameterized queries
- <strong>XSS Protection</strong>: Cross-site scripting protection
- <strong>Authentication &amp; Authorization</strong>: Secure user management</p>
<h3 id="4-performance">4. <strong>Performance</strong></h3>
<p>Laravel is designed for performance with features like:
- <strong>Route Caching</strong>: Faster route resolution
- <strong>View Caching</strong>: Compiled Blade templates
- <strong>Configuration Caching</strong>: Optimized configuration loading
- <strong>Database Query Optimization</strong>: Efficient database operations</p>
<h2 id="laravel-philosophy">Laravel Philosophy</h2>
<p>Laravel follows several key principles:</p>
<h3 id="1-convention-over-configuration">1. <strong>Convention over Configuration</strong></h3>
<p>Laravel provides sensible defaults and conventions that reduce the need for configuration files. This allows you to focus on building your application rather than setting up boilerplate code.</p>
<h3 id="2-dont-repeat-yourself-dry">2. <strong>Don't Repeat Yourself (DRY)</strong></h3>
<p>Laravel encourages code reuse through features like:
- <strong>Service Providers</strong>: Dependency injection and service registration
- <strong>Middleware</strong>: Reusable request/response filters
- <strong>Traits</strong>: Code sharing between classes
- <strong>Macros</strong>: Extending framework classes</p>
<h3 id="3-progressive-enhancement">3. <strong>Progressive Enhancement</strong></h3>
<p>Laravel can be as simple or complex as your project requires. You can start with basic features and gradually add more advanced functionality as your application grows.</p>
<h2 id="laravel-ecosystem">Laravel Ecosystem</h2>
<h3 id="core-framework">Core Framework</h3>
<ul>
<li><strong>Laravel Framework</strong>: The main framework</li>
<li><strong>Laravel Sanctum</strong>: API authentication</li>
<li><strong>Laravel Passport</strong>: OAuth2 server</li>
<li><strong>Laravel Horizon</strong>: Redis queue monitoring</li>
</ul>
<h3 id="official-packages">Official Packages</h3>
<ul>
<li><strong>Laravel Breeze</strong>: Simple authentication scaffolding</li>
<li><strong>Laravel Jetstream</strong>: Advanced authentication scaffolding</li>
<li><strong>Laravel Fortify</strong>: Backend authentication services</li>
<li><strong>Laravel Cashier</strong>: Stripe subscription billing</li>
<li><strong>Laravel Scout</strong>: Full-text search</li>
<li><strong>Laravel Socialite</strong>: Social media authentication</li>
</ul>
<h3 id="community-packages">Community Packages</h3>
<p>The Laravel community has created thousands of packages available through Composer, covering everything from payment processing to image manipulation.</p>
<h2 id="laravel-version-history">Laravel Version History</h2>
<h3 id="laravel-10-current">Laravel 10 (Current)</h3>
<ul>
<li>Released: February 2023</li>
<li>PHP 8.1+ required</li>
<li>Improved performance and developer experience</li>
<li>Enhanced testing capabilities</li>
</ul>
<h3 id="laravel-9">Laravel 9</h3>
<ul>
<li>Released: February 2022</li>
<li>PHP 8.0+ required</li>
<li>Improved error handling</li>
<li>Enhanced database features</li>
</ul>
<h3 id="laravel-8">Laravel 8</h3>
<ul>
<li>Released: September 2020</li>
<li>Model factory improvements</li>
<li>Job batching</li>
<li>Rate limiting enhancements</li>
</ul>
<h2 id="getting-started-with-laravel">Getting Started with Laravel</h2>
<h3 id="prerequisites">Prerequisites</h3>
<p>Before you can use Laravel, you need to have the following installed on your machine:
- <strong>PHP 8.1 or higher</strong>
- <strong>Composer</strong> (PHP package manager)
- <strong>Node.js &amp; NPM</strong> (for frontend assets)
- <strong>Database</strong> (MySQL, PostgreSQL, SQLite, etc.)</p>
<h3 id="installation-methods">Installation Methods</h3>
<ol>
<li>
<p><strong>Laravel Installer</strong> (Recommended)
   <code>bash
   composer global require laravel/installer
   laravel new my-project</code></p>
</li>
<li>
<p><strong>Composer Create-Project</strong>
   <code>bash
   composer create-project laravel/laravel my-project</code></p>
</li>
</ol>
<h3 id="first-steps">First Steps</h3>
<p>After installation:
1. <strong>Configure Environment</strong>
   <code>bash
   cp .env.example .env
   php artisan key:generate</code></p>
<ol>
<li>
<p><strong>Start Development Server</strong>
   <code>bash
   php artisan serve</code></p>
</li>
<li>
<p><strong>Visit Your Application</strong>
   Open your browser and navigate to <code>http://localhost:8000</code></p>
</li>
</ol>
<h2 id="what-youll-learn-in-this-book">What You'll Learn in This Book</h2>
<p>This book will take you from complete beginner to building production-ready Laravel applications. Here's what we'll cover:</p>
<h3 id="part-i-fundamentals">Part I: Fundamentals</h3>
<ul>
<li><strong>Installation &amp; Setup</strong>: Getting Laravel running on your machine</li>
<li><strong>Routing</strong>: Defining how your application responds to HTTP requests</li>
<li><strong>Controllers</strong>: Organizing your application logic</li>
<li><strong>Blade Templates</strong>: Creating dynamic views</li>
<li><strong>Eloquent ORM</strong>: Working with databases</li>
<li><strong>Migrations</strong>: Managing database schema changes</li>
</ul>
<h3 id="part-ii-building-applications">Part II: Building Applications</h3>
<ul>
<li><strong>Middleware</strong>: Filtering HTTP requests</li>
<li><strong>Authentication</strong>: User management and security</li>
<li><strong>Events &amp; Queues</strong>: Asynchronous processing</li>
<li><strong>Testing</strong>: Ensuring your code works correctly</li>
<li><strong>Deployment</strong>: Getting your application online</li>
</ul>
<h3 id="part-iii-projects">Part III: Projects</h3>
<ul>
<li><strong>Todo App</strong>: Basic CRUD operations</li>
<li><strong>Blog Platform</strong>: Content management with authentication</li>
<li><strong>Shop Application</strong>: E-commerce functionality</li>
<li><strong>REST API</strong>: Building APIs for mobile/web clients</li>
<li><strong>Wizard Form</strong>: Multi-step form processing</li>
</ul>
<h2 id="best-practices">Best Practices</h2>
<p>Throughout this book, we'll follow Laravel best practices:</p>
<ol>
<li><strong>Use Laravel Conventions</strong>: Follow naming conventions and directory structure</li>
<li><strong>Write Clean Code</strong>: Use meaningful names and proper documentation</li>
<li><strong>Test Your Code</strong>: Write tests for your features</li>
<li><strong>Security First</strong>: Always validate and sanitize user input</li>
<li><strong>Performance Matters</strong>: Optimize database queries and use caching</li>
<li><strong>Keep It Simple</strong>: Don't over-engineer solutions</li>
</ol>
<h2 id="community-and-resources">Community and Resources</h2>
<h3 id="official-resources">Official Resources</h3>
<ul>
<li><strong>Documentation</strong>: <a href="https://laravel.com/docs">laravel.com/docs</a></li>
<li><strong>Laracasts</strong>: Video tutorials by Jeffrey Way</li>
<li><strong>Laravel News</strong>: Latest Laravel updates and articles</li>
<li><strong>GitHub</strong>: <a href="https://github.com/laravel/laravel">github.com/laravel/laravel</a></li>
</ul>
<h3 id="community-resources">Community Resources</h3>
<ul>
<li><strong>Laravel Forge</strong>: Server management and deployment</li>
<li><strong>Laravel Vapor</strong>: Serverless deployment platform</li>
<li><strong>Laravel Nova</strong>: Admin panel for Laravel applications</li>
<li><strong>Laravel Spark</strong>: SaaS application scaffolding</li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>Laravel is a powerful, elegant framework that makes web development enjoyable and efficient. Whether you're building a simple blog or a complex enterprise application, Laravel provides the tools and structure you need to succeed.</p>
<p>In the next chapter, we'll dive into the installation process and get your first Laravel application running. Let's begin this exciting journey into Laravel development!</p></div><div class="chapter" id="02-installation"><h1 id="chapter-2-installation-and-setup">Chapter 2: Installation and Setup</h1>
<h2 id="prerequisites">Prerequisites</h2>
<p>Before installing Laravel, you need to ensure your development environment meets the following requirements:</p>
<h3 id="system-requirements">System Requirements</h3>
<h4 id="php-requirements">PHP Requirements</h4>
<ul>
<li><strong>PHP 8.1 or higher</strong></li>
<li><strong>Required PHP Extensions</strong>:</li>
<li>BCMath PHP Extension</li>
<li>Ctype PHP Extension</li>
<li>cURL PHP Extension</li>
<li>DOM PHP Extension</li>
<li>Fileinfo PHP Extension</li>
<li>JSON PHP Extension</li>
<li>Mbstring PHP Extension</li>
<li>OpenSSL PHP Extension</li>
<li>PCRE PHP Extension</li>
<li>PDO PHP Extension</li>
<li>Tokenizer PHP Extension</li>
<li>XML PHP Extension</li>
</ul>
<h4 id="additional-software">Additional Software</h4>
<ul>
<li><strong>Composer</strong> (PHP package manager)</li>
<li><strong>Node.js &amp; NPM</strong> (for frontend asset compilation)</li>
<li><strong>Database</strong> (MySQL, PostgreSQL, SQLite, or SQL Server)</li>
<li><strong>Web Server</strong> (Apache, Nginx, or Laravel's built-in server)</li>
</ul>
<h2 id="installing-prerequisites">Installing Prerequisites</h2>
<h3 id="1-installing-php">1. Installing PHP</h3>
<h4 id="on-windows">On Windows</h4>
<ol>
<li><strong>Download XAMPP or WAMP</strong>:</li>
<li>XAMPP: <a href="https://www.apachefriends.org/">apachefriends.org</a></li>
<li>
<p>WAMP: <a href="https://www.wampserver.com/">wampserver.com</a></p>
</li>
<li>
<p><strong>Or use Chocolatey</strong>:
   <code>bash
   choco install php</code></p>
</li>
</ol>
<h4 id="on-macos">On macOS</h4>
<ol>
<li>
<p><strong>Using Homebrew</strong>:
   <code>bash
   brew install php</code></p>
</li>
<li>
<p><strong>Using MAMP</strong>:</p>
</li>
<li>Download from <a href="https://www.mamp.info/">mamp.info</a></li>
</ol>
<h4 id="on-linux-ubuntudebian">On Linux (Ubuntu/Debian)</h4>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>apt<span class="w"> </span>update
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>php8.1<span class="w"> </span>php8.1-cli<span class="w"> </span>php8.1-common<span class="w"> </span>php8.1-mysql<span class="w"> </span>php8.1-zip<span class="w"> </span>php8.1-gd<span class="w"> </span>php8.1-mbstring<span class="w"> </span>php8.1-curl<span class="w"> </span>php8.1-xml<span class="w"> </span>php8.1-bcmath
</code></pre></div>

<h4 id="on-linux-centosrhel">On Linux (CentOS/RHEL)</h4>
<div class="codehilite"><pre><span></span><code>sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>epel-release
sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>php<span class="w"> </span>php-cli<span class="w"> </span>php-common<span class="w"> </span>php-mysql<span class="w"> </span>php-zip<span class="w"> </span>php-gd<span class="w"> </span>php-mbstring<span class="w"> </span>php-curl<span class="w"> </span>php-xml<span class="w"> </span>php-bcmath
</code></pre></div>

<h3 id="2-installing-composer">2. Installing Composer</h3>
<h4 id="on-windows_1">On Windows</h4>
<ol>
<li><strong>Download Composer-Setup.exe</strong> from <a href="https://getcomposer.org/download/">getcomposer.org</a></li>
<li>Run the installer and follow the setup wizard</li>
</ol>
<h4 id="on-macoslinux">On macOS/Linux</h4>
<div class="codehilite"><pre><span></span><code>curl<span class="w"> </span>-sS<span class="w"> </span>https://getcomposer.org/installer<span class="w"> </span><span class="p">|</span><span class="w"> </span>php
sudo<span class="w"> </span>mv<span class="w"> </span>composer.phar<span class="w"> </span>/usr/local/bin/composer
</code></pre></div>

<h3 id="3-installing-nodejs">3. Installing Node.js</h3>
<h4 id="on-windows_2">On Windows</h4>
<ol>
<li>Download from <a href="https://nodejs.org/">nodejs.org</a></li>
<li>Run the installer</li>
</ol>
<h4 id="on-macos_1">On macOS</h4>
<div class="codehilite"><pre><span></span><code>brew<span class="w"> </span>install<span class="w"> </span>node
</code></pre></div>

<h4 id="on-linux">On Linux</h4>
<div class="codehilite"><pre><span></span><code>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://deb.nodesource.com/setup_lts.x<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>-E<span class="w"> </span>bash<span class="w"> </span>-
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>nodejs
</code></pre></div>

<h2 id="installing-laravel">Installing Laravel</h2>
<h3 id="method-1-using-laravel-installer-recommended">Method 1: Using Laravel Installer (Recommended)</h3>
<p>The Laravel installer is the easiest way to create new Laravel projects.</p>
<h4 id="1-install-laravel-installer">1. Install Laravel Installer</h4>
<div class="codehilite"><pre><span></span><code>composer<span class="w"> </span>global<span class="w"> </span>require<span class="w"> </span>laravel/installer
</code></pre></div>

<h4 id="2-create-a-new-project">2. Create a New Project</h4>
<div class="codehilite"><pre><span></span><code>laravel<span class="w"> </span>new<span class="w"> </span>my-project
<span class="nb">cd</span><span class="w"> </span>my-project
</code></pre></div>

<h3 id="method-2-using-composer-create-project">Method 2: Using Composer Create-Project</h3>
<p>If you prefer not to install the Laravel installer globally:</p>
<div class="codehilite"><pre><span></span><code>composer<span class="w"> </span>create-project<span class="w"> </span>laravel/laravel<span class="w"> </span>my-project
<span class="nb">cd</span><span class="w"> </span>my-project
</code></pre></div>

<h3 id="method-3-using-laravel-sail-docker">Method 3: Using Laravel Sail (Docker)</h3>
<p>Laravel Sail provides a Docker-based development environment:</p>
<div class="codehilite"><pre><span></span><code>curl<span class="w"> </span>-s<span class="w"> </span><span class="s2">&quot;https://laravel.build/my-project&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>bash
<span class="nb">cd</span><span class="w"> </span>my-project
./vendor/bin/sail<span class="w"> </span>up
</code></pre></div>

<h2 id="project-setup">Project Setup</h2>
<h3 id="1-environment-configuration">1. Environment Configuration</h3>
<p>After creating your Laravel project, you need to configure the environment:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Copy the environment file</span>
cp<span class="w"> </span>.env.example<span class="w"> </span>.env

<span class="c1"># Generate application key</span>
php<span class="w"> </span>artisan<span class="w"> </span>key:generate
</code></pre></div>

<h3 id="2-database-configuration">2. Database Configuration</h3>
<p>Edit the <code>.env</code> file to configure your database:</p>
<div class="codehilite"><pre><span></span><code>DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=laravel
DB_USERNAME=root
DB_PASSWORD=
</code></pre></div>

<h3 id="3-install-dependencies">3. Install Dependencies</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Install PHP dependencies</span>
composer<span class="w"> </span>install

<span class="c1"># Install Node.js dependencies (if using frontend assets)</span>
npm<span class="w"> </span>install
</code></pre></div>

<h3 id="4-run-migrations">4. Run Migrations</h3>
<div class="codehilite"><pre><span></span><code>php<span class="w"> </span>artisan<span class="w"> </span>migrate
</code></pre></div>

<h2 id="development-server">Development Server</h2>
<h3 id="using-laravels-built-in-server">Using Laravel's Built-in Server</h3>
<p>Laravel includes a development server for local development:</p>
<div class="codehilite"><pre><span></span><code>php<span class="w"> </span>artisan<span class="w"> </span>serve
</code></pre></div>

<p>This will start the server at <code>http://localhost:8000</code></p>
<h3 id="using-laravel-sail-docker">Using Laravel Sail (Docker)</h3>
<p>If you're using Laravel Sail:</p>
<div class="codehilite"><pre><span></span><code>./vendor/bin/sail<span class="w"> </span>up
</code></pre></div>

<h3 id="using-other-web-servers">Using Other Web Servers</h3>
<h4 id="apache-configuration">Apache Configuration</h4>
<p>Create a virtual host configuration:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">&lt;VirtualHost</span><span class="w"> </span><span class="s">*:80</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nb">ServerName</span><span class="w"> </span>my-project.local
<span class="w">    </span><span class="nb">DocumentRoot</span><span class="w"> </span><span class="sx">/path/to/my-project/public</span>

<span class="w">    </span><span class="nt">&lt;Directory</span><span class="w"> </span><span class="s">/path/to/my-project/public</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nb">AllowOverride</span><span class="w"> </span><span class="k">All</span>
<span class="w">        </span><span class="nb">Require</span><span class="w"> </span><span class="k">all</span><span class="w"> </span>granted
<span class="w">    </span><span class="nt">&lt;/Directory&gt;</span>
<span class="nt">&lt;/VirtualHost&gt;</span>
</code></pre></div>

<h4 id="nginx-configuration">Nginx Configuration</h4>
<div class="codehilite"><pre><span></span><code><span class="k">server</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">listen</span><span class="w"> </span><span class="mi">80</span><span class="p">;</span>
<span class="w">    </span><span class="kn">server_name</span><span class="w"> </span><span class="s">my-project.local</span><span class="p">;</span>
<span class="w">    </span><span class="kn">root</span><span class="w"> </span><span class="s">/path/to/my-project/public</span><span class="p">;</span>

<span class="w">    </span><span class="kn">add_header</span><span class="w"> </span><span class="s">X-Frame-Options</span><span class="w"> </span><span class="s">&quot;SAMEORIGIN&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="kn">add_header</span><span class="w"> </span><span class="s">X-Content-Type-Options</span><span class="w"> </span><span class="s">&quot;nosniff&quot;</span><span class="p">;</span>

<span class="w">    </span><span class="kn">index</span><span class="w"> </span><span class="s">index.php</span><span class="p">;</span>

<span class="w">    </span><span class="kn">charset</span><span class="w"> </span><span class="s">utf-8</span><span class="p">;</span>

<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">try_files</span><span class="w"> </span><span class="nv">$uri</span><span class="w"> </span><span class="nv">$uri/</span><span class="w"> </span><span class="s">/index.php?</span><span class="nv">$query_string</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">/favicon.ico</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kn">access_log</span><span class="w"> </span><span class="no">off</span><span class="p">;</span><span class="w"> </span><span class="kn">log_not_found</span><span class="w"> </span><span class="no">off</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">/robots.txt</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="kn">access_log</span><span class="w"> </span><span class="no">off</span><span class="p">;</span><span class="w"> </span><span class="kn">log_not_found</span><span class="w"> </span><span class="no">off</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kn">error_page</span><span class="w"> </span><span class="mi">404</span><span class="w"> </span><span class="s">/index.php</span><span class="p">;</span>

<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="p">~</span><span class="w"> </span><span class="sr">\.php$</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">fastcgi_pass</span><span class="w"> </span><span class="s">unix:/var/run/php/php8.1-fpm.sock</span><span class="p">;</span>
<span class="w">        </span><span class="kn">fastcgi_param</span><span class="w"> </span><span class="s">SCRIPT_FILENAME</span><span class="w"> </span><span class="nv">$realpath_root$fastcgi_script_name</span><span class="p">;</span>
<span class="w">        </span><span class="kn">include</span><span class="w"> </span><span class="s">fastcgi_params</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="p">~</span><span class="w"> </span><span class="sr">/\.(?!well-known).*</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">deny</span><span class="w"> </span><span class="s">all</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="ide-setup">IDE Setup</h2>
<h3 id="recommended-ides">Recommended IDEs</h3>
<ol>
<li><strong>PhpStorm</strong> (JetBrains)</li>
<li>Full Laravel support</li>
<li>Built-in debugging</li>
<li>
<p>Code completion</p>
</li>
<li>
<p><strong>Visual Studio Code</strong></p>
</li>
<li>Free and lightweight</li>
<li>Excellent Laravel extensions</li>
<li>
<p>Integrated terminal</p>
</li>
<li>
<p><strong>Sublime Text</strong></p>
</li>
<li>Fast and lightweight</li>
<li>Extensive plugin ecosystem</li>
</ol>
<h3 id="useful-extensions-for-vs-code">Useful Extensions for VS Code</h3>
<ul>
<li><strong>Laravel Extension Pack</strong></li>
<li><strong>PHP Intelephense</strong></li>
<li><strong>Laravel Blade Snippets</strong></li>
<li><strong>Laravel Artisan</strong></li>
<li><strong>Laravel Snippets</strong></li>
</ul>
<h2 id="project-structure">Project Structure</h2>
<p>After installation, your Laravel project will have the following structure:</p>
<div class="codehilite"><pre><span></span><code><span class="n">my</span><span class="o">-</span><span class="n">project</span><span class="o">/</span>
<span class="err">├──</span><span class="w"> </span><span class="n">app</span><span class="o">/</span><span class="w">                    </span><span class="c1"># Application core code</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">Console</span><span class="o">/</span><span class="w">           </span><span class="c1"># Artisan commands</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">Exceptions</span><span class="o">/</span><span class="w">        </span><span class="c1"># Exception handlers</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">Http</span><span class="o">/</span><span class="w">              </span><span class="c1"># HTTP layer</span>
<span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">Controllers</span><span class="o">/</span><span class="w">   </span><span class="c1"># Controllers</span>
<span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">Middleware</span><span class="o">/</span><span class="w">    </span><span class="c1"># Middleware</span>
<span class="err">│</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="err">└──</span><span class="w"> </span><span class="n">Requests</span><span class="o">/</span><span class="w">      </span><span class="c1"># Form requests</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">Models</span><span class="o">/</span><span class="w">            </span><span class="c1"># Eloquent models</span>
<span class="err">│</span><span class="w">   </span><span class="err">└──</span><span class="w"> </span><span class="n">Providers</span><span class="o">/</span><span class="w">         </span><span class="c1"># Service providers</span>
<span class="err">├──</span><span class="w"> </span><span class="n">bootstrap</span><span class="o">/</span><span class="w">             </span><span class="c1"># Framework bootstrap files</span>
<span class="err">├──</span><span class="w"> </span><span class="n">config</span><span class="o">/</span><span class="w">                </span><span class="c1"># Configuration files</span>
<span class="err">├──</span><span class="w"> </span><span class="n">database</span><span class="o">/</span><span class="w">              </span><span class="c1"># Database files</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">factories</span><span class="o">/</span><span class="w">         </span><span class="c1"># Model factories</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">migrations</span><span class="o">/</span><span class="w">        </span><span class="c1"># Database migrations</span>
<span class="err">│</span><span class="w">   </span><span class="err">└──</span><span class="w"> </span><span class="n">seeders</span><span class="o">/</span><span class="w">           </span><span class="c1"># Database seeders</span>
<span class="err">├──</span><span class="w"> </span><span class="n">public</span><span class="o">/</span><span class="w">                </span><span class="c1"># Web server document root</span>
<span class="err">├──</span><span class="w"> </span><span class="n">resources</span><span class="o">/</span><span class="w">             </span><span class="c1"># Application resources</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">css</span><span class="o">/</span><span class="w">              </span><span class="c1"># CSS files</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">js</span><span class="o">/</span><span class="w">               </span><span class="c1"># JavaScript files</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">lang</span><span class="o">/</span><span class="w">             </span><span class="c1"># Language files</span>
<span class="err">│</span><span class="w">   </span><span class="err">└──</span><span class="w"> </span><span class="n">views</span><span class="o">/</span><span class="w">            </span><span class="c1"># Blade templates</span>
<span class="err">├──</span><span class="w"> </span><span class="n">routes</span><span class="o">/</span><span class="w">                </span><span class="c1"># Route definitions</span>
<span class="err">├──</span><span class="w"> </span><span class="n">storage</span><span class="o">/</span><span class="w">               </span><span class="c1"># Application storage</span>
<span class="err">├──</span><span class="w"> </span><span class="n">tests</span><span class="o">/</span><span class="w">                 </span><span class="c1"># Test files</span>
<span class="err">├──</span><span class="w"> </span><span class="n">vendor</span><span class="o">/</span><span class="w">                </span><span class="c1"># Composer dependencies</span>
<span class="err">├──</span><span class="w"> </span><span class="o">.</span><span class="n">env</span><span class="w">                   </span><span class="c1"># Environment variables</span>
<span class="err">├──</span><span class="w"> </span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">example</span><span class="w">          </span><span class="c1"># Environment template</span>
<span class="err">├──</span><span class="w"> </span><span class="o">.</span><span class="n">gitignore</span><span class="w">            </span><span class="c1"># Git ignore file</span>
<span class="err">├──</span><span class="w"> </span><span class="n">artisan</span><span class="w">               </span><span class="c1"># Artisan command-line tool</span>
<span class="err">├──</span><span class="w"> </span><span class="n">composer</span><span class="o">.</span><span class="n">json</span><span class="w">         </span><span class="c1"># Composer configuration</span>
<span class="err">└──</span><span class="w"> </span><span class="n">package</span><span class="o">.</span><span class="n">json</span><span class="w">          </span><span class="c1"># NPM configuration</span>
</code></pre></div>

<h2 id="common-issues-and-solutions">Common Issues and Solutions</h2>
<h3 id="1-permission-issues">1. Permission Issues</h3>
<h4 id="on-linuxmacos">On Linux/macOS</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Set proper permissions</span>
chmod<span class="w"> </span>-R<span class="w"> </span><span class="m">755</span><span class="w"> </span>storage<span class="w"> </span>bootstrap/cache
chown<span class="w"> </span>-R<span class="w"> </span>www-data:www-data<span class="w"> </span>storage<span class="w"> </span>bootstrap/cache
</code></pre></div>

<h4 id="on-windows_3">On Windows</h4>
<p>Ensure your web server has write permissions to the <code>storage</code> and <code>bootstrap/cache</code> directories.</p>
<h3 id="2-composer-memory-limit">2. Composer Memory Limit</h3>
<p>If you encounter memory issues during installation:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Increase PHP memory limit</span>
php<span class="w"> </span>-d<span class="w"> </span><span class="nv">memory_limit</span><span class="o">=</span>-1<span class="w"> </span>composer<span class="w"> </span>install
</code></pre></div>

<h3 id="3-ssl-certificate-issues">3. SSL Certificate Issues</h3>
<p>For local development, you can ignore SSL certificate issues:</p>
<div class="codehilite"><pre><span></span><code>composer<span class="w"> </span>config<span class="w"> </span>--global<span class="w"> </span>disable-tls<span class="w"> </span><span class="nb">true</span>
</code></pre></div>

<h3 id="4-extension-missing">4. Extension Missing</h3>
<p>If you get an error about a missing PHP extension:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># On Ubuntu/Debian</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>php8.1-<span class="o">[</span>extension-name<span class="o">]</span>

<span class="c1"># On CentOS/RHEL</span>
sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>php-<span class="o">[</span>extension-name<span class="o">]</span>
</code></pre></div>

<h2 id="verification">Verification</h2>
<p>To verify your installation is working correctly:</p>
<ol>
<li>
<p><strong>Start the development server</strong>:
   <code>bash
   php artisan serve</code></p>
</li>
<li>
<p><strong>Visit your application</strong>:
   Open your browser and navigate to <code>http://localhost:8000</code></p>
</li>
<li>
<p><strong>Check Laravel version</strong>:
   <code>bash
   php artisan --version</code></p>
</li>
<li>
<p><strong>Run health check</strong>:
   <code>bash
   php artisan about</code></p>
</li>
</ol>
<h2 id="next-steps">Next Steps</h2>
<p>Now that you have Laravel installed and running, you're ready to start building your first application. In the next chapter, we'll explore Laravel's routing system and learn how to define the URLs that your application will respond to.</p>
<h2 id="summary">Summary</h2>
<p>In this chapter, we covered:</p>
<ul>
<li>✅ Installing PHP and required extensions</li>
<li>✅ Installing Composer and Node.js</li>
<li>✅ Creating a new Laravel project</li>
<li>✅ Configuring the environment</li>
<li>✅ Setting up the development server</li>
<li>✅ Understanding the project structure</li>
<li>✅ Troubleshooting common issues</li>
</ul>
<p>Your Laravel development environment is now ready! Let's move on to learning about routing in the next chapter.</p></div><div class="chapter" id="03-routing"><h1 id="routing">Routing</h1>
<h2 id="overview">Overview</h2>
<p>Routing is the foundation of any web application. In Laravel, routes define how your application responds to HTTP requests. This chapter covers everything you need to know about Laravel's powerful routing system.</p>
<h2 id="what-is-routing">What is Routing?</h2>
<p>Routing is the process of defining how your application responds to different HTTP requests. When a user visits a URL, Laravel's router determines which controller method should handle that request.</p>
<h2 id="basic-routes">Basic Routes</h2>
<h3 id="defining-routes">Defining Routes</h3>
<p>Routes are defined in the <code>routes</code> directory. The main file is <code>routes/web.php</code> for web routes and <code>routes/api.php</code> for API routes.</p>
<p><strong>routes/web.php</strong></p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Route</span><span class="p">;</span>

<span class="c1">// Basic GET route</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;Hello, World!&#39;</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// Basic POST route</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;/submit&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;Form submitted!&#39;</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// Multiple HTTP methods</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">match</span><span class="p">([</span><span class="s1">&#39;get&#39;</span><span class="p">,</span> <span class="s1">&#39;post&#39;</span><span class="p">],</span> <span class="s1">&#39;/contact&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;Contact page&#39;</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// Any HTTP method</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">any</span><span class="p">(</span><span class="s1">&#39;/any&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;Any method accepted&#39;</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div>

<h3 id="http-methods">HTTP Methods</h3>
<p>Laravel supports all standard HTTP methods:</p>
<div class="codehilite"><pre><span></span><code><span class="x">Route::get($uri, $callback);</span>
<span class="x">Route::post($uri, $callback);</span>
<span class="x">Route::put($uri, $callback);</span>
<span class="x">Route::patch($uri, $callback);</span>
<span class="x">Route::delete($uri, $callback);</span>
<span class="x">Route::options($uri, $callback);</span>
</code></pre></div>

<h3 id="route-parameters">Route Parameters</h3>
<p>You can capture URL segments as parameters:</p>
<div class="codehilite"><pre><span></span><code><span class="x">// Single parameter</span>
<span class="x">Route::get(&#39;/user/{id}&#39;, function ($id) {</span>
<span class="x">    return &quot;User ID: {$id}&quot;;</span>
<span class="x">});</span>

<span class="x">// Multiple parameters</span>
<span class="x">Route::get(&#39;/posts/{post}/comments/{comment}&#39;, function ($post, $comment) {</span>
<span class="x">    return &quot;Post: {$post}, Comment: {$comment}&quot;;</span>
<span class="x">});</span>

<span class="x">// Optional parameters</span>
<span class="x">Route::get(&#39;/user/{name?}&#39;, function ($name = &#39;Guest&#39;) {</span>
<span class="x">    return &quot;Hello, {$name}!&quot;;</span>
<span class="x">});</span>
</code></pre></div>

<h3 id="route-parameters-with-constraints">Route Parameters with Constraints</h3>
<p>You can add constraints to ensure parameters match specific patterns:</p>
<div class="codehilite"><pre><span></span><code><span class="x">// Numeric constraint</span>
<span class="x">Route::get(&#39;/user/{id}&#39;, function ($id) {</span>
<span class="x">    return &quot;User ID: {$id}&quot;;</span>
<span class="x">})-&gt;where(&#39;id&#39;, &#39;[0-9]+&#39;);</span>

<span class="x">// Alpha constraint</span>
<span class="x">Route::get(&#39;/user/{name}&#39;, function ($name) {</span>
<span class="x">    return &quot;User: {$name}&quot;;</span>
<span class="x">})-&gt;where(&#39;name&#39;, &#39;[a-zA-Z]+&#39;);</span>

<span class="x">// Multiple constraints</span>
<span class="x">Route::get(&#39;/user/{id}/{name}&#39;, function ($id, $name) {</span>
<span class="x">    return &quot;User ID: {$id}, Name: {$name}&quot;;</span>
<span class="x">})-&gt;where([&#39;id&#39; =&gt; &#39;[0-9]+&#39;, &#39;name&#39; =&gt; &#39;[a-zA-Z]+&#39;]);</span>

<span class="x">// Using whereNumber, whereAlpha, etc.</span>
<span class="x">Route::get(&#39;/user/{id}&#39;, function ($id) {</span>
<span class="x">    return &quot;User ID: {$id}&quot;;</span>
<span class="x">})-&gt;whereNumber(&#39;id&#39;);</span>

<span class="x">Route::get(&#39;/user/{name}&#39;, function ($name) {</span>
<span class="x">    return &quot;User: {$name}&quot;;</span>
<span class="x">})-&gt;whereAlpha(&#39;name&#39;);</span>

<span class="x">Route::get(&#39;/user/{id}/{slug}&#39;, function ($id, $slug) {</span>
<span class="x">    return &quot;User ID: {$id}, Slug: {$slug}&quot;;</span>
<span class="x">})-&gt;whereNumber(&#39;id&#39;)-&gt;whereAlphaNumeric(&#39;slug&#39;);</span>
</code></pre></div>

<h2 id="named-routes">Named Routes</h2>
<p>Named routes allow you to generate URLs without hardcoding them:</p>
<div class="codehilite"><pre><span></span><code><span class="x">// Define a named route</span>
<span class="x">Route::get(&#39;/user/profile&#39;, function () {</span>
<span class="x">    return &#39;User Profile&#39;;</span>
<span class="x">})-&gt;name(&#39;profile&#39;);</span>

<span class="x">// Generate URL using route name</span>
<span class="x">$url = route(&#39;profile&#39;); // /user/profile</span>

<span class="x">// Generate URL with parameters</span>
<span class="x">Route::get(&#39;/user/{id}&#39;, function ($id) {</span>
<span class="x">    return &quot;User ID: {$id}&quot;;</span>
<span class="x">})-&gt;name(&#39;user.show&#39;);</span>

<span class="x">$url = route(&#39;user.show&#39;, [&#39;id&#39; =&gt; 123]); // /user/123</span>

<span class="x">// Generate URL with query parameters</span>
<span class="x">$url = route(&#39;user.show&#39;, [&#39;id&#39; =&gt; 123, &#39;tab&#39; =&gt; &#39;settings&#39;]); // /user/123?tab=settings</span>
</code></pre></div>

<h3 id="using-named-routes-in-views">Using Named Routes in Views</h3>
<div class="codehilite"><pre><span></span><code><span class="x">&lt;!-- In Blade templates --&gt;</span>
<span class="x">&lt;a href=&quot;{{ route(&#39;profile&#39;) }}&quot;&gt;Profile&lt;/a&gt;</span>
<span class="x">&lt;a href=&quot;{{ route(&#39;user.show&#39;, [&#39;id&#39; =&gt; $user-&gt;id]) }}&quot;&gt;View User&lt;/a&gt;</span>

<span class="x">&lt;!-- In forms --&gt;</span>
<span class="x">&lt;form action=&quot;{{ route(&#39;user.update&#39;, [&#39;id&#39; =&gt; $user-&gt;id]) }}&quot; method=&quot;POST&quot;&gt;</span>
<span class="x">    @csrf</span>
<span class="x">    @method(&#39;PUT&#39;)</span>
<span class="x">    &lt;!-- form fields --&gt;</span>
<span class="x">&lt;/form&gt;</span>
</code></pre></div>

<h2 id="route-groups">Route Groups</h2>
<p>Route groups allow you to apply common attributes to multiple routes:</p>
<h3 id="prefix-groups">Prefix Groups</h3>
<div class="codehilite"><pre><span></span><code><span class="x">Route::prefix(&#39;admin&#39;)-&gt;group(function () {</span>
<span class="x">    Route::get(&#39;/users&#39;, function () {</span>
<span class="x">        return &#39;Admin Users&#39;;</span>
<span class="x">    });</span>

<span class="x">    Route::get(&#39;/posts&#39;, function () {</span>
<span class="x">        return &#39;Admin Posts&#39;;</span>
<span class="x">    });</span>
<span class="x">});</span>

<span class="x">// These routes will be accessible at:</span>
<span class="x">// /admin/users</span>
<span class="x">// /admin/posts</span>
</code></pre></div>

<h3 id="middleware-groups">Middleware Groups</h3>
<div class="codehilite"><pre><span></span><code><span class="x">Route::middleware([&#39;auth&#39;, &#39;admin&#39;])-&gt;group(function () {</span>
<span class="x">    Route::get(&#39;/dashboard&#39;, function () {</span>
<span class="x">        return &#39;Admin Dashboard&#39;;</span>
<span class="x">    });</span>

<span class="x">    Route::get(&#39;/settings&#39;, function () {</span>
<span class="x">        return &#39;Admin Settings&#39;;</span>
<span class="x">    });</span>
<span class="x">});</span>
</code></pre></div>

<h3 id="name-prefix-groups">Name Prefix Groups</h3>
<div class="codehilite"><pre><span></span><code><span class="x">Route::name(&#39;admin.&#39;)-&gt;group(function () {</span>
<span class="x">    Route::get(&#39;/users&#39;, function () {</span>
<span class="x">        return &#39;Admin Users&#39;;</span>
<span class="x">    })-&gt;name(&#39;users&#39;);</span>

<span class="x">    Route::get(&#39;/posts&#39;, function () {</span>
<span class="x">        return &#39;Admin Posts&#39;;</span>
<span class="x">    })-&gt;name(&#39;posts&#39;);</span>
<span class="x">});</span>

<span class="x">// Route names will be:</span>
<span class="x">// admin.users</span>
<span class="x">// admin.posts</span>
</code></pre></div>

<h3 id="combined-groups">Combined Groups</h3>
<div class="codehilite"><pre><span></span><code><span class="x">Route::prefix(&#39;admin&#39;)</span>
<span class="x">    -&gt;name(&#39;admin.&#39;)</span>
<span class="x">    -&gt;middleware([&#39;auth&#39;, &#39;admin&#39;])</span>
<span class="x">    -&gt;group(function () {</span>
<span class="x">        Route::get(&#39;/dashboard&#39;, function () {</span>
<span class="x">            return &#39;Admin Dashboard&#39;;</span>
<span class="x">        })-&gt;name(&#39;dashboard&#39;);</span>

<span class="x">        Route::get(&#39;/users&#39;, function () {</span>
<span class="x">            return &#39;Admin Users&#39;;</span>
<span class="x">        })-&gt;name(&#39;users&#39;);</span>
<span class="x">    });</span>
</code></pre></div>

<h2 id="route-model-binding">Route Model Binding</h2>
<p>Laravel automatically injects model instances based on route parameters:</p>
<h3 id="basic-route-model-binding">Basic Route Model Binding</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Laravel will automatically fetch the User model</span>
<span class="x">Route::get(&#39;/user/{user}&#39;, function (App\Models\User $user) {</span>
<span class="x">    return $user;</span>
<span class="x">});</span>

<span class="x">// This will automatically fetch the user with ID 123</span>
<span class="x">// /user/123</span>
</code></pre></div>

<h3 id="custom-route-model-binding">Custom Route Model Binding</h3>
<p>You can customize how models are resolved:</p>
<div class="codehilite"><pre><span></span><code><span class="x">// In App\Providers\RouteServiceProvider</span>
<span class="x">public function boot()</span>
<span class="x">{</span>
<span class="x">    Route::model(&#39;user&#39;, App\Models\User::class);</span>

<span class="x">    // Custom resolution logic</span>
<span class="x">    Route::bind(&#39;user&#39;, function ($value) {</span>
<span class="x">        return App\Models\User::where(&#39;username&#39;, $value)-&gt;firstOrFail();</span>
<span class="x">    });</span>
<span class="x">}</span>

<span class="x">// Now you can use username instead of ID</span>
<span class="x">Route::get(&#39;/user/{user}&#39;, function (App\Models\User $user) {</span>
<span class="x">    return $user;</span>
<span class="x">});</span>

<span class="x">// /user/john-doe (will find user with username &#39;john-doe&#39;)</span>
</code></pre></div>

<h3 id="implicit-route-model-binding">Implicit Route Model Binding</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Laravel automatically resolves the model</span>
<span class="x">Route::get(&#39;/posts/{post}&#39;, function (App\Models\Post $post) {</span>
<span class="x">    return $post;</span>
<span class="x">});</span>

<span class="x">// You can also specify the column to use</span>
<span class="x">Route::get(&#39;/posts/{post:slug}&#39;, function (App\Models\Post $post) {</span>
<span class="x">    return $post;</span>
<span class="x">});</span>

<span class="x">// This will find the post by slug instead of ID</span>
</code></pre></div>

<h2 id="route-caching">Route Caching</h2>
<p>For production applications, you can cache your routes for better performance:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Cache routes</span>
php<span class="w"> </span>artisan<span class="w"> </span>route:cache

<span class="c1"># Clear route cache</span>
php<span class="w"> </span>artisan<span class="w"> </span>route:clear

<span class="c1"># List all routes</span>
php<span class="w"> </span>artisan<span class="w"> </span>route:list
</code></pre></div>

<h2 id="route-lists">Route Lists</h2>
<p>View all registered routes:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># List all routes</span>
php<span class="w"> </span>artisan<span class="w"> </span>route:list

<span class="c1"># List routes with specific method</span>
php<span class="w"> </span>artisan<span class="w"> </span>route:list<span class="w"> </span>--method<span class="o">=</span>GET

<span class="c1"># List routes with specific name</span>
php<span class="w"> </span>artisan<span class="w"> </span>route:list<span class="w"> </span>--name<span class="o">=</span>user

<span class="c1"># Export routes to file</span>
php<span class="w"> </span>artisan<span class="w"> </span>route:list<span class="w"> </span>&gt;<span class="w"> </span>routes.txt
</code></pre></div>

<h2 id="route-parameters-and-dependencies">Route Parameters and Dependencies</h2>
<h3 id="type-hinted-dependencies">Type-Hinted Dependencies</h3>
<p>Laravel's service container automatically resolves dependencies:</p>
<div class="codehilite"><pre><span></span><code><span class="x">Route::get(&#39;/users&#39;, function (App\Services\UserService $userService) {</span>
<span class="x">    return $userService-&gt;getAllUsers();</span>
<span class="x">});</span>
</code></pre></div>

<h3 id="request-injection">Request Injection</h3>
<div class="codehilite"><pre><span></span><code><span class="x">Route::post(&#39;/users&#39;, function (Illuminate\Http\Request $request) {</span>
<span class="x">    $name = $request-&gt;input(&#39;name&#39;);</span>
<span class="x">    $email = $request-&gt;input(&#39;email&#39;);</span>

<span class="x">    return &quot;Name: {$name}, Email: {$email}&quot;;</span>
<span class="x">});</span>
</code></pre></div>

<h2 id="route-middleware">Route Middleware</h2>
<p>Apply middleware to routes:</p>
<div class="codehilite"><pre><span></span><code><span class="x">// Single middleware</span>
<span class="x">Route::get(&#39;/admin&#39;, function () {</span>
<span class="x">    return &#39;Admin Area&#39;;</span>
<span class="x">})-&gt;middleware(&#39;auth&#39;);</span>

<span class="x">// Multiple middleware</span>
<span class="x">Route::get(&#39;/admin&#39;, function () {</span>
<span class="x">    return &#39;Admin Area&#39;;</span>
<span class="x">})-&gt;middleware([&#39;auth&#39;, &#39;admin&#39;]);</span>

<span class="x">// Exclude middleware from specific routes in a group</span>
<span class="x">Route::middleware([&#39;auth&#39;, &#39;admin&#39;])-&gt;group(function () {</span>
<span class="x">    Route::get(&#39;/admin/dashboard&#39;, function () {</span>
<span class="x">        return &#39;Dashboard&#39;;</span>
<span class="x">    });</span>

<span class="x">    Route::get(&#39;/admin/public&#39;, function () {</span>
<span class="x">        return &#39;Public Admin Page&#39;;</span>
<span class="x">    })-&gt;withoutMiddleware([&#39;auth&#39;]);</span>
<span class="x">});</span>
</code></pre></div>

<h2 id="route-fallbacks">Route Fallbacks</h2>
<p>Define a fallback route for unmatched URLs:</p>
<div class="codehilite"><pre><span></span><code><span class="x">// This should be the last route defined</span>
<span class="x">Route::fallback(function () {</span>
<span class="x">    return response()-&gt;json([&#39;message&#39; =&gt; &#39;Not Found&#39;], 404);</span>
<span class="x">});</span>
</code></pre></div>

<h2 id="api-routes">API Routes</h2>
<p>API routes are defined in <code>routes/api.php</code> and automatically have the <code>/api</code> prefix:</p>
<div class="codehilite"><pre><span></span><code><span class="x">// routes/api.php</span>
<span class="x">Route::get(&#39;/users&#39;, function () {</span>
<span class="x">    return App\Models\User::all();</span>
<span class="x">});</span>

<span class="x">// This route will be accessible at /api/users</span>
</code></pre></div>

<h2 id="route-file-organization">Route File Organization</h2>
<p>For large applications, you can organize routes into multiple files:</p>
<div class="codehilite"><pre><span></span><code><span class="x">// routes/web.php</span>
<span class="x">Route::get(&#39;/&#39;, function () {</span>
<span class="x">    return view(&#39;welcome&#39;);</span>
<span class="x">});</span>

<span class="x">// Include other route files</span>
<span class="x">require __DIR__.&#39;/auth.php&#39;;</span>
<span class="x">require __DIR__.&#39;/admin.php&#39;;</span>
<span class="x">require __DIR__.&#39;/api.php&#39;;</span>
</code></pre></div>

<p><strong>routes/auth.php</strong></p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Route</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;auth.login&#39;</span><span class="p">);</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span>

<span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Login logic</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;login.post&#39;</span><span class="p">);</span>
</code></pre></div>

<h2 id="best-practices">Best Practices</h2>
<h3 id="1-use-descriptive-route-names">1. Use Descriptive Route Names</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Good</span>
<span class="x">Route::get(&#39;/users/{user}&#39;, [UserController::class, &#39;show&#39;])-&gt;name(&#39;users.show&#39;);</span>
<span class="x">Route::post(&#39;/users&#39;, [UserController::class, &#39;store&#39;])-&gt;name(&#39;users.store&#39;);</span>

<span class="x">// Avoid</span>
<span class="x">Route::get(&#39;/u/{id}&#39;, [UserController::class, &#39;show&#39;])-&gt;name(&#39;u&#39;);</span>
</code></pre></div>

<h3 id="2-group-related-routes">2. Group Related Routes</h3>
<div class="codehilite"><pre><span></span><code><span class="x">Route::prefix(&#39;admin&#39;)-&gt;name(&#39;admin.&#39;)-&gt;middleware([&#39;auth&#39;, &#39;admin&#39;])-&gt;group(function () {</span>
<span class="x">    Route::resource(&#39;users&#39;, AdminUserController::class);</span>
<span class="x">    Route::resource(&#39;posts&#39;, AdminPostController::class);</span>
<span class="x">});</span>
</code></pre></div>

<h3 id="3-use-route-model-binding">3. Use Route Model Binding</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Good - automatic model resolution</span>
<span class="x">Route::get(&#39;/posts/{post}&#39;, [PostController::class, &#39;show&#39;]);</span>

<span class="x">// Avoid - manual model fetching</span>
<span class="x">Route::get(&#39;/posts/{id}&#39;, function ($id) {</span>
<span class="x">    $post = Post::findOrFail($id);</span>
<span class="x">    return view(&#39;posts.show&#39;, compact(&#39;post&#39;));</span>
<span class="x">});</span>
</code></pre></div>

<h3 id="4-apply-constraints-appropriately">4. Apply Constraints Appropriately</h3>
<div class="codehilite"><pre><span></span><code><span class="x">Route::get(&#39;/user/{id}&#39;, [UserController::class, &#39;show&#39;])</span>
<span class="x">    -&gt;where(&#39;id&#39;, &#39;[0-9]+&#39;)</span>
<span class="x">    -&gt;name(&#39;users.show&#39;);</span>
</code></pre></div>

<h3 id="5-use-named-routes-consistently">5. Use Named Routes Consistently</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// In controllers</span>
<span class="x">return redirect()-&gt;route(&#39;users.show&#39;, [&#39;user&#39; =&gt; $user]);</span>

<span class="x">// In views</span>
<span class="x">&lt;a href=&quot;{{ route(&#39;users.edit&#39;, [&#39;user&#39; =&gt; $user]) }}&quot;&gt;Edit&lt;/a&gt;</span>
</code></pre></div>

<h2 id="common-patterns">Common Patterns</h2>
<h3 id="restful-routes">RESTful Routes</h3>
<div class="codehilite"><pre><span></span><code><span class="x">Route::resource(&#39;users&#39;, UserController::class);</span>
<span class="x">// Creates:</span>
<span class="x">// GET    /users          (index)</span>
<span class="x">// GET    /users/create   (create)</span>
<span class="x">// POST   /users          (store)</span>
<span class="x">// GET    /users/{user}   (show)</span>
<span class="x">// GET    /users/{user}/edit (edit)</span>
<span class="x">// PUT/PATCH /users/{user} (update)</span>
<span class="x">// DELETE /users/{user}   (destroy)</span>
</code></pre></div>

<h3 id="api-resource-routes">API Resource Routes</h3>
<div class="codehilite"><pre><span></span><code><span class="x">Route::apiResource(&#39;users&#39;, UserController::class);</span>
<span class="x">// Creates only: index, store, show, update, destroy</span>
<span class="x">// (no create or edit routes)</span>
</code></pre></div>

<h3 id="nested-resources">Nested Resources</h3>
<div class="codehilite"><pre><span></span><code><span class="x">Route::resource(&#39;users.posts&#39;, UserPostController::class);</span>
<span class="x">// Creates:</span>
<span class="x">// GET    /users/{user}/posts</span>
<span class="x">// GET    /users/{user}/posts/create</span>
<span class="x">// POST   /users/{user}/posts</span>
<span class="x">// GET    /users/{user}/posts/{post}</span>
<span class="x">// GET    /users/{user}/posts/{post}/edit</span>
<span class="x">// PUT/PATCH /users/{user}/posts/{post}</span>
<span class="x">// DELETE /users/{user}/posts/{post}</span>
</code></pre></div>

<h2 id="testing-routes">Testing Routes</h2>
<p>Test your routes with PHPUnit:</p>
<div class="codehilite"><pre><span></span><code><span class="x">// tests/Feature/RouteTest.php</span>
<span class="x">public function test_home_page_returns_200()</span>
<span class="x">{</span>
<span class="x">    $response = $this-&gt;get(&#39;/&#39;);</span>
<span class="x">    $response-&gt;assertStatus(200);</span>
<span class="x">}</span>

<span class="x">public function test_user_route_with_model_binding()</span>
<span class="x">{</span>
<span class="x">    $user = User::factory()-&gt;create();</span>

<span class="x">    $response = $this-&gt;get(&quot;/user/{$user-&gt;id}&quot;);</span>
<span class="x">    $response-&gt;assertStatus(200);</span>
<span class="x">    $response-&gt;assertSee($user-&gt;name);</span>
<span class="x">}</span>
</code></pre></div>

<h2 id="summary">Summary</h2>
<p>Laravel's routing system is powerful and flexible. Key concepts covered:</p>
<ul>
<li><strong>Basic Routes</strong>: Define routes for different HTTP methods</li>
<li><strong>Route Parameters</strong>: Capture URL segments and add constraints</li>
<li><strong>Named Routes</strong>: Generate URLs without hardcoding</li>
<li><strong>Route Groups</strong>: Apply common attributes to multiple routes</li>
<li><strong>Route Model Binding</strong>: Automatic model resolution</li>
<li><strong>Middleware</strong>: Apply filters to routes</li>
<li><strong>Best Practices</strong>: Organize and structure routes effectively</li>
</ul>
<p>Understanding routing is fundamental to building Laravel applications. The concepts learned here will be used throughout the rest of the book as we build more complex applications.</p></div><div class="chapter" id="04-controllers"><h1 id="chapter-4-controllers">Chapter 4: Controllers</h1>
<h2 id="what-are-controllers">What are Controllers?</h2>
<p>Controllers are the heart of your Laravel application's logic. They handle incoming HTTP requests and return responses to the user. Controllers help you organize your application logic by grouping related request handling logic into a single class.</p>
<h2 id="creating-controllers">Creating Controllers</h2>
<h3 id="using-artisan-command">Using Artisan Command</h3>
<p>The easiest way to create a controller is using the Artisan command:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Basic controller</span>
php<span class="w"> </span>artisan<span class="w"> </span>make:controller<span class="w"> </span>UserController

<span class="c1"># Resource controller (with CRUD methods)</span>
php<span class="w"> </span>artisan<span class="w"> </span>make:controller<span class="w"> </span>PostController<span class="w"> </span>--resource

<span class="c1"># API resource controller</span>
php<span class="w"> </span>artisan<span class="w"> </span>make:controller<span class="w"> </span>Api/UserController<span class="w"> </span>--api

<span class="c1"># Controller with model</span>
php<span class="w"> </span>artisan<span class="w"> </span>make:controller<span class="w"> </span>PostController<span class="w"> </span>--resource<span class="w"> </span>--model<span class="o">=</span>Post
</code></pre></div>

<h3 id="manual-creation">Manual Creation</h3>
<p>You can also create controllers manually by creating a PHP file in the <code>app/Http/Controllers</code> directory:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;users.index&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="basic-controller-structure">Basic Controller Structure</h2>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Display a listing of the resource.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">all</span><span class="p">();</span>
        <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;users.index&#39;</span><span class="p">,</span> <span class="nb">compact</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Show the form for creating a new resource.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">create</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;users.create&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Store a newly created resource in storage.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">store</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$validated</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">([</span>
            <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|string|max:255&#39;</span><span class="p">,</span>
            <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|email|unique:users&#39;</span><span class="p">,</span>
            <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|min:8&#39;</span><span class="p">,</span>
        <span class="p">]);</span>

        <span class="nx">User</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="nv">$validated</span><span class="p">);</span>

        <span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">route</span><span class="p">(</span><span class="s1">&#39;users.index&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="s1">&#39;User created successfully!&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Display the specified resource.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">show</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;users.show&#39;</span><span class="p">,</span> <span class="nb">compact</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Show the form for editing the specified resource.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">edit</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;users.edit&#39;</span><span class="p">,</span> <span class="nb">compact</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Update the specified resource in storage.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$validated</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">([</span>
            <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|string|max:255&#39;</span><span class="p">,</span>
            <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|email|unique:users,email,&#39;</span> <span class="o">.</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">,</span>
        <span class="p">]);</span>

        <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">(</span><span class="nv">$validated</span><span class="p">);</span>

        <span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">route</span><span class="p">(</span><span class="s1">&#39;users.index&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="s1">&#39;User updated successfully!&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Remove the specified resource from storage.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">destroy</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">();</span>

        <span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">route</span><span class="p">(</span><span class="s1">&#39;users.index&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="s1">&#39;User deleted successfully!&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="controller-methods">Controller Methods</h2>
<h3 id="basic-methods">Basic Methods</h3>
<div class="codehilite"><pre><span></span><code><span class="x">public function index()</span>
<span class="x">{</span>
<span class="x">    // Display a list of resources</span>
<span class="x">    return view(&#39;users.index&#39;);</span>
<span class="x">}</span>

<span class="x">public function show($id)</span>
<span class="x">{</span>
<span class="x">    // Display a specific resource</span>
<span class="x">    $user = User::findOrFail($id);</span>
<span class="x">    return view(&#39;users.show&#39;, compact(&#39;user&#39;));</span>
<span class="x">}</span>

<span class="x">public function create()</span>
<span class="x">{</span>
<span class="x">    // Show form to create a new resource</span>
<span class="x">    return view(&#39;users.create&#39;);</span>
<span class="x">}</span>

<span class="x">public function store(Request $request)</span>
<span class="x">{</span>
<span class="x">    // Store a new resource</span>
<span class="x">    // Validation and storage logic</span>
<span class="x">}</span>

<span class="x">public function edit($id)</span>
<span class="x">{</span>
<span class="x">    // Show form to edit a resource</span>
<span class="x">    $user = User::findOrFail($id);</span>
<span class="x">    return view(&#39;users.edit&#39;, compact(&#39;user&#39;));</span>
<span class="x">}</span>

<span class="x">public function update(Request $request, $id)</span>
<span class="x">{</span>
<span class="x">    // Update an existing resource</span>
<span class="x">    // Validation and update logic</span>
<span class="x">}</span>

<span class="x">public function destroy($id)</span>
<span class="x">{</span>
<span class="x">    // Delete a resource</span>
<span class="x">    $user = User::findOrFail($id);</span>
<span class="x">    $user-&gt;delete();</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="custom-methods">Custom Methods</h3>
<p>You can add custom methods to your controllers:</p>
<div class="codehilite"><pre><span></span><code><span class="x">public function profile()</span>
<span class="x">{</span>
<span class="x">    $user = auth()-&gt;user();</span>
<span class="x">    return view(&#39;users.profile&#39;, compact(&#39;user&#39;));</span>
<span class="x">}</span>

<span class="x">public function search(Request $request)</span>
<span class="x">{</span>
<span class="x">    $query = $request-&gt;get(&#39;q&#39;);</span>
<span class="x">    $users = User::where(&#39;name&#39;, &#39;like&#39;, &quot;%{$query}%&quot;)-&gt;get();</span>
<span class="x">    return view(&#39;users.search&#39;, compact(&#39;users&#39;, &#39;query&#39;));</span>
<span class="x">}</span>

<span class="x">public function export()</span>
<span class="x">{</span>
<span class="x">    $users = User::all();</span>
<span class="x">    return response()-&gt;json($users);</span>
<span class="x">}</span>
</code></pre></div>

<h2 id="route-model-binding">Route Model Binding</h2>
<p>Laravel automatically injects model instances into your controller methods:</p>
<div class="codehilite"><pre><span></span><code><span class="x">// Route: Route::get(&#39;/users/{user}&#39;, [UserController::class, &#39;show&#39;]);</span>

<span class="x">public function show(User $user)</span>
<span class="x">{</span>
<span class="x">    // Laravel automatically finds the User model by ID</span>
<span class="x">    return view(&#39;users.show&#39;, compact(&#39;user&#39;));</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="custom-route-model-binding">Custom Route Model Binding</h3>
<p>You can customize how models are resolved:</p>
<div class="codehilite"><pre><span></span><code><span class="x">// In RouteServiceProvider</span>
<span class="x">public function boot()</span>
<span class="x">{</span>
<span class="x">    Route::model(&#39;user&#39;, User::class);</span>

<span class="x">    // Or with custom logic</span>
<span class="x">    Route::bind(&#39;user&#39;, function ($value) {</span>
<span class="x">        return User::where(&#39;username&#39;, $value)-&gt;firstOrFail();</span>
<span class="x">    });</span>
<span class="x">}</span>
</code></pre></div>

<h2 id="request-handling">Request Handling</h2>
<h3 id="basic-request-handling">Basic Request Handling</h3>
<div class="codehilite"><pre><span></span><code><span class="x">public function store(Request $request)</span>
<span class="x">{</span>
<span class="x">    // Access request data</span>
<span class="x">    $name = $request-&gt;input(&#39;name&#39;);</span>
<span class="x">    $email = $request-&gt;email; // Shorthand</span>

<span class="x">    // Check if field exists</span>
<span class="x">    if ($request-&gt;has(&#39;newsletter&#39;)) {</span>
<span class="x">        // Handle newsletter subscription</span>
<span class="x">    }</span>

<span class="x">    // Get all input</span>
<span class="x">    $data = $request-&gt;all();</span>

<span class="x">    // Get only specific fields</span>
<span class="x">    $data = $request-&gt;only([&#39;name&#39;, &#39;email&#39;]);</span>

<span class="x">    // Get all except specific fields</span>
<span class="x">    $data = $request-&gt;except([&#39;password&#39;]);</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="form-request-validation">Form Request Validation</h3>
<p>Create custom form request classes for validation:</p>
<div class="codehilite"><pre><span></span><code>php<span class="w"> </span>artisan<span class="w"> </span>make:request<span class="w"> </span>StoreUserRequest
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Requests</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Http\FormRequest</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">StoreUserRequest</span> <span class="k">extends</span> <span class="nx">FormRequest</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">authorize</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">true</span><span class="p">;</span> <span class="c1">// Or add authorization logic</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">rules</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|string|max:255&#39;</span><span class="p">,</span>
            <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|email|unique:users&#39;</span><span class="p">,</span>
            <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|min:8|confirmed&#39;</span><span class="p">,</span>
        <span class="p">];</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">messages</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">&#39;name.required&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;The name field is required.&#39;</span><span class="p">,</span>
            <span class="s1">&#39;email.unique&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;This email is already taken.&#39;</span><span class="p">,</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Use in controller:</p>
<div class="codehilite"><pre><span></span><code><span class="x">public function store(StoreUserRequest $request)</span>
<span class="x">{</span>
<span class="x">    // Validation is automatically handled</span>
<span class="x">    $validated = $request-&gt;validated();</span>

<span class="x">    User::create($validated);</span>

<span class="x">    return redirect()-&gt;route(&#39;users.index&#39;);</span>
<span class="x">}</span>
</code></pre></div>

<h2 id="response-types">Response Types</h2>
<h3 id="view-responses">View Responses</h3>
<div class="codehilite"><pre><span></span><code><span class="x">public function index()</span>
<span class="x">{</span>
<span class="x">    $users = User::all();</span>
<span class="x">    return view(&#39;users.index&#39;, compact(&#39;users&#39;));</span>
<span class="x">}</span>

<span class="x">// With additional data</span>
<span class="x">return view(&#39;users.show&#39;, [</span>
<span class="x">    &#39;user&#39; =&gt; $user,</span>
<span class="x">    &#39;posts&#39; =&gt; $user-&gt;posts,</span>
<span class="x">    &#39;title&#39; =&gt; &#39;User Profile&#39;</span>
<span class="x">]);</span>
</code></pre></div>

<h3 id="json-responses">JSON Responses</h3>
<div class="codehilite"><pre><span></span><code><span class="x">public function api()</span>
<span class="x">{</span>
<span class="x">    $users = User::all();</span>
<span class="x">    return response()-&gt;json($users);</span>
<span class="x">}</span>

<span class="x">// With status code</span>
<span class="x">return response()-&gt;json([&#39;message&#39; =&gt; &#39;User created&#39;], 201);</span>

<span class="x">// With headers</span>
<span class="x">return response()-&gt;json($data, 200, [</span>
<span class="x">    &#39;Content-Type&#39; =&gt; &#39;application/json&#39;,</span>
<span class="x">    &#39;X-Custom-Header&#39; =&gt; &#39;value&#39;</span>
<span class="x">]);</span>
</code></pre></div>

<h3 id="redirect-responses">Redirect Responses</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Simple redirect</span>
<span class="x">return redirect(&#39;/users&#39;);</span>

<span class="x">// Redirect to named route</span>
<span class="x">return redirect()-&gt;route(&#39;users.index&#39;);</span>

<span class="x">// Redirect with data</span>
<span class="x">return redirect()-&gt;route(&#39;users.index&#39;)-&gt;with(&#39;success&#39;, &#39;User created!&#39;);</span>

<span class="x">// Redirect back</span>
<span class="x">return redirect()-&gt;back();</span>

<span class="x">// Redirect with input</span>
<span class="x">return redirect()-&gt;back()-&gt;withInput();</span>
</code></pre></div>

<h3 id="file-responses">File Responses</h3>
<div class="codehilite"><pre><span></span><code><span class="x">public function download()</span>
<span class="x">{</span>
<span class="x">    $path = storage_path(&#39;app/public/file.pdf&#39;);</span>
<span class="x">    return response()-&gt;download($path);</span>
<span class="x">}</span>

<span class="x">public function stream()</span>
<span class="x">{</span>
<span class="x">    $path = storage_path(&#39;app/public/file.pdf&#39;);</span>
<span class="x">    return response()-&gt;file($path);</span>
<span class="x">}</span>
</code></pre></div>

<h2 id="controller-organization">Controller Organization</h2>
<h3 id="single-action-controllers">Single Action Controllers</h3>
<p>For simple actions, you can use single action controllers:</p>
<div class="codehilite"><pre><span></span><code>php<span class="w"> </span>artisan<span class="w"> </span>make:controller<span class="w"> </span>ShowUserProfile<span class="w"> </span>--invokable
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ShowUserProfile</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__invoke</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">findOrFail</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;users.profile&#39;</span><span class="p">,</span> <span class="nb">compact</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Route:</p>
<div class="codehilite"><pre><span></span><code><span class="x">Route::get(&#39;/users/{id}/profile&#39;, ShowUserProfile::class);</span>
</code></pre></div>

<h3 id="api-controllers">API Controllers</h3>
<p>API controllers are optimized for API responses:</p>
<div class="codehilite"><pre><span></span><code>php<span class="w"> </span>artisan<span class="w"> </span>make:controller<span class="w"> </span>Api/UserController<span class="w"> </span>--api
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers\Api</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">all</span><span class="p">();</span>
        <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">(</span><span class="nv">$users</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">store</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$validated</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">([</span>
            <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|string|max:255&#39;</span><span class="p">,</span>
            <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|email|unique:users&#39;</span><span class="p">,</span>
        <span class="p">]);</span>

        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="nv">$validated</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="mi">201</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">show</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$validated</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">([</span>
            <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;sometimes|string|max:255&#39;</span><span class="p">,</span>
            <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;sometimes|email|unique:users,email,&#39;</span> <span class="o">.</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">,</span>
        <span class="p">]);</span>

        <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">(</span><span class="nv">$validated</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">destroy</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">();</span>
        <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="mi">204</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="middleware-in-controllers">Middleware in Controllers</h2>
<h3 id="applying-middleware">Applying Middleware</h3>
<div class="codehilite"><pre><span></span><code><span class="x">class UserController extends Controller</span>
<span class="x">{</span>
<span class="x">    public function __construct()</span>
<span class="x">    {</span>
<span class="x">        $this-&gt;middleware(&#39;auth&#39;);</span>
<span class="x">        $this-&gt;middleware(&#39;admin&#39;)-&gt;only([&#39;destroy&#39;]);</span>
<span class="x">        $this-&gt;middleware(&#39;verified&#39;)-&gt;except([&#39;index&#39;, &#39;show&#39;]);</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="conditional-middleware">Conditional Middleware</h3>
<div class="codehilite"><pre><span></span><code><span class="x">public function __construct()</span>
<span class="x">{</span>
<span class="x">    $this-&gt;middleware(&#39;auth&#39;)-&gt;only([&#39;edit&#39;, &#39;update&#39;, &#39;destroy&#39;]);</span>
<span class="x">    $this-&gt;middleware(&#39;admin&#39;)-&gt;when(function ($request) {</span>
<span class="x">        return $request-&gt;is(&#39;admin/*&#39;);</span>
<span class="x">    });</span>
<span class="x">}</span>
</code></pre></div>

<h2 id="resource-controllers">Resource Controllers</h2>
<p>Resource controllers provide all the CRUD operations:</p>
<div class="codehilite"><pre><span></span><code><span class="x">// Route definition</span>
<span class="x">Route::resource(&#39;users&#39;, UserController::class);</span>

<span class="x">// This creates the following routes:</span>
<span class="x">// GET    /users              index   users.index</span>
<span class="x">// GET    /users/create       create  users.create</span>
<span class="x">// POST   /users              store   users.store</span>
<span class="x">// GET    /users/{user}       show    users.show</span>
<span class="x">// GET    /users/{user}/edit  edit    users.edit</span>
<span class="x">// PUT    /users/{user}       update  users.update</span>
<span class="x">// DELETE /users/{user}       destroy users.destroy</span>
</code></pre></div>

<h3 id="partial-resource-routes">Partial Resource Routes</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Only specific methods</span>
<span class="x">Route::resource(&#39;users&#39;, UserController::class)-&gt;only([&#39;index&#39;, &#39;show&#39;]);</span>

<span class="x">// All except specific methods</span>
<span class="x">Route::resource(&#39;users&#39;, UserController::class)-&gt;except([&#39;destroy&#39;]);</span>

<span class="x">// Nested resources</span>
<span class="x">Route::resource(&#39;users.posts&#39;, PostController::class);</span>
</code></pre></div>

<h2 id="best-practices">Best Practices</h2>
<h3 id="1-keep-controllers-thin">1. Keep Controllers Thin</h3>
<p>Controllers should be thin and focused on handling HTTP requests. Move business logic to services or models.</p>
<div class="codehilite"><pre><span></span><code><span class="x">// Good</span>
<span class="x">public function store(StoreUserRequest $request)</span>
<span class="x">{</span>
<span class="x">    $user = UserService::create($request-&gt;validated());</span>
<span class="x">    return redirect()-&gt;route(&#39;users.show&#39;, $user);</span>
<span class="x">}</span>

<span class="x">// Bad</span>
<span class="x">public function store(Request $request)</span>
<span class="x">{</span>
<span class="x">    // Too much business logic in controller</span>
<span class="x">    $data = $request-&gt;all();</span>
<span class="x">    $user = new User();</span>
<span class="x">    $user-&gt;name = $data[&#39;name&#39;];</span>
<span class="x">    $user-&gt;email = $data[&#39;email&#39;];</span>
<span class="x">    $user-&gt;password = Hash::make($data[&#39;password&#39;]);</span>
<span class="x">    $user-&gt;save();</span>
<span class="x">    // ... more logic</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="2-use-form-requests">2. Use Form Requests</h3>
<p>Use form request classes for validation and authorization:</p>
<div class="codehilite"><pre><span></span><code><span class="x">public function store(StoreUserRequest $request)</span>
<span class="x">{</span>
<span class="x">    // Validation is handled automatically</span>
<span class="x">    $user = User::create($request-&gt;validated());</span>
<span class="x">    return redirect()-&gt;route(&#39;users.show&#39;, $user);</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="3-use-route-model-binding">3. Use Route Model Binding</h3>
<p>Let Laravel handle model resolution:</p>
<div class="codehilite"><pre><span></span><code><span class="x">// Good</span>
<span class="x">public function show(User $user)</span>
<span class="x">{</span>
<span class="x">    return view(&#39;users.show&#39;, compact(&#39;user&#39;));</span>
<span class="x">}</span>

<span class="x">// Bad</span>
<span class="x">public function show($id)</span>
<span class="x">{</span>
<span class="x">    $user = User::findOrFail($id);</span>
<span class="x">    return view(&#39;users.show&#39;, compact(&#39;user&#39;));</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="4-consistent-response-patterns">4. Consistent Response Patterns</h3>
<p>Use consistent response patterns throughout your application:</p>
<div class="codehilite"><pre><span></span><code><span class="x">public function store(StoreUserRequest $request)</span>
<span class="x">{</span>
<span class="x">    $user = User::create($request-&gt;validated());</span>

<span class="x">    return redirect()-&gt;route(&#39;users.show&#39;, $user)</span>
<span class="x">        -&gt;with(&#39;success&#39;, &#39;User created successfully!&#39;);</span>
<span class="x">}</span>

<span class="x">public function update(UpdateUserRequest $request, User $user)</span>
<span class="x">{</span>
<span class="x">    $user-&gt;update($request-&gt;validated());</span>

<span class="x">    return redirect()-&gt;route(&#39;users.show&#39;, $user)</span>
<span class="x">        -&gt;with(&#39;success&#39;, &#39;User updated successfully!&#39;);</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="5-use-dependency-injection">5. Use Dependency Injection</h3>
<p>Inject dependencies through the constructor:</p>
<div class="codehilite"><pre><span></span><code><span class="x">class UserController extends Controller</span>
<span class="x">{</span>
<span class="x">    protected $userService;</span>

<span class="x">    public function __construct(UserService $userService)</span>
<span class="x">    {</span>
<span class="x">        $this-&gt;userService = $userService;</span>
<span class="x">    }</span>

<span class="x">    public function store(StoreUserRequest $request)</span>
<span class="x">    {</span>
<span class="x">        $user = $this-&gt;userService-&gt;create($request-&gt;validated());</span>
<span class="x">        return redirect()-&gt;route(&#39;users.show&#39;, $user);</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h2 id="summary">Summary</h2>
<p>In this chapter, we covered:</p>
<ul>
<li>✅ Creating controllers using Artisan commands</li>
<li>✅ Basic controller structure and methods</li>
<li>✅ Route model binding</li>
<li>✅ Request handling and validation</li>
<li>✅ Different response types</li>
<li>✅ Controller organization patterns</li>
<li>✅ Middleware in controllers</li>
<li>✅ Resource controllers</li>
<li>✅ Best practices for writing controllers</li>
</ul>
<p>Controllers are essential for organizing your application logic and handling HTTP requests. In the next chapter, we'll explore Laravel's Blade templating engine for creating dynamic views.</p></div><div class="chapter" id="05-blade"><h1 id="chapter-5-blade-templates">Chapter 5: Blade Templates</h1>
<h2 id="what-is-blade">What is Blade?</h2>
<p>Blade is Laravel's powerful templating engine. It provides a clean, simple syntax for creating dynamic views with PHP. Blade templates are compiled into plain PHP code and cached for optimal performance.</p>
<h2 id="basic-blade-syntax">Basic Blade Syntax</h2>
<h3 id="echoing-data">Echoing Data</h3>
<div class="codehilite"><pre><span></span><code><span class="x">{{ $variable }}</span>

<span class="x">{{ $user-&gt;name }}</span>

<span class="x">{{ $array[&#39;key&#39;] }}</span>

<span class="x">{{ $object-&gt;method() }}</span>
</code></pre></div>

<h3 id="unescaped-data">Unescaped Data</h3>
<div class="codehilite"><pre><span></span><code><span class="x">{!! $html !!}</span>
</code></pre></div>

<p><strong>Warning</strong>: Only use <code>{!! !!}</code> for trusted content to prevent XSS attacks.</p>
<h3 id="comments">Comments</h3>
<div class="codehilite"><pre><span></span><code><span class="x">{{-- This is a Blade comment --}}</span>
<span class="x">{{-- </span>
<span class="x">    Multi-line</span>
<span class="x">    comments</span>
<span class="x">--}}</span>
</code></pre></div>

<h2 id="blade-directives">Blade Directives</h2>
<h3 id="conditional-statements">Conditional Statements</h3>
<h4 id="if-elseif-else">@if, @elseif, @else</h4>
<div class="codehilite"><pre><span></span><code><span class="x">@if($user-&gt;isAdmin())</span>
<span class="x">    &lt;h1&gt;Welcome, Administrator!&lt;/h1&gt;</span>
<span class="x">@elseif($user-&gt;isModerator())</span>
<span class="x">    &lt;h1&gt;Welcome, Moderator!&lt;/h1&gt;</span>
<span class="x">@else</span>
<span class="x">    &lt;h1&gt;Welcome, User!&lt;/h1&gt;</span>
<span class="x">@endif</span>
</code></pre></div>

<h4 id="unless">@unless</h4>
<div class="codehilite"><pre><span></span><code><span class="x">@unless($user-&gt;isVerified())</span>
<span class="x">    &lt;p&gt;Please verify your email address.&lt;/p&gt;</span>
<span class="x">@endunless</span>
</code></pre></div>

<h4 id="isset-and-empty">@isset and @empty</h4>
<div class="codehilite"><pre><span></span><code><span class="x">@isset($user-&gt;profile)</span>
<span class="x">    &lt;p&gt;Profile: {{ $user-&gt;profile-&gt;bio }}&lt;/p&gt;</span>
<span class="x">@endisset</span>

<span class="x">@empty($posts)</span>
<span class="x">    &lt;p&gt;No posts found.&lt;/p&gt;</span>
<span class="x">@endempty</span>
</code></pre></div>

<h3 id="loops">Loops</h3>
<h4 id="foreach">@foreach</h4>
<div class="codehilite"><pre><span></span><code><span class="x">@foreach($users as $user)</span>
<span class="x">    &lt;div class=&quot;user&quot;&gt;</span>
<span class="x">        &lt;h3&gt;{{ $user-&gt;name }}&lt;/h3&gt;</span>
<span class="x">        &lt;p&gt;{{ $user-&gt;email }}&lt;/p&gt;</span>
<span class="x">    &lt;/div&gt;</span>
<span class="x">@endforeach</span>
</code></pre></div>

<h4 id="for">@for</h4>
<div class="codehilite"><pre><span></span><code><span class="x">@for($i = 0; $i &lt; 10; $i++)</span>
<span class="x">    &lt;p&gt;Item {{ $i }}&lt;/p&gt;</span>
<span class="x">@endfor</span>
</code></pre></div>

<h4 id="while">@while</h4>
<div class="codehilite"><pre><span></span><code><span class="x">@while($condition)</span>
<span class="x">    &lt;p&gt;Looping...&lt;/p&gt;</span>
<span class="x">@endwhile</span>
</code></pre></div>

<h4 id="forelse">@forelse</h4>
<div class="codehilite"><pre><span></span><code><span class="x">@forelse($posts as $post)</span>
<span class="x">    &lt;div class=&quot;post&quot;&gt;</span>
<span class="x">        &lt;h2&gt;{{ $post-&gt;title }}&lt;/h2&gt;</span>
<span class="x">        &lt;p&gt;{{ $post-&gt;excerpt }}&lt;/p&gt;</span>
<span class="x">    &lt;/div&gt;</span>
<span class="x">@empty</span>
<span class="x">    &lt;p&gt;No posts available.&lt;/p&gt;</span>
<span class="x">@endforelse</span>
</code></pre></div>

<h3 id="loop-variables">Loop Variables</h3>
<div class="codehilite"><pre><span></span><code><span class="x">@foreach($users as $user)</span>
<span class="x">    @if($loop-&gt;first)</span>
<span class="x">        &lt;p&gt;First user: {{ $user-&gt;name }}&lt;/p&gt;</span>
<span class="x">    @endif</span>

<span class="x">    @if($loop-&gt;last)</span>
<span class="x">        &lt;p&gt;Last user: {{ $user-&gt;name }}&lt;/p&gt;</span>
<span class="x">    @endif</span>

<span class="x">    &lt;p&gt;User {{ $loop-&gt;iteration }} of {{ $loop-&gt;count }}: {{ $user-&gt;name }}&lt;/p&gt;</span>

<span class="x">    @if($loop-&gt;even)</span>
<span class="x">        &lt;p&gt;Even row&lt;/p&gt;</span>
<span class="x">    @endif</span>

<span class="x">    @if($loop-&gt;odd)</span>
<span class="x">        &lt;p&gt;Odd row&lt;/p&gt;</span>
<span class="x">    @endif</span>
<span class="x">@endforeach</span>
</code></pre></div>

<h2 id="layouts-and-sections">Layouts and Sections</h2>
<h3 id="creating-a-layout">Creating a Layout</h3>
<div class="codehilite"><pre><span></span><code><span class="x">&lt;!-- resources/views/layouts/app.blade.php --&gt;</span>
<span class="x">&lt;!DOCTYPE html&gt;</span>
<span class="x">&lt;html lang=&quot;en&quot;&gt;</span>
<span class="x">&lt;head&gt;</span>
<span class="x">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span>
<span class="x">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span>
<span class="x">    &lt;title&gt;@yield(&#39;title&#39;, &#39;My Laravel App&#39;)&lt;/title&gt;</span>
<span class="x">    &lt;link href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt;</span>
<span class="x">    @stack(&#39;styles&#39;)</span>
<span class="x">&lt;/head&gt;</span>
<span class="x">&lt;body&gt;</span>
<span class="x">    &lt;nav class=&quot;navbar navbar-expand-lg navbar-light bg-light&quot;&gt;</span>
<span class="x">        &lt;div class=&quot;container&quot;&gt;</span>
<span class="x">            &lt;a class=&quot;navbar-brand&quot; href=&quot;{{ route(&#39;home&#39;) }}&quot;&gt;My App&lt;/a&gt;</span>
<span class="x">            &lt;div class=&quot;navbar-nav&quot;&gt;</span>
<span class="x">                &lt;a class=&quot;nav-link&quot; href=&quot;{{ route(&#39;users.index&#39;) }}&quot;&gt;Users&lt;/a&gt;</span>
<span class="x">                &lt;a class=&quot;nav-link&quot; href=&quot;{{ route(&#39;posts.index&#39;) }}&quot;&gt;Posts&lt;/a&gt;</span>
<span class="x">            &lt;/div&gt;</span>
<span class="x">        &lt;/div&gt;</span>
<span class="x">    &lt;/nav&gt;</span>

<span class="x">    &lt;main class=&quot;container mt-4&quot;&gt;</span>
<span class="x">        @if(session(&#39;success&#39;))</span>
<span class="x">            &lt;div class=&quot;alert alert-success&quot;&gt;</span>
<span class="x">                {{ session(&#39;success&#39;) }}</span>
<span class="x">            &lt;/div&gt;</span>
<span class="x">        @endif</span>

<span class="x">        @if(session(&#39;error&#39;))</span>
<span class="x">            &lt;div class=&quot;alert alert-danger&quot;&gt;</span>
<span class="x">                {{ session(&#39;error&#39;) }}</span>
<span class="x">            &lt;/div&gt;</span>
<span class="x">        @endif</span>

<span class="x">        @yield(&#39;content&#39;)</span>
<span class="x">    &lt;/main&gt;</span>

<span class="x">    &lt;footer class=&quot;bg-light mt-5 py-3&quot;&gt;</span>
<span class="x">        &lt;div class=&quot;container text-center&quot;&gt;</span>
<span class="x">            &lt;p&gt;&amp;copy; {{ date(&#39;Y&#39;) }} My Laravel App. All rights reserved.&lt;/p&gt;</span>
<span class="x">        &lt;/div&gt;</span>
<span class="x">    &lt;/footer&gt;</span>

<span class="x">    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js&quot;&gt;&lt;/script&gt;</span>
<span class="x">    @stack(&#39;scripts&#39;)</span>
<span class="x">&lt;/body&gt;</span>
<span class="x">&lt;/html&gt;</span>
</code></pre></div>

<h3 id="extending-a-layout">Extending a Layout</h3>
<div class="codehilite"><pre><span></span><code><span class="x">&lt;!-- resources/views/users/index.blade.php --&gt;</span>
<span class="x">@extends(&#39;layouts.app&#39;)</span>

<span class="x">@section(&#39;title&#39;, &#39;Users - My Laravel App&#39;)</span>

<span class="x">@section(&#39;content&#39;)</span>
<span class="x">    &lt;div class=&quot;row&quot;&gt;</span>
<span class="x">        &lt;div class=&quot;col-md-12&quot;&gt;</span>
<span class="x">            &lt;h1&gt;Users&lt;/h1&gt;</span>
<span class="x">            &lt;a href=&quot;{{ route(&#39;users.create&#39;) }}&quot; class=&quot;btn btn-primary mb-3&quot;&gt;Create User&lt;/a&gt;</span>

<span class="x">            &lt;div class=&quot;table-responsive&quot;&gt;</span>
<span class="x">                &lt;table class=&quot;table table-striped&quot;&gt;</span>
<span class="x">                    &lt;thead&gt;</span>
<span class="x">                        &lt;tr&gt;</span>
<span class="x">                            &lt;th&gt;Name&lt;/th&gt;</span>
<span class="x">                            &lt;th&gt;Email&lt;/th&gt;</span>
<span class="x">                            &lt;th&gt;Created&lt;/th&gt;</span>
<span class="x">                            &lt;th&gt;Actions&lt;/th&gt;</span>
<span class="x">                        &lt;/tr&gt;</span>
<span class="x">                    &lt;/thead&gt;</span>
<span class="x">                    &lt;tbody&gt;</span>
<span class="x">                        @foreach($users as $user)</span>
<span class="x">                            &lt;tr&gt;</span>
<span class="x">                                &lt;td&gt;{{ $user-&gt;name }}&lt;/td&gt;</span>
<span class="x">                                &lt;td&gt;{{ $user-&gt;email }}&lt;/td&gt;</span>
<span class="x">                                &lt;td&gt;{{ $user-&gt;created_at-&gt;format(&#39;M d, Y&#39;) }}&lt;/td&gt;</span>
<span class="x">                                &lt;td&gt;</span>
<span class="x">                                    &lt;a href=&quot;{{ route(&#39;users.show&#39;, $user) }}&quot; class=&quot;btn btn-sm btn-info&quot;&gt;View&lt;/a&gt;</span>
<span class="x">                                    &lt;a href=&quot;{{ route(&#39;users.edit&#39;, $user) }}&quot; class=&quot;btn btn-sm btn-warning&quot;&gt;Edit&lt;/a&gt;</span>
<span class="x">                                    &lt;form action=&quot;{{ route(&#39;users.destroy&#39;, $user) }}&quot; method=&quot;POST&quot; class=&quot;d-inline&quot;&gt;</span>
<span class="x">                                        @csrf</span>
<span class="x">                                        @method(&#39;DELETE&#39;)</span>
<span class="x">                                        &lt;button type=&quot;submit&quot; class=&quot;btn btn-sm btn-danger&quot; onclick=&quot;return confirm(&#39;Are you sure?&#39;)&quot;&gt;Delete&lt;/button&gt;</span>
<span class="x">                                    &lt;/form&gt;</span>
<span class="x">                                &lt;/td&gt;</span>
<span class="x">                            &lt;/tr&gt;</span>
<span class="x">                        @endforeach</span>
<span class="x">                    &lt;/tbody&gt;</span>
<span class="x">                &lt;/table&gt;</span>
<span class="x">            &lt;/div&gt;</span>
<span class="x">        &lt;/div&gt;</span>
<span class="x">    &lt;/div&gt;</span>
<span class="x">@endsection</span>
</code></pre></div>

<h3 id="stacks">Stacks</h3>
<p>Stacks allow you to push content to named stacks that can be rendered elsewhere in the layout:</p>
<div class="codehilite"><pre><span></span><code><span class="x">&lt;!-- In your view --&gt;</span>
<span class="x">@push(&#39;styles&#39;)</span>
<span class="x">    &lt;link rel=&quot;stylesheet&quot; href=&quot;/css/custom.css&quot;&gt;</span>
<span class="x">@endpush</span>

<span class="x">@push(&#39;scripts&#39;)</span>
<span class="x">    &lt;script src=&quot;/js/custom.js&quot;&gt;&lt;/script&gt;</span>
<span class="x">@endpush</span>

<span class="x">&lt;!-- Or prepend content --&gt;</span>
<span class="x">@prepend(&#39;scripts&#39;)</span>
<span class="x">    &lt;script src=&quot;/js/analytics.js&quot;&gt;&lt;/script&gt;</span>
<span class="x">@endprepend</span>
</code></pre></div>

<h2 id="components">Components</h2>
<h3 id="creating-components">Creating Components</h3>
<div class="codehilite"><pre><span></span><code>php<span class="w"> </span>artisan<span class="w"> </span>make:component<span class="w"> </span>Alert
php<span class="w"> </span>artisan<span class="w"> </span>make:component<span class="w"> </span>UserCard<span class="w"> </span>--view
</code></pre></div>

<h3 id="class-based-components">Class-Based Components</h3>
<div class="codehilite"><pre><span></span><code><span class="x">&lt;!-- app/View/Components/Alert.php --&gt;</span>
<span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\View\Components</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\View\Component</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Alert</span> <span class="k">extends</span> <span class="nx">Component</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$type</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$message</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$type</span> <span class="o">=</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="nv">$message</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">type</span> <span class="o">=</span> <span class="nv">$type</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">message</span> <span class="o">=</span> <span class="nv">$message</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">render</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;components.alert&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">isDismissible</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">in_array</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">type</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="s1">&#39;warning&#39;</span><span class="p">,</span> <span class="s1">&#39;danger&#39;</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="x">&lt;!-- resources/views/components/alert.blade.php --&gt;</span>
<span class="x">&lt;div class=&quot;alert alert-{{ $type }} {{ $isDismissible() ? &#39;alert-dismissible fade show&#39; : &#39;&#39; }}&quot; role=&quot;alert&quot;&gt;</span>
<span class="x">    {{ $message }}</span>
<span class="x">    {{ $slot }}</span>

<span class="x">    @if($isDismissible())</span>
<span class="x">        &lt;button type=&quot;button&quot; class=&quot;btn-close&quot; data-bs-dismiss=&quot;alert&quot; aria-label=&quot;Close&quot;&gt;&lt;/button&gt;</span>
<span class="x">    @endif</span>
<span class="x">&lt;/div&gt;</span>
</code></pre></div>

<h3 id="anonymous-components">Anonymous Components</h3>
<div class="codehilite"><pre><span></span><code><span class="x">&lt;!-- resources/views/components/alert.blade.php --&gt;</span>
<span class="x">@props([&#39;type&#39; =&gt; &#39;info&#39;, &#39;dismissible&#39; =&gt; false])</span>

<span class="x">&lt;div class=&quot;alert alert-{{ $type }} {{ $dismissible ? &#39;alert-dismissible fade show&#39; : &#39;&#39; }}&quot; role=&quot;alert&quot;&gt;</span>
<span class="x">    {{ $slot }}</span>

<span class="x">    @if($dismissible)</span>
<span class="x">        &lt;button type=&quot;button&quot; class=&quot;btn-close&quot; data-bs-dismiss=&quot;alert&quot; aria-label=&quot;Close&quot;&gt;&lt;/button&gt;</span>
<span class="x">    @endif</span>
<span class="x">&lt;/div&gt;</span>
</code></pre></div>

<h3 id="using-components">Using Components</h3>
<div class="codehilite"><pre><span></span><code><span class="x">&lt;!-- Class-based component --&gt;</span>
<span class="x">&lt;x-alert type=&quot;success&quot; message=&quot;User created successfully!&quot; /&gt;</span>

<span class="x">&lt;!-- Anonymous component --&gt;</span>
<span class="x">&lt;x-alert type=&quot;danger&quot; dismissible&gt;</span>
<span class="x">    &lt;strong&gt;Error!&lt;/strong&gt; Something went wrong.</span>
<span class="x">&lt;/x-alert&gt;</span>

<span class="x">&lt;!-- With slots --&gt;</span>
<span class="x">&lt;x-card&gt;</span>
<span class="x">    &lt;x-slot name=&quot;header&quot;&gt;</span>
<span class="x">        &lt;h5 class=&quot;card-title&quot;&gt;User Information&lt;/h5&gt;</span>
<span class="x">    &lt;/x-slot&gt;</span>

<span class="x">    &lt;p class=&quot;card-text&quot;&gt;This is the card content.&lt;/p&gt;</span>

<span class="x">    &lt;x-slot name=&quot;footer&quot;&gt;</span>
<span class="x">        &lt;button class=&quot;btn btn-primary&quot;&gt;Save&lt;/button&gt;</span>
<span class="x">    &lt;/x-slot&gt;</span>
<span class="x">&lt;/x-card&gt;</span>
</code></pre></div>

<h2 id="forms">Forms</h2>
<h3 id="csrf-protection">CSRF Protection</h3>
<div class="codehilite"><pre><span></span><code><span class="x">&lt;form method=&quot;POST&quot; action=&quot;{{ route(&#39;users.store&#39;) }}&quot;&gt;</span>
<span class="x">    @csrf</span>
<span class="x">    &lt;!-- form fields --&gt;</span>
<span class="x">&lt;/form&gt;</span>
</code></pre></div>

<h3 id="method-spoofing">Method Spoofing</h3>
<div class="codehilite"><pre><span></span><code><span class="x">&lt;form method=&quot;POST&quot; action=&quot;{{ route(&#39;users.update&#39;, $user) }}&quot;&gt;</span>
<span class="x">    @csrf</span>
<span class="x">    @method(&#39;PUT&#39;)</span>
<span class="x">    &lt;!-- form fields --&gt;</span>
<span class="x">&lt;/form&gt;</span>
</code></pre></div>

<h3 id="form-components">Form Components</h3>
<div class="codehilite"><pre><span></span><code><span class="x">&lt;!-- resources/views/components/form/input.blade.php --&gt;</span>
<span class="x">@props([&#39;name&#39;, &#39;label&#39;, &#39;type&#39; =&gt; &#39;text&#39;, &#39;value&#39; =&gt; &#39;&#39;, &#39;required&#39; =&gt; false])</span>

<span class="x">&lt;div class=&quot;mb-3&quot;&gt;</span>
<span class="x">    &lt;label for=&quot;{{ $name }}&quot; class=&quot;form-label&quot;&gt;{{ $label }}&lt;/label&gt;</span>
<span class="x">    &lt;input </span>
<span class="x">        type=&quot;{{ $type }}&quot; </span>
<span class="x">        class=&quot;form-control @error($name) is-invalid @enderror&quot; </span>
<span class="x">        id=&quot;{{ $name }}&quot; </span>
<span class="x">        name=&quot;{{ $name }}&quot; </span>
<span class="x">        value=&quot;{{ old($name, $value) }}&quot;</span>
<span class="x">        {{ $required ? &#39;required&#39; : &#39;&#39; }}</span>
<span class="x">    &gt;</span>
<span class="x">    @error($name)</span>
<span class="x">        &lt;div class=&quot;invalid-feedback&quot;&gt;</span>
<span class="x">            {{ $message }}</span>
<span class="x">        &lt;/div&gt;</span>
<span class="x">    @enderror</span>
<span class="x">&lt;/div&gt;</span>
</code></pre></div>

<h3 id="using-form-components">Using Form Components</h3>
<div class="codehilite"><pre><span></span><code><span class="x">&lt;!-- resources/views/users/create.blade.php --&gt;</span>
<span class="x">@extends(&#39;layouts.app&#39;)</span>

<span class="x">@section(&#39;content&#39;)</span>
<span class="x">    &lt;div class=&quot;row&quot;&gt;</span>
<span class="x">        &lt;div class=&quot;col-md-8 offset-md-2&quot;&gt;</span>
<span class="x">            &lt;h1&gt;Create User&lt;/h1&gt;</span>

<span class="x">            &lt;form method=&quot;POST&quot; action=&quot;{{ route(&#39;users.store&#39;) }}&quot;&gt;</span>
<span class="x">                @csrf</span>

<span class="x">                &lt;x-form.input name=&quot;name&quot; label=&quot;Name&quot; required /&gt;</span>
<span class="x">                &lt;x-form.input name=&quot;email&quot; label=&quot;Email&quot; type=&quot;email&quot; required /&gt;</span>
<span class="x">                &lt;x-form.input name=&quot;password&quot; label=&quot;Password&quot; type=&quot;password&quot; required /&gt;</span>
<span class="x">                &lt;x-form.input name=&quot;password_confirmation&quot; label=&quot;Confirm Password&quot; type=&quot;password&quot; required /&gt;</span>

<span class="x">                &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary&quot;&gt;Create User&lt;/button&gt;</span>
<span class="x">                &lt;a href=&quot;{{ route(&#39;users.index&#39;) }}&quot; class=&quot;btn btn-secondary&quot;&gt;Cancel&lt;/a&gt;</span>
<span class="x">            &lt;/form&gt;</span>
<span class="x">        &lt;/div&gt;</span>
<span class="x">    &lt;/div&gt;</span>
<span class="x">@endsection</span>
</code></pre></div>

<h2 id="includes-and-partials">Includes and Partials</h2>
<h3 id="include">@include</h3>
<div class="codehilite"><pre><span></span><code><span class="x">@include(&#39;partials.header&#39;)</span>

<span class="x">@include(&#39;partials.footer&#39;, [&#39;year&#39; =&gt; date(&#39;Y&#39;)])</span>

<span class="x">@includeIf(&#39;partials.custom&#39;, [&#39;data&#39; =&gt; $data])</span>

<span class="x">@includeWhen($user-&gt;isAdmin(), &#39;partials.admin-panel&#39;)</span>
</code></pre></div>

<h3 id="includefirst">@includeFirst</h3>
<div class="codehilite"><pre><span></span><code><span class="x">@includeFirst([&#39;partials.custom&#39;, &#39;partials.default&#39;])</span>
</code></pre></div>

<h2 id="custom-directives">Custom Directives</h2>
<h3 id="creating-custom-directives">Creating Custom Directives</h3>
<div class="codehilite"><pre><span></span><code><span class="x">&lt;!-- app/Providers/AppServiceProvider.php --&gt;</span>
<span class="x">use Illuminate\Support\Facades\Blade;</span>

<span class="x">public function boot()</span>
<span class="x">{</span>
<span class="x">    Blade::directive(&#39;datetime&#39;, function ($expression) {</span>
<span class="x">        return &quot;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="p">(</span><span class="nv">$expression</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="s1">&#39;M d, Y H:i:s&#39;</span><span class="p">);</span> <span class="cp">?&gt;</span><span class="x">&quot;;</span>
<span class="x">    });</span>

<span class="x">    Blade::directive(&#39;money&#39;, function ($expression) {</span>
<span class="x">        return &quot;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="s1">&#39;$&#39;</span> <span class="o">.</span> <span class="nb">number_format</span><span class="p">(</span><span class="nv">$expression</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span> <span class="cp">?&gt;</span><span class="x">&quot;;</span>
<span class="x">    });</span>

<span class="x">    Blade::if(&#39;admin&#39;, function () {</span>
<span class="x">        return auth()-&gt;check() &amp;&amp; auth()-&gt;user()-&gt;isAdmin();</span>
<span class="x">    });</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="using-custom-directives">Using Custom Directives</h3>
<div class="codehilite"><pre><span></span><code><span class="x">&lt;p&gt;Created: @datetime($user-&gt;created_at)&lt;/p&gt;</span>
<span class="x">&lt;p&gt;Price: @money($product-&gt;price)&lt;/p&gt;</span>

<span class="x">@admin</span>
<span class="x">    &lt;p&gt;This content is only visible to admins.&lt;/p&gt;</span>
<span class="x">@endadmin</span>
</code></pre></div>

<h2 id="raw-php">Raw PHP</h2>
<h3 id="php-directive">@php Directive</h3>
<div class="codehilite"><pre><span></span><code><span class="x">@php</span>
<span class="x">    $users = App\Models\User::all();</span>
<span class="x">    $count = $users-&gt;count();</span>
<span class="x">@endphp</span>

<span class="x">&lt;p&gt;Total users: {{ $count }}&lt;/p&gt;</span>
</code></pre></div>

<h2 id="error-handling">Error Handling</h2>
<h3 id="displaying-errors">Displaying Errors</h3>
<div class="codehilite"><pre><span></span><code><span class="x">@if($errors-&gt;any())</span>
<span class="x">    &lt;div class=&quot;alert alert-danger&quot;&gt;</span>
<span class="x">        &lt;ul class=&quot;mb-0&quot;&gt;</span>
<span class="x">            @foreach($errors-&gt;all() as $error)</span>
<span class="x">                &lt;li&gt;{{ $error }}&lt;/li&gt;</span>
<span class="x">            @endforeach</span>
<span class="x">        &lt;/ul&gt;</span>
<span class="x">    &lt;/div&gt;</span>
<span class="x">@endif</span>

<span class="x">&lt;!-- For specific fields --&gt;</span>
<span class="x">@error(&#39;email&#39;)</span>
<span class="x">    &lt;div class=&quot;text-danger&quot;&gt;{{ $message }}&lt;/div&gt;</span>
<span class="x">@enderror</span>
</code></pre></div>

<h3 id="old-input">Old Input</h3>
<div class="codehilite"><pre><span></span><code><span class="x">&lt;input type=&quot;text&quot; name=&quot;name&quot; value=&quot;{{ old(&#39;name&#39;, $user-&gt;name ?? &#39;&#39;) }}&quot;&gt;</span>
</code></pre></div>

<h2 id="best-practices">Best Practices</h2>
<h3 id="1-keep-views-simple">1. Keep Views Simple</h3>
<div class="codehilite"><pre><span></span><code><span class="x">&lt;!-- Good --&gt;</span>
<span class="x">@foreach($users as $user)</span>
<span class="x">    &lt;x-user-card :user=&quot;$user&quot; /&gt;</span>
<span class="x">@endforeach</span>

<span class="x">&lt;!-- Bad --&gt;</span>
<span class="x">@foreach($users as $user)</span>
<span class="x">    &lt;div class=&quot;card&quot;&gt;</span>
<span class="x">        &lt;div class=&quot;card-body&quot;&gt;</span>
<span class="x">            &lt;h5 class=&quot;card-title&quot;&gt;{{ $user-&gt;name }}&lt;/h5&gt;</span>
<span class="x">            &lt;p class=&quot;card-text&quot;&gt;{{ $user-&gt;email }}&lt;/p&gt;</span>
<span class="x">            &lt;!-- Lots of HTML --&gt;</span>
<span class="x">        &lt;/div&gt;</span>
<span class="x">    &lt;/div&gt;</span>
<span class="x">@endforeach</span>
</code></pre></div>

<h3 id="2-use-components-for-reusable-ui">2. Use Components for Reusable UI</h3>
<div class="codehilite"><pre><span></span><code><span class="x">&lt;!-- Create reusable components --&gt;</span>
<span class="x">&lt;x-button type=&quot;submit&quot; variant=&quot;primary&quot;&gt;Save&lt;/x-button&gt;</span>
<span class="x">&lt;x-modal title=&quot;Delete User&quot; id=&quot;deleteModal&quot;&gt;</span>
<span class="x">    Are you sure you want to delete this user?</span>
<span class="x">&lt;/x-modal&gt;</span>
</code></pre></div>

<h3 id="3-organize-views-properly">3. Organize Views Properly</h3>
<div class="codehilite"><pre><span></span><code><span class="nv">resources</span><span class="o">/</span><span class="nv">views</span><span class="o">/</span>
├──<span class="w"> </span><span class="nv">layouts</span><span class="o">/</span>
│<span class="w">   </span>├──<span class="w"> </span><span class="nv">app</span>.<span class="nv">blade</span>.<span class="nv">php</span>
│<span class="w">   </span>└──<span class="w"> </span><span class="nv">admin</span>.<span class="nv">blade</span>.<span class="nv">php</span>
├──<span class="w"> </span><span class="nv">components</span><span class="o">/</span>
│<span class="w">   </span>├──<span class="w"> </span><span class="nv">alert</span>.<span class="nv">blade</span>.<span class="nv">php</span>
│<span class="w">   </span>├──<span class="w"> </span><span class="nv">button</span>.<span class="nv">blade</span>.<span class="nv">php</span>
│<span class="w">   </span>└──<span class="w"> </span><span class="nv">modal</span>.<span class="nv">blade</span>.<span class="nv">php</span>
├──<span class="w"> </span><span class="nv">partials</span><span class="o">/</span>
│<span class="w">   </span>├──<span class="w"> </span><span class="nv">header</span>.<span class="nv">blade</span>.<span class="nv">php</span>
│<span class="w">   </span>└──<span class="w"> </span><span class="nv">footer</span>.<span class="nv">blade</span>.<span class="nv">php</span>
├──<span class="w"> </span><span class="nv">users</span><span class="o">/</span>
│<span class="w">   </span>├──<span class="w"> </span><span class="nv">index</span>.<span class="nv">blade</span>.<span class="nv">php</span>
│<span class="w">   </span>├──<span class="w"> </span><span class="k">show</span>.<span class="nv">blade</span>.<span class="nv">php</span>
│<span class="w">   </span>├──<span class="w"> </span><span class="nv">create</span>.<span class="nv">blade</span>.<span class="nv">php</span>
│<span class="w">   </span>└──<span class="w"> </span><span class="nv">edit</span>.<span class="nv">blade</span>.<span class="nv">php</span>
└──<span class="w"> </span><span class="nv">posts</span><span class="o">/</span>
<span class="w">    </span>├──<span class="w"> </span><span class="nv">index</span>.<span class="nv">blade</span>.<span class="nv">php</span>
<span class="w">    </span>└──<span class="w"> </span><span class="k">show</span>.<span class="nv">blade</span>.<span class="nv">php</span>
</code></pre></div>

<h3 id="4-use-view-composers-for-shared-data">4. Use View Composers for Shared Data</h3>
<div class="codehilite"><pre><span></span><code><span class="x">&lt;!-- app/Providers/AppServiceProvider.php --&gt;</span>
<span class="x">use Illuminate\Support\Facades\View;</span>

<span class="x">public function boot()</span>
<span class="x">{</span>
<span class="x">    View::composer(&#39;*&#39;, function ($view) {</span>
<span class="x">        $view-&gt;with(&#39;currentUser&#39;, auth()-&gt;user());</span>
<span class="x">    });</span>

<span class="x">    View::composer(&#39;layouts.app&#39;, function ($view) {</span>
<span class="x">        $view-&gt;with(&#39;categories&#39;, Category::all());</span>
<span class="x">    });</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="5-cache-views-in-production">5. Cache Views in Production</h3>
<div class="codehilite"><pre><span></span><code>php<span class="w"> </span>artisan<span class="w"> </span>view:cache
</code></pre></div>

<h2 id="summary">Summary</h2>
<p>In this chapter, we covered:</p>
<ul>
<li>✅ Basic Blade syntax and directives</li>
<li>✅ Conditional statements and loops</li>
<li>✅ Layouts and sections</li>
<li>✅ Components (class-based and anonymous)</li>
<li>✅ Forms and CSRF protection</li>
<li>✅ Includes and partials</li>
<li>✅ Custom directives</li>
<li>✅ Error handling</li>
<li>✅ Best practices for Blade templates</li>
</ul>
<p>Blade provides a powerful and elegant way to create dynamic views in Laravel. In the next chapter, we'll explore Eloquent ORM for working with databases.</p></div><div class="chapter" id="06-eloquent"><h1 id="chapter-6-eloquent-orm">Chapter 6: Eloquent ORM</h1>
<h2 id="what-is-eloquent">What is Eloquent?</h2>
<p>Eloquent is Laravel's Object-Relational Mapping (ORM) system. It provides an elegant, simple ActiveRecord implementation for working with your database. Each database table has a corresponding "Model" which is used to interact with that table.</p>
<h2 id="creating-models">Creating Models</h2>
<h3 id="using-artisan-command">Using Artisan Command</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Basic model</span>
php<span class="w"> </span>artisan<span class="w"> </span>make:model<span class="w"> </span>User

<span class="c1"># Model with migration</span>
php<span class="w"> </span>artisan<span class="w"> </span>make:model<span class="w"> </span>Post<span class="w"> </span>-m

<span class="c1"># Model with migration and factory</span>
php<span class="w"> </span>artisan<span class="w"> </span>make:model<span class="w"> </span>Comment<span class="w"> </span>-mf

<span class="c1"># Model with migration, factory, and seeder</span>
php<span class="w"> </span>artisan<span class="w"> </span>make:model<span class="w"> </span>Category<span class="w"> </span>-mfs

<span class="c1"># Model with controller</span>
php<span class="w"> </span>artisan<span class="w"> </span>make:model<span class="w"> </span>Product<span class="w"> </span>-c

<span class="c1"># Model with resource controller</span>
php<span class="w"> </span>artisan<span class="w"> </span>make:model<span class="w"> </span>Order<span class="w"> </span>-cr
</code></pre></div>

<h3 id="basic-model-structure">Basic Model Structure</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Factories\HasFactory</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">HasFactory</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * The attributes that are mass assignable.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$fillable</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;name&#39;</span><span class="p">,</span>
        <span class="s1">&#39;email&#39;</span><span class="p">,</span>
        <span class="s1">&#39;password&#39;</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="sd">/**</span>
<span class="sd">     * The attributes that should be hidden for serialization.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$hidden</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;password&#39;</span><span class="p">,</span>
        <span class="s1">&#39;remember_token&#39;</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="sd">/**</span>
<span class="sd">     * The attributes that should be cast.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$casts</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;email_verified_at&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;datetime&#39;</span><span class="p">,</span>
        <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;hashed&#39;</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="model-configuration">Model Configuration</h2>
<h3 id="table-name">Table Name</h3>
<p>By default, Eloquent assumes the table name is the plural form of the model name:</p>
<div class="codehilite"><pre><span></span><code><span class="x">class User extends Model</span>
<span class="x">{</span>
<span class="x">    // Table: users</span>
<span class="x">}</span>

<span class="x">class Post extends Model</span>
<span class="x">{</span>
<span class="x">    // Table: posts</span>
<span class="x">}</span>

<span class="x">// Custom table name</span>
<span class="x">class Post extends Model</span>
<span class="x">{</span>
<span class="x">    protected $table = &#39;blog_posts&#39;;</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="primary-key">Primary Key</h3>
<div class="codehilite"><pre><span></span><code><span class="x">class User extends Model</span>
<span class="x">{</span>
<span class="x">    // Default: &#39;id&#39;</span>

<span class="x">    // Custom primary key</span>
<span class="x">    protected $primaryKey = &#39;user_id&#39;;</span>

<span class="x">    // Disable auto-incrementing</span>
<span class="x">    public $incrementing = false;</span>

<span class="x">    // Custom key type</span>
<span class="x">    protected $keyType = &#39;string&#39;;</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="timestamps">Timestamps</h3>
<div class="codehilite"><pre><span></span><code><span class="x">class User extends Model</span>
<span class="x">{</span>
<span class="x">    // Default: true</span>

<span class="x">    // Disable timestamps</span>
<span class="x">    public $timestamps = false;</span>

<span class="x">    // Custom timestamp column names</span>
<span class="x">    const CREATED_AT = &#39;created_date&#39;;</span>
<span class="x">    const UPDATED_AT = &#39;updated_date&#39;;</span>
<span class="x">}</span>
</code></pre></div>

<h2 id="mass-assignment">Mass Assignment</h2>
<h3 id="fillable-attributes">Fillable Attributes</h3>
<div class="codehilite"><pre><span></span><code><span class="x">class User extends Model</span>
<span class="x">{</span>
<span class="x">    protected $fillable = [</span>
<span class="x">        &#39;name&#39;,</span>
<span class="x">        &#39;email&#39;,</span>
<span class="x">        &#39;password&#39;,</span>
<span class="x">    ];</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="guarded-attributes">Guarded Attributes</h3>
<div class="codehilite"><pre><span></span><code><span class="x">class User extends Model</span>
<span class="x">{</span>
<span class="x">    // Guard all attributes except specified ones</span>
<span class="x">    protected $guarded = [&#39;id&#39;];</span>

<span class="x">    // Or guard specific attributes</span>
<span class="x">    protected $guarded = [&#39;id&#39;, &#39;admin&#39;];</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="assignment-methods">Assignment Methods</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Using fillable/guarded</span>
<span class="x">$user = new User();</span>
<span class="x">$user-&gt;fill([</span>
<span class="x">    &#39;name&#39; =&gt; &#39;John Doe&#39;,</span>
<span class="x">    &#39;email&#39; =&gt; &#39;john@example.com&#39;,</span>
<span class="x">]);</span>

<span class="x">// Force assignment (bypasses fillable/guarded)</span>
<span class="x">$user-&gt;forceFill([</span>
<span class="x">    &#39;admin&#39; =&gt; true,</span>
<span class="x">]);</span>
</code></pre></div>

<h2 id="attribute-casting">Attribute Casting</h2>
<h3 id="basic-casting">Basic Casting</h3>
<div class="codehilite"><pre><span></span><code><span class="x">class User extends Model</span>
<span class="x">{</span>
<span class="x">    protected $casts = [</span>
<span class="x">        &#39;is_active&#39; =&gt; &#39;boolean&#39;,</span>
<span class="x">        &#39;age&#39; =&gt; &#39;integer&#39;,</span>
<span class="x">        &#39;height&#39; =&gt; &#39;float&#39;,</span>
<span class="x">        &#39;settings&#39; =&gt; &#39;array&#39;,</span>
<span class="x">        &#39;metadata&#39; =&gt; &#39;object&#39;,</span>
<span class="x">        &#39;birth_date&#39; =&gt; &#39;date&#39;,</span>
<span class="x">        &#39;last_login&#39; =&gt; &#39;datetime&#39;,</span>
<span class="x">        &#39;email_verified_at&#39; =&gt; &#39;datetime&#39;,</span>
<span class="x">    ];</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="custom-casting">Custom Casting</h3>
<div class="codehilite"><pre><span></span><code><span class="x">class User extends Model</span>
<span class="x">{</span>
<span class="x">    protected $casts = [</span>
<span class="x">        &#39;settings&#39; =&gt; &#39;array&#39;,</span>
<span class="x">        &#39;preferences&#39; =&gt; &#39;object&#39;,</span>
<span class="x">        &#39;birth_date&#39; =&gt; &#39;date:Y-m-d&#39;,</span>
<span class="x">        &#39;last_login&#39; =&gt; &#39;datetime:Y-m-d H:i:s&#39;,</span>
<span class="x">    ];</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="value-object-casting">Value Object Casting</h3>
<div class="codehilite"><pre><span></span><code><span class="x">class User extends Model</span>
<span class="x">{</span>
<span class="x">    protected $casts = [</span>
<span class="x">        &#39;address&#39; =&gt; Address::class,</span>
<span class="x">        &#39;money&#39; =&gt; Money::class,</span>
<span class="x">    ];</span>
<span class="x">}</span>
</code></pre></div>

<h2 id="accessors-and-mutators">Accessors and Mutators</h2>
<h3 id="accessors">Accessors</h3>
<div class="codehilite"><pre><span></span><code><span class="x">class User extends Model</span>
<span class="x">{</span>
<span class="x">    // Get full name attribute</span>
<span class="x">    public function getFullNameAttribute()</span>
<span class="x">    {</span>
<span class="x">        return &quot;{$this-&gt;first_name} {$this-&gt;last_name}&quot;;</span>
<span class="x">    }</span>

<span class="x">    // Get formatted email attribute</span>
<span class="x">    public function getFormattedEmailAttribute()</span>
<span class="x">    {</span>
<span class="x">        return strtolower($this-&gt;email);</span>
<span class="x">    }</span>

<span class="x">    // Get age attribute</span>
<span class="x">    public function getAgeAttribute()</span>
<span class="x">    {</span>
<span class="x">        return $this-&gt;birth_date-&gt;age;</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="mutators">Mutators</h3>
<div class="codehilite"><pre><span></span><code><span class="x">class User extends Model</span>
<span class="x">{</span>
<span class="x">    // Set name attribute</span>
<span class="x">    public function setNameAttribute($value)</span>
<span class="x">    {</span>
<span class="x">        $this-&gt;attributes[&#39;name&#39;] = strtolower($value);</span>
<span class="x">    }</span>

<span class="x">    // Set email attribute</span>
<span class="x">    public function setEmailAttribute($value)</span>
<span class="x">    {</span>
<span class="x">        $this-&gt;attributes[&#39;email&#39;] = strtolower($value);</span>
<span class="x">    }</span>

<span class="x">    // Set password attribute</span>
<span class="x">    public function setPasswordAttribute($value)</span>
<span class="x">    {</span>
<span class="x">        $this-&gt;attributes[&#39;password&#39;] = Hash::make($value);</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="attribute-casting-with-accessorsmutators">Attribute Casting with Accessors/Mutators</h3>
<div class="codehilite"><pre><span></span><code><span class="x">class User extends Model</span>
<span class="x">{</span>
<span class="x">    protected $casts = [</span>
<span class="x">        &#39;settings&#39; =&gt; &#39;array&#39;,</span>
<span class="x">    ];</span>

<span class="x">    public function getSettingsAttribute($value)</span>
<span class="x">    {</span>
<span class="x">        $settings = json_decode($value, true);</span>
<span class="x">        return array_merge([</span>
<span class="x">            &#39;theme&#39; =&gt; &#39;light&#39;,</span>
<span class="x">            &#39;notifications&#39; =&gt; true,</span>
<span class="x">        ], $settings ?? []);</span>
<span class="x">    }</span>

<span class="x">    public function setSettingsAttribute($value)</span>
<span class="x">    {</span>
<span class="x">        $this-&gt;attributes[&#39;settings&#39;] = json_encode($value);</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h2 id="eloquent-relationships">Eloquent Relationships</h2>
<h3 id="one-to-one">One-to-One</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// User has one Profile</span>
<span class="x">class User extends Model</span>
<span class="x">{</span>
<span class="x">    public function profile()</span>
<span class="x">    {</span>
<span class="x">        return $this-&gt;hasOne(Profile::class);</span>
<span class="x">    }</span>
<span class="x">}</span>

<span class="x">// Profile belongs to User</span>
<span class="x">class Profile extends Model</span>
<span class="x">{</span>
<span class="x">    public function user()</span>
<span class="x">    {</span>
<span class="x">        return $this-&gt;belongsTo(User::class);</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="one-to-many">One-to-Many</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// User has many Posts</span>
<span class="x">class User extends Model</span>
<span class="x">{</span>
<span class="x">    public function posts()</span>
<span class="x">    {</span>
<span class="x">        return $this-&gt;hasMany(Post::class);</span>
<span class="x">    }</span>
<span class="x">}</span>

<span class="x">// Post belongs to User</span>
<span class="x">class Post extends Model</span>
<span class="x">{</span>
<span class="x">    public function user()</span>
<span class="x">    {</span>
<span class="x">        return $this-&gt;belongsTo(User::class);</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="many-to-many">Many-to-Many</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// User has many Roles</span>
<span class="x">class User extends Model</span>
<span class="x">{</span>
<span class="x">    public function roles()</span>
<span class="x">    {</span>
<span class="x">        return $this-&gt;belongsToMany(Role::class);</span>
<span class="x">    }</span>
<span class="x">}</span>

<span class="x">// Role has many Users</span>
<span class="x">class Role extends Model</span>
<span class="x">{</span>
<span class="x">    public function users()</span>
<span class="x">    {</span>
<span class="x">        return $this-&gt;belongsToMany(User::class);</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="has-many-through">Has Many Through</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Country has many Posts through Users</span>
<span class="x">class Country extends Model</span>
<span class="x">{</span>
<span class="x">    public function posts()</span>
<span class="x">    {</span>
<span class="x">        return $this-&gt;hasManyThrough(Post::class, User::class);</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="polymorphic-relationships">Polymorphic Relationships</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Post has many Comments</span>
<span class="x">class Post extends Model</span>
<span class="x">{</span>
<span class="x">    public function comments()</span>
<span class="x">    {</span>
<span class="x">        return $this-&gt;morphMany(Comment::class, &#39;commentable&#39;);</span>
<span class="x">    }</span>
<span class="x">}</span>

<span class="x">// Video has many Comments</span>
<span class="x">class Video extends Model</span>
<span class="x">{</span>
<span class="x">    public function comments()</span>
<span class="x">    {</span>
<span class="x">        return $this-&gt;morphMany(Comment::class, &#39;commentable&#39;);</span>
<span class="x">    }</span>
<span class="x">}</span>

<span class="x">// Comment belongs to Post or Video</span>
<span class="x">class Comment extends Model</span>
<span class="x">{</span>
<span class="x">    public function commentable()</span>
<span class="x">    {</span>
<span class="x">        return $this-&gt;morphTo();</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h2 id="querying-with-eloquent">Querying with Eloquent</h2>
<h3 id="basic-queries">Basic Queries</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Get all users</span>
<span class="x">$users = User::all();</span>

<span class="x">// Find by ID</span>
<span class="x">$user = User::find(1);</span>
<span class="x">$user = User::findOrFail(1);</span>

<span class="x">// Find by column</span>
<span class="x">$user = User::where(&#39;email&#39;, &#39;john@example.com&#39;)-&gt;first();</span>
<span class="x">$user = User::where(&#39;email&#39;, &#39;john@example.com&#39;)-&gt;firstOrFail();</span>

<span class="x">// Get first user</span>
<span class="x">$user = User::first();</span>

<span class="x">// Get last user</span>
<span class="x">$user = User::latest()-&gt;first();</span>
</code></pre></div>

<h3 id="where-clauses">Where Clauses</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Basic where</span>
<span class="x">$users = User::where(&#39;active&#39;, true)-&gt;get();</span>

<span class="x">// Multiple conditions</span>
<span class="x">$users = User::where(&#39;active&#39;, true)</span>
<span class="x">    -&gt;where(&#39;age&#39;, &#39;&gt;&#39;, 18)</span>
<span class="x">    -&gt;get();</span>

<span class="x">// OR conditions</span>
<span class="x">$users = User::where(&#39;active&#39;, true)</span>
<span class="x">    -&gt;orWhere(&#39;admin&#39;, true)</span>
<span class="x">    -&gt;get();</span>

<span class="x">// Where in</span>
<span class="x">$users = User::whereIn(&#39;id&#39;, [1, 2, 3])-&gt;get();</span>

<span class="x">// Where between</span>
<span class="x">$users = User::whereBetween(&#39;created_at&#39;, [</span>
<span class="x">    &#39;2023-01-01&#39;,</span>
<span class="x">    &#39;2023-12-31&#39;</span>
<span class="x">])-&gt;get();</span>

<span class="x">// Where null</span>
<span class="x">$users = User::whereNull(&#39;email_verified_at&#39;)-&gt;get();</span>

<span class="x">// Where not null</span>
<span class="x">$users = User::whereNotNull(&#39;email_verified_at&#39;)-&gt;get();</span>
</code></pre></div>

<h3 id="ordering-and-limiting">Ordering and Limiting</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Order by</span>
<span class="x">$users = User::orderBy(&#39;name&#39;, &#39;asc&#39;)-&gt;get();</span>
<span class="x">$users = User::orderBy(&#39;created_at&#39;, &#39;desc&#39;)-&gt;get();</span>

<span class="x">// Latest/oldest</span>
<span class="x">$users = User::latest()-&gt;get();</span>
<span class="x">$users = User::oldest()-&gt;get();</span>

<span class="x">// Limit</span>
<span class="x">$users = User::limit(10)-&gt;get();</span>

<span class="x">// Offset</span>
<span class="x">$users = User::offset(10)-&gt;limit(10)-&gt;get();</span>

<span class="x">// Skip and take</span>
<span class="x">$users = User::skip(10)-&gt;take(10)-&gt;get();</span>
</code></pre></div>

<h3 id="aggregates">Aggregates</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Count</span>
<span class="x">$count = User::count();</span>
<span class="x">$count = User::where(&#39;active&#39;, true)-&gt;count();</span>

<span class="x">// Sum</span>
<span class="x">$total = Order::sum(&#39;total&#39;);</span>

<span class="x">// Average</span>
<span class="x">$average = Order::avg(&#39;total&#39;);</span>

<span class="x">// Min/Max</span>
<span class="x">$min = Order::min(&#39;total&#39;);</span>
<span class="x">$max = Order::max(&#39;total&#39;);</span>
</code></pre></div>

<h3 id="eager-loading">Eager Loading</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Load relationships</span>
<span class="x">$users = User::with(&#39;posts&#39;)-&gt;get();</span>

<span class="x">// Load multiple relationships</span>
<span class="x">$users = User::with([&#39;posts&#39;, &#39;profile&#39;])-&gt;get();</span>

<span class="x">// Load nested relationships</span>
<span class="x">$users = User::with(&#39;posts.comments&#39;)-&gt;get();</span>

<span class="x">// Conditional eager loading</span>
<span class="x">$users = User::with([&#39;posts&#39; =&gt; function ($query) {</span>
<span class="x">    $query-&gt;where(&#39;published&#39;, true);</span>
<span class="x">}])-&gt;get();</span>

<span class="x">// Lazy eager loading</span>
<span class="x">$users = User::all();</span>
<span class="x">$users-&gt;load(&#39;posts&#39;);</span>
</code></pre></div>

<h2 id="crud-operations">CRUD Operations</h2>
<h3 id="creating-records">Creating Records</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Create single record</span>
<span class="x">$user = User::create([</span>
<span class="x">    &#39;name&#39; =&gt; &#39;John Doe&#39;,</span>
<span class="x">    &#39;email&#39; =&gt; &#39;john@example.com&#39;,</span>
<span class="x">    &#39;password&#39; =&gt; Hash::make(&#39;password&#39;),</span>
<span class="x">]);</span>

<span class="x">// Create multiple records</span>
<span class="x">$users = User::createMany([</span>
<span class="x">    [&#39;name&#39; =&gt; &#39;John&#39;, &#39;email&#39; =&gt; &#39;john@example.com&#39;],</span>
<span class="x">    [&#39;name&#39; =&gt; &#39;Jane&#39;, &#39;email&#39; =&gt; &#39;jane@example.com&#39;],</span>
<span class="x">]);</span>

<span class="x">// Create or update</span>
<span class="x">$user = User::updateOrCreate(</span>
<span class="x">    [&#39;email&#39; =&gt; &#39;john@example.com&#39;],</span>
<span class="x">    [&#39;name&#39; =&gt; &#39;John Doe&#39;, &#39;active&#39; =&gt; true]</span>
<span class="x">);</span>

<span class="x">// First or create</span>
<span class="x">$user = User::firstOrCreate(</span>
<span class="x">    [&#39;email&#39; =&gt; &#39;john@example.com&#39;],</span>
<span class="x">    [&#39;name&#39; =&gt; &#39;John Doe&#39;]</span>
<span class="x">);</span>
</code></pre></div>

<h3 id="updating-records">Updating Records</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Update single record</span>
<span class="x">$user = User::find(1);</span>
<span class="x">$user-&gt;update([&#39;name&#39; =&gt; &#39;Jane Doe&#39;]);</span>

<span class="x">// Update multiple records</span>
<span class="x">User::where(&#39;active&#39;, false)-&gt;update([&#39;status&#39; =&gt; &#39;inactive&#39;]);</span>

<span class="x">// Update or create</span>
<span class="x">$user = User::updateOrCreate(</span>
<span class="x">    [&#39;email&#39; =&gt; &#39;john@example.com&#39;],</span>
<span class="x">    [&#39;name&#39; =&gt; &#39;John Doe&#39;]</span>
<span class="x">);</span>
</code></pre></div>

<h3 id="deleting-records">Deleting Records</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Delete single record</span>
<span class="x">$user = User::find(1);</span>
<span class="x">$user-&gt;delete();</span>

<span class="x">// Delete by ID</span>
<span class="x">User::destroy(1);</span>
<span class="x">User::destroy([1, 2, 3]);</span>

<span class="x">// Delete with conditions</span>
<span class="x">User::where(&#39;active&#39;, false)-&gt;delete();</span>

<span class="x">// Soft delete (if model uses SoftDeletes trait)</span>
<span class="x">$user-&gt;delete(); // Sets deleted_at timestamp</span>
</code></pre></div>

<h2 id="soft-deletes">Soft Deletes</h2>
<h3 id="using-soft-deletes">Using Soft Deletes</h3>
<div class="codehilite"><pre><span></span><code><span class="x">use Illuminate\Database\Eloquent\SoftDeletes;</span>

<span class="x">class User extends Model</span>
<span class="x">{</span>
<span class="x">    use SoftDeletes;</span>

<span class="x">    protected $dates = [&#39;deleted_at&#39;];</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="soft-delete-operations">Soft Delete Operations</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Soft delete</span>
<span class="x">$user-&gt;delete();</span>

<span class="x">// Force delete</span>
<span class="x">$user-&gt;forceDelete();</span>

<span class="x">// Restore soft deleted record</span>
<span class="x">$user-&gt;restore();</span>

<span class="x">// Get only soft deleted records</span>
<span class="x">$deletedUsers = User::onlyTrashed()-&gt;get();</span>

<span class="x">// Get all records including soft deleted</span>
<span class="x">$allUsers = User::withTrashed()-&gt;get();</span>
</code></pre></div>

<h2 id="model-events">Model Events</h2>
<h3 id="available-events">Available Events</h3>
<div class="codehilite"><pre><span></span><code><span class="x">class User extends Model</span>
<span class="x">{</span>
<span class="x">    protected static function booted()</span>
<span class="x">    {</span>
<span class="x">        // Creating, created</span>
<span class="x">        static::creating(function ($user) {</span>
<span class="x">            $user-&gt;slug = Str::slug($user-&gt;name);</span>
<span class="x">        });</span>

<span class="x">        // Updating, updated</span>
<span class="x">        static::updating(function ($user) {</span>
<span class="x">            $user-&gt;updated_count++;</span>
<span class="x">        });</span>

<span class="x">        // Deleting, deleted</span>
<span class="x">        static::deleting(function ($user) {</span>
<span class="x">            // Cleanup related data</span>
<span class="x">        });</span>

<span class="x">        // Saving, saved</span>
<span class="x">        static::saving(function ($user) {</span>
<span class="x">            // Before save</span>
<span class="x">        });</span>

<span class="x">        // Restoring, restored</span>
<span class="x">        static::restoring(function ($user) {</span>
<span class="x">            // Before restore</span>
<span class="x">        });</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="observers">Observers</h3>
<div class="codehilite"><pre><span></span><code>php<span class="w"> </span>artisan<span class="w"> </span>make:observer<span class="w"> </span>UserObserver<span class="w"> </span>--model<span class="o">=</span>User
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="x">class UserObserver</span>
<span class="x">{</span>
<span class="x">    public function created(User $user)</span>
<span class="x">    {</span>
<span class="x">        // Send welcome email</span>
<span class="x">    }</span>

<span class="x">    public function updated(User $user)</span>
<span class="x">    {</span>
<span class="x">        // Log changes</span>
<span class="x">    }</span>

<span class="x">    public function deleted(User $user)</span>
<span class="x">    {</span>
<span class="x">        // Cleanup</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<p>Register in <code>AppServiceProvider</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="x">public function boot()</span>
<span class="x">{</span>
<span class="x">    User::observe(UserObserver::class);</span>
<span class="x">}</span>
</code></pre></div>

<h2 id="scopes">Scopes</h2>
<h3 id="local-scopes">Local Scopes</h3>
<div class="codehilite"><pre><span></span><code><span class="x">class User extends Model</span>
<span class="x">{</span>
<span class="x">    public function scopeActive($query)</span>
<span class="x">    {</span>
<span class="x">        return $query-&gt;where(&#39;active&#39;, true);</span>
<span class="x">    }</span>

<span class="x">    public function scopeOlderThan($query, $age)</span>
<span class="x">    {</span>
<span class="x">        return $query-&gt;where(&#39;age&#39;, &#39;&gt;&#39;, $age);</span>
<span class="x">    }</span>

<span class="x">    public function scopeByRole($query, $role)</span>
<span class="x">    {</span>
<span class="x">        return $query-&gt;whereHas(&#39;roles&#39;, function ($q) use ($role) {</span>
<span class="x">            $q-&gt;where(&#39;name&#39;, $role);</span>
<span class="x">        });</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="global-scopes">Global Scopes</h3>
<div class="codehilite"><pre><span></span><code><span class="x">class ActiveScope implements Scope</span>
<span class="x">{</span>
<span class="x">    public function apply(Builder $builder, Model $model)</span>
<span class="x">    {</span>
<span class="x">        $builder-&gt;where(&#39;active&#39;, true);</span>
<span class="x">    }</span>
<span class="x">}</span>

<span class="x">class User extends Model</span>
<span class="x">{</span>
<span class="x">    protected static function booted()</span>
<span class="x">    {</span>
<span class="x">        static::addGlobalScope(new ActiveScope);</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h2 id="model-factories">Model Factories</h2>
<h3 id="creating-factories">Creating Factories</h3>
<div class="codehilite"><pre><span></span><code>php<span class="w"> </span>artisan<span class="w"> </span>make:factory<span class="w"> </span>UserFactory
</code></pre></div>

<h3 id="defining-factories">Defining Factories</h3>
<div class="codehilite"><pre><span></span><code><span class="x">class UserFactory extends Factory</span>
<span class="x">{</span>
<span class="x">    public function definition()</span>
<span class="x">    {</span>
<span class="x">        return [</span>
<span class="x">            &#39;name&#39; =&gt; $this-&gt;faker-&gt;name(),</span>
<span class="x">            &#39;email&#39; =&gt; $this-&gt;faker-&gt;unique()-&gt;safeEmail(),</span>
<span class="x">            &#39;email_verified_at&#39; =&gt; now(),</span>
<span class="x">            &#39;password&#39; =&gt; Hash::make(&#39;password&#39;),</span>
<span class="x">            &#39;remember_token&#39; =&gt; Str::random(10),</span>
<span class="x">        ];</span>
<span class="x">    }</span>

<span class="x">    public function unverified()</span>
<span class="x">    {</span>
<span class="x">        return $this-&gt;state(function (array $attributes) {</span>
<span class="x">            return [</span>
<span class="x">                &#39;email_verified_at&#39; =&gt; null,</span>
<span class="x">            ];</span>
<span class="x">        });</span>
<span class="x">    }</span>

<span class="x">    public function admin()</span>
<span class="x">    {</span>
<span class="x">        return $this-&gt;state(function (array $attributes) {</span>
<span class="x">            return [</span>
<span class="x">                &#39;is_admin&#39; =&gt; true,</span>
<span class="x">            ];</span>
<span class="x">        });</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="using-factories">Using Factories</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Create single user</span>
<span class="x">$user = User::factory()-&gt;create();</span>

<span class="x">// Create user with specific attributes</span>
<span class="x">$user = User::factory()-&gt;create([</span>
<span class="x">    &#39;name&#39; =&gt; &#39;John Doe&#39;,</span>
<span class="x">    &#39;email&#39; =&gt; &#39;john@example.com&#39;,</span>
<span class="x">]);</span>

<span class="x">// Create multiple users</span>
<span class="x">$users = User::factory()-&gt;count(10)-&gt;create();</span>

<span class="x">// Create user with relationships</span>
<span class="x">$user = User::factory()</span>
<span class="x">    -&gt;has(Post::factory()-&gt;count(3))</span>
<span class="x">    -&gt;create();</span>

<span class="x">// Create user with state</span>
<span class="x">$user = User::factory()-&gt;unverified()-&gt;create();</span>
<span class="x">$admin = User::factory()-&gt;admin()-&gt;create();</span>
</code></pre></div>

<h2 id="best-practices">Best Practices</h2>
<h3 id="1-use-fillableguarded">1. Use Fillable/Guarded</h3>
<div class="codehilite"><pre><span></span><code><span class="x">class User extends Model</span>
<span class="x">{</span>
<span class="x">    protected $fillable = [</span>
<span class="x">        &#39;name&#39;,</span>
<span class="x">        &#39;email&#39;,</span>
<span class="x">        &#39;password&#39;,</span>
<span class="x">    ];</span>

<span class="x">    // Or use guarded</span>
<span class="x">    protected $guarded = [&#39;id&#39;, &#39;admin&#39;];</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="2-use-accessors-and-mutators">2. Use Accessors and Mutators</h3>
<div class="codehilite"><pre><span></span><code><span class="x">class User extends Model</span>
<span class="x">{</span>
<span class="x">    public function getFullNameAttribute()</span>
<span class="x">    {</span>
<span class="x">        return &quot;{$this-&gt;first_name} {$this-&gt;last_name}&quot;;</span>
<span class="x">    }</span>

<span class="x">    public function setEmailAttribute($value)</span>
<span class="x">    {</span>
<span class="x">        $this-&gt;attributes[&#39;email&#39;] = strtolower($value);</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="3-use-relationships">3. Use Relationships</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Good</span>
<span class="x">$user-&gt;posts;</span>

<span class="x">// Bad</span>
<span class="x">Post::where(&#39;user_id&#39;, $user-&gt;id)-&gt;get();</span>
</code></pre></div>

<h3 id="4-use-eager-loading">4. Use Eager Loading</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Good</span>
<span class="x">$users = User::with(&#39;posts&#39;)-&gt;get();</span>

<span class="x">// Bad</span>
<span class="x">$users = User::all();</span>
<span class="x">foreach ($users as $user) {</span>
<span class="x">    $user-&gt;posts; // N+1 problem</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="5-use-scopes-for-common-queries">5. Use Scopes for Common Queries</h3>
<div class="codehilite"><pre><span></span><code><span class="x">class User extends Model</span>
<span class="x">{</span>
<span class="x">    public function scopeActive($query)</span>
<span class="x">    {</span>
<span class="x">        return $query-&gt;where(&#39;active&#39;, true);</span>
<span class="x">    }</span>
<span class="x">}</span>

<span class="x">// Usage</span>
<span class="x">$activeUsers = User::active()-&gt;get();</span>
</code></pre></div>

<h2 id="summary">Summary</h2>
<p>In this chapter, we covered:</p>
<ul>
<li>✅ Creating and configuring Eloquent models</li>
<li>✅ Mass assignment and attribute casting</li>
<li>✅ Accessors and mutators</li>
<li>✅ Eloquent relationships (one-to-one, one-to-many, many-to-many, etc.)</li>
<li>✅ Querying with Eloquent</li>
<li>✅ CRUD operations</li>
<li>✅ Soft deletes</li>
<li>✅ Model events and observers</li>
<li>✅ Local and global scopes</li>
<li>✅ Model factories</li>
<li>✅ Best practices for working with Eloquent</li>
</ul>
<p>Eloquent provides a powerful and intuitive way to work with your database. In the next chapter, we'll explore database migrations for managing your database schema.</p></div><div class="chapter" id="07-migrations"><h1 id="chapter-7-database-migrations">Chapter 7: Database Migrations</h1>
<h2 id="what-are-migrations">What are Migrations?</h2>
<p>Migrations are like version control for your database. They allow you to define and modify your database schema in a structured and organized way. Each migration file represents a change to your database structure, and Laravel keeps track of which migrations have been run.</p>
<h2 id="creating-migrations">Creating Migrations</h2>
<h3 id="using-artisan-command">Using Artisan Command</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Basic migration</span>
php<span class="w"> </span>artisan<span class="w"> </span>make:migration<span class="w"> </span>create_users_table

<span class="c1"># Migration for existing table</span>
php<span class="w"> </span>artisan<span class="w"> </span>make:migration<span class="w"> </span>add_email_to_users_table

<span class="c1"># Migration with model</span>
php<span class="w"> </span>artisan<span class="w"> </span>make:model<span class="w"> </span>User<span class="w"> </span>-m

<span class="c1"># Migration with model and factory</span>
php<span class="w"> </span>artisan<span class="w"> </span>make:model<span class="w"> </span>Post<span class="w"> </span>-mf

<span class="c1"># Migration with model, factory, and seeder</span>
php<span class="w"> </span>artisan<span class="w"> </span>make:model<span class="w"> </span>Category<span class="w"> </span>-mfs
</code></pre></div>

<h3 id="migration-file-structure">Migration File Structure</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Migrations\Migration</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Schema\Blueprint</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Schema</span><span class="p">;</span>

<span class="k">return</span> <span class="k">new</span> <span class="k">class</span> <span class="k">extends</span> <span class="nx">Migration</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Run the migrations.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">up</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nx">Schema</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">();</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">unique</span><span class="p">();</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">timestamp</span><span class="p">(</span><span class="s1">&#39;email_verified_at&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">nullable</span><span class="p">();</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">rememberToken</span><span class="p">();</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">timestamps</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Reverse the migrations.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">down</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nx">Schema</span><span class="o">::</span><span class="na">dropIfExists</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>

<h2 id="column-types">Column Types</h2>
<h3 id="basic-column-types">Basic Column Types</h3>
<div class="codehilite"><pre><span></span><code><span class="x">Schema::create(&#39;users&#39;, function (Blueprint $table) {</span>
<span class="x">    // String columns</span>
<span class="x">    $table-&gt;string(&#39;name&#39;);</span>
<span class="x">    $table-&gt;string(&#39;email&#39;, 100); // With length</span>
<span class="x">    $table-&gt;text(&#39;description&#39;);</span>
<span class="x">    $table-&gt;longText(&#39;content&#39;);</span>

<span class="x">    // Numeric columns</span>
<span class="x">    $table-&gt;integer(&#39;age&#39;);</span>
<span class="x">    $table-&gt;bigInteger(&#39;phone&#39;);</span>
<span class="x">    $table-&gt;decimal(&#39;price&#39;, 8, 2); // 8 digits, 2 decimal places</span>
<span class="x">    $table-&gt;float(&#39;rating&#39;, 3, 2);</span>
<span class="x">    $table-&gt;double(&#39;amount&#39;, 10, 2);</span>

<span class="x">    // Boolean columns</span>
<span class="x">    $table-&gt;boolean(&#39;is_active&#39;);</span>
<span class="x">    $table-&gt;boolean(&#39;is_admin&#39;)-&gt;default(false);</span>

<span class="x">    // Date and time columns</span>
<span class="x">    $table-&gt;date(&#39;birth_date&#39;);</span>
<span class="x">    $table-&gt;dateTime(&#39;last_login&#39;);</span>
<span class="x">    $table-&gt;timestamp(&#39;email_verified_at&#39;)-&gt;nullable();</span>
<span class="x">    $table-&gt;time(&#39;start_time&#39;);</span>
<span class="x">    $table-&gt;year(&#39;birth_year&#39;);</span>

<span class="x">    // JSON columns</span>
<span class="x">    $table-&gt;json(&#39;settings&#39;);</span>
<span class="x">    $table-&gt;jsonb(&#39;metadata&#39;); // PostgreSQL only</span>

<span class="x">    // Binary columns</span>
<span class="x">    $table-&gt;binary(&#39;avatar&#39;);</span>

<span class="x">    // UUID columns</span>
<span class="x">    $table-&gt;uuid(&#39;id&#39;)-&gt;primary();</span>
<span class="x">    $table-&gt;uuidMorphs(&#39;taggable&#39;);</span>

<span class="x">    // Enum columns</span>
<span class="x">    $table-&gt;enum(&#39;status&#39;, [&#39;active&#39;, &#39;inactive&#39;, &#39;pending&#39;]);</span>
<span class="x">    $table-&gt;set(&#39;options&#39;, [&#39;option1&#39;, &#39;option2&#39;, &#39;option3&#39;]);</span>
<span class="x">});</span>
</code></pre></div>

<h3 id="column-modifiers">Column Modifiers</h3>
<div class="codehilite"><pre><span></span><code><span class="x">Schema::create(&#39;users&#39;, function (Blueprint $table) {</span>
<span class="x">    // Nullable columns</span>
<span class="x">    $table-&gt;string(&#39;middle_name&#39;)-&gt;nullable();</span>

<span class="x">    // Default values</span>
<span class="x">    $table-&gt;boolean(&#39;is_active&#39;)-&gt;default(true);</span>
<span class="x">    $table-&gt;string(&#39;role&#39;)-&gt;default(&#39;user&#39;);</span>

<span class="x">    // Auto-incrementing</span>
<span class="x">    $table-&gt;id(); // Same as $table-&gt;bigIncrements(&#39;id&#39;);</span>
<span class="x">    $table-&gt;increments(&#39;id&#39;); // Integer auto-increment</span>
<span class="x">    $table-&gt;smallIncrements(&#39;id&#39;); // Small integer auto-increment</span>
<span class="x">    $table-&gt;mediumIncrements(&#39;id&#39;); // Medium integer auto-increment</span>

<span class="x">    // Unsigned columns</span>
<span class="x">    $table-&gt;unsignedInteger(&#39;user_id&#39;);</span>
<span class="x">    $table-&gt;unsignedBigInteger(&#39;post_id&#39;);</span>

<span class="x">    // Comment</span>
<span class="x">    $table-&gt;string(&#39;email&#39;)-&gt;comment(&#39;User email address&#39;);</span>

<span class="x">    // After column</span>
<span class="x">    $table-&gt;string(&#39;last_name&#39;)-&gt;after(&#39;first_name&#39;);</span>

<span class="x">    // First column</span>
<span class="x">    $table-&gt;string(&#39;priority&#39;)-&gt;first();</span>
<span class="x">});</span>
</code></pre></div>

<h2 id="indexes">Indexes</h2>
<h3 id="creating-indexes">Creating Indexes</h3>
<div class="codehilite"><pre><span></span><code><span class="x">Schema::create(&#39;users&#39;, function (Blueprint $table) {</span>
<span class="x">    $table-&gt;id();</span>
<span class="x">    $table-&gt;string(&#39;email&#39;)-&gt;unique(); // Unique index</span>
<span class="x">    $table-&gt;string(&#39;username&#39;)-&gt;unique();</span>
<span class="x">    $table-&gt;string(&#39;name&#39;);</span>
<span class="x">    $table-&gt;string(&#39;city&#39;);</span>
<span class="x">    $table-&gt;integer(&#39;age&#39;);</span>

<span class="x">    // Single column indexes</span>
<span class="x">    $table-&gt;index(&#39;name&#39;);</span>
<span class="x">    $table-&gt;index([&#39;name&#39;, &#39;email&#39;]);</span>

<span class="x">    // Named indexes</span>
<span class="x">    $table-&gt;index([&#39;name&#39;, &#39;email&#39;], &#39;users_name_email_index&#39;);</span>

<span class="x">    // Unique indexes</span>
<span class="x">    $table-&gt;unique(&#39;email&#39;);</span>
<span class="x">    $table-&gt;unique([&#39;name&#39;, &#39;email&#39;]);</span>

<span class="x">    // Sparse indexes (nullable columns)</span>
<span class="x">    $table-&gt;string(&#39;phone&#39;)-&gt;nullable()-&gt;index();</span>

<span class="x">    // Full-text indexes (MySQL)</span>
<span class="x">    $table-&gt;text(&#39;content&#39;);</span>
<span class="x">    $table-&gt;fullText(&#39;content&#39;);</span>

<span class="x">    // Spatial indexes</span>
<span class="x">    $table-&gt;point(&#39;location&#39;);</span>
<span class="x">    $table-&gt;spatialIndex(&#39;location&#39;);</span>
<span class="x">});</span>
</code></pre></div>

<h3 id="adding-indexes-to-existing-tables">Adding Indexes to Existing Tables</h3>
<div class="codehilite"><pre><span></span><code><span class="x">Schema::table(&#39;users&#39;, function (Blueprint $table) {</span>
<span class="x">    $table-&gt;index(&#39;email&#39;);</span>
<span class="x">    $table-&gt;unique(&#39;username&#39;);</span>
<span class="x">    $table-&gt;index([&#39;name&#39;, &#39;email&#39;]);</span>
<span class="x">});</span>
</code></pre></div>

<h3 id="dropping-indexes">Dropping Indexes</h3>
<div class="codehilite"><pre><span></span><code><span class="x">Schema::table(&#39;users&#39;, function (Blueprint $table) {</span>
<span class="x">    $table-&gt;dropIndex([&#39;email&#39;]);</span>
<span class="x">    $table-&gt;dropUnique([&#39;username&#39;]);</span>
<span class="x">    $table-&gt;dropIndex(&#39;users_name_email_index&#39;);</span>
<span class="x">});</span>
</code></pre></div>

<h2 id="foreign-keys">Foreign Keys</h2>
<h3 id="creating-foreign-keys">Creating Foreign Keys</h3>
<div class="codehilite"><pre><span></span><code><span class="x">Schema::create(&#39;posts&#39;, function (Blueprint $table) {</span>
<span class="x">    $table-&gt;id();</span>
<span class="x">    $table-&gt;string(&#39;title&#39;);</span>
<span class="x">    $table-&gt;text(&#39;content&#39;);</span>
<span class="x">    $table-&gt;unsignedBigInteger(&#39;user_id&#39;);</span>
<span class="x">    $table-&gt;unsignedBigInteger(&#39;category_id&#39;);</span>

<span class="x">    // Foreign key constraints</span>
<span class="x">    $table-&gt;foreign(&#39;user_id&#39;)-&gt;references(&#39;id&#39;)-&gt;on(&#39;users&#39;);</span>
<span class="x">    $table-&gt;foreign(&#39;category_id&#39;)-&gt;references(&#39;id&#39;)-&gt;on(&#39;categories&#39;);</span>

<span class="x">    // With cascade options</span>
<span class="x">    $table-&gt;foreign(&#39;user_id&#39;)</span>
<span class="x">        -&gt;references(&#39;id&#39;)</span>
<span class="x">        -&gt;on(&#39;users&#39;)</span>
<span class="x">        -&gt;onDelete(&#39;cascade&#39;)</span>
<span class="x">        -&gt;onUpdate(&#39;cascade&#39;);</span>

<span class="x">    // With custom constraint name</span>
<span class="x">    $table-&gt;foreign(&#39;user_id&#39;, &#39;posts_user_id_foreign&#39;)</span>
<span class="x">        -&gt;references(&#39;id&#39;)</span>
<span class="x">        -&gt;on(&#39;users&#39;);</span>
<span class="x">});</span>
</code></pre></div>

<h3 id="foreign-key-options">Foreign Key Options</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Cascade delete</span>
<span class="x">$table-&gt;foreign(&#39;user_id&#39;)</span>
<span class="x">    -&gt;references(&#39;id&#39;)</span>
<span class="x">    -&gt;on(&#39;users&#39;)</span>
<span class="x">    -&gt;onDelete(&#39;cascade&#39;);</span>

<span class="x">// Set null on delete</span>
<span class="x">$table-&gt;foreign(&#39;user_id&#39;)</span>
<span class="x">    -&gt;references(&#39;id&#39;)</span>
<span class="x">    -&gt;on(&#39;users&#39;)</span>
<span class="x">    -&gt;onDelete(&#39;set null&#39;);</span>

<span class="x">// Restrict delete</span>
<span class="x">$table-&gt;foreign(&#39;user_id&#39;)</span>
<span class="x">    -&gt;references(&#39;id&#39;)</span>
<span class="x">    -&gt;on(&#39;users&#39;)</span>
<span class="x">    -&gt;onDelete(&#39;restrict&#39;);</span>

<span class="x">// No action</span>
<span class="x">$table-&gt;foreign(&#39;user_id&#39;)</span>
<span class="x">    -&gt;references(&#39;id&#39;)</span>
<span class="x">    -&gt;on(&#39;users&#39;)</span>
<span class="x">    -&gt;onDelete(&#39;no action&#39;);</span>
</code></pre></div>

<h3 id="dropping-foreign-keys">Dropping Foreign Keys</h3>
<div class="codehilite"><pre><span></span><code><span class="x">Schema::table(&#39;posts&#39;, function (Blueprint $table) {</span>
<span class="x">    $table-&gt;dropForeign([&#39;user_id&#39;]);</span>
<span class="x">    $table-&gt;dropForeign(&#39;posts_user_id_foreign&#39;);</span>
<span class="x">});</span>
</code></pre></div>

<h2 id="common-migration-patterns">Common Migration Patterns</h2>
<h3 id="creating-tables">Creating Tables</h3>
<div class="codehilite"><pre><span></span><code><span class="x">Schema::create(&#39;users&#39;, function (Blueprint $table) {</span>
<span class="x">    $table-&gt;id();</span>
<span class="x">    $table-&gt;string(&#39;name&#39;);</span>
<span class="x">    $table-&gt;string(&#39;email&#39;)-&gt;unique();</span>
<span class="x">    $table-&gt;timestamp(&#39;email_verified_at&#39;)-&gt;nullable();</span>
<span class="x">    $table-&gt;string(&#39;password&#39;);</span>
<span class="x">    $table-&gt;enum(&#39;role&#39;, [&#39;user&#39;, &#39;admin&#39;, &#39;moderator&#39;])-&gt;default(&#39;user&#39;);</span>
<span class="x">    $table-&gt;boolean(&#39;is_active&#39;)-&gt;default(true);</span>
<span class="x">    $table-&gt;json(&#39;settings&#39;)-&gt;nullable();</span>
<span class="x">    $table-&gt;rememberToken();</span>
<span class="x">    $table-&gt;timestamps();</span>

<span class="x">    // Indexes</span>
<span class="x">    $table-&gt;index([&#39;name&#39;, &#39;email&#39;]);</span>
<span class="x">    $table-&gt;index(&#39;created_at&#39;);</span>
<span class="x">});</span>
</code></pre></div>

<h3 id="adding-columns">Adding Columns</h3>
<div class="codehilite"><pre><span></span><code><span class="x">Schema::table(&#39;users&#39;, function (Blueprint $table) {</span>
<span class="x">    $table-&gt;string(&#39;phone&#39;)-&gt;nullable()-&gt;after(&#39;email&#39;);</span>
<span class="x">    $table-&gt;date(&#39;birth_date&#39;)-&gt;nullable()-&gt;after(&#39;phone&#39;);</span>
<span class="x">    $table-&gt;text(&#39;bio&#39;)-&gt;nullable()-&gt;after(&#39;birth_date&#39;);</span>
<span class="x">    $table-&gt;boolean(&#39;newsletter&#39;)-&gt;default(false)-&gt;after(&#39;bio&#39;);</span>
<span class="x">});</span>
</code></pre></div>

<h3 id="modifying-columns">Modifying Columns</h3>
<div class="codehilite"><pre><span></span><code><span class="x">Schema::table(&#39;users&#39;, function (Blueprint $table) {</span>
<span class="x">    // Change column type</span>
<span class="x">    $table-&gt;string(&#39;name&#39;, 100)-&gt;change();</span>

<span class="x">    // Make column nullable</span>
<span class="x">    $table-&gt;string(&#39;phone&#39;)-&gt;nullable()-&gt;change();</span>

<span class="x">    // Add default value</span>
<span class="x">    $table-&gt;boolean(&#39;is_active&#39;)-&gt;default(true)-&gt;change();</span>

<span class="x">    // Rename column</span>
<span class="x">    $table-&gt;renameColumn(&#39;old_name&#39;, &#39;new_name&#39;);</span>
<span class="x">});</span>
</code></pre></div>

<h3 id="dropping-columns">Dropping Columns</h3>
<div class="codehilite"><pre><span></span><code><span class="x">Schema::table(&#39;users&#39;, function (Blueprint $table) {</span>
<span class="x">    $table-&gt;dropColumn(&#39;phone&#39;);</span>
<span class="x">    $table-&gt;dropColumn([&#39;phone&#39;, &#39;birth_date&#39;, &#39;bio&#39;]);</span>
<span class="x">});</span>
</code></pre></div>

<h2 id="running-migrations">Running Migrations</h2>
<h3 id="basic-commands">Basic Commands</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Run all pending migrations</span>
php<span class="w"> </span>artisan<span class="w"> </span>migrate

<span class="c1"># Run migrations with output</span>
php<span class="w"> </span>artisan<span class="w"> </span>migrate<span class="w"> </span>--verbose

<span class="c1"># Run migrations in production</span>
php<span class="w"> </span>artisan<span class="w"> </span>migrate<span class="w"> </span>--force

<span class="c1"># Check migration status</span>
php<span class="w"> </span>artisan<span class="w"> </span>migrate:status

<span class="c1"># Rollback last batch</span>
php<span class="w"> </span>artisan<span class="w"> </span>migrate:rollback

<span class="c1"># Rollback specific number of steps</span>
php<span class="w"> </span>artisan<span class="w"> </span>migrate:rollback<span class="w"> </span>--step<span class="o">=</span><span class="m">2</span>

<span class="c1"># Reset all migrations</span>
php<span class="w"> </span>artisan<span class="w"> </span>migrate:reset

<span class="c1"># Refresh migrations (reset + migrate)</span>
php<span class="w"> </span>artisan<span class="w"> </span>migrate:refresh

<span class="c1"># Refresh with seed</span>
php<span class="w"> </span>artisan<span class="w"> </span>migrate:refresh<span class="w"> </span>--seed

<span class="c1"># Fresh start (drop all tables + migrate)</span>
php<span class="w"> </span>artisan<span class="w"> </span>migrate:fresh

<span class="c1"># Fresh with seed</span>
php<span class="w"> </span>artisan<span class="w"> </span>migrate:fresh<span class="w"> </span>--seed
</code></pre></div>

<h3 id="migration-status">Migration Status</h3>
<div class="codehilite"><pre><span></span><code>php<span class="w"> </span>artisan<span class="w"> </span>migrate:status
</code></pre></div>

<p>Output:</p>
<div class="codehilite"><pre><span></span><code><span class="nb">+------+------------------------------------------------+-------+</span>
<span class="c">| Ran? | Migration                                       | Batch |</span>
<span class="nb">+------+------------------------------------------------+-------+</span>
<span class="c">| Y    | 2014_10_12_000000_create_users_table           | 1     |</span>
<span class="c">| Y    | 2014_10_12_100000_create_password_resets_table | 1     |</span>
<span class="c">| N    | 2019_08_19_000000_create_failed_jobs_table     | </span><span class="nb">-</span><span class="c">     |</span>
<span class="nb">+------+------------------------------------------------+-------+</span>
</code></pre></div>

<h2 id="migration-best-practices">Migration Best Practices</h2>
<h3 id="1-use-descriptive-names">1. Use Descriptive Names</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Good</span>
php<span class="w"> </span>artisan<span class="w"> </span>make:migration<span class="w"> </span>create_users_table
php<span class="w"> </span>artisan<span class="w"> </span>make:migration<span class="w"> </span>add_email_verification_to_users_table
php<span class="w"> </span>artisan<span class="w"> </span>make:migration<span class="w"> </span>create_posts_table

<span class="c1"># Bad</span>
php<span class="w"> </span>artisan<span class="w"> </span>make:migration<span class="w"> </span>migration_1
php<span class="w"> </span>artisan<span class="w"> </span>make:migration<span class="w"> </span>update_table
</code></pre></div>

<h3 id="2-keep-migrations-small-and-focused">2. Keep Migrations Small and Focused</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Good - Single purpose migration</span>
<span class="x">Schema::table(&#39;users&#39;, function (Blueprint $table) {</span>
<span class="x">    $table-&gt;string(&#39;phone&#39;)-&gt;nullable();</span>
<span class="x">});</span>

<span class="x">// Bad - Multiple unrelated changes</span>
<span class="x">Schema::table(&#39;users&#39;, function (Blueprint $table) {</span>
<span class="x">    $table-&gt;string(&#39;phone&#39;)-&gt;nullable();</span>
<span class="x">    $table-&gt;string(&#39;address&#39;)-&gt;nullable();</span>
<span class="x">    $table-&gt;integer(&#39;age&#39;)-&gt;nullable();</span>
<span class="x">    // ... many more changes</span>
<span class="x">});</span>
</code></pre></div>

<h3 id="3-always-include-down-method">3. Always Include Down Method</h3>
<div class="codehilite"><pre><span></span><code><span class="x">public function down(): void</span>
<span class="x">{</span>
<span class="x">    Schema::table(&#39;users&#39;, function (Blueprint $table) {</span>
<span class="x">        $table-&gt;dropColumn(&#39;phone&#39;);</span>
<span class="x">    });</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="4-use-proper-data-types">4. Use Proper Data Types</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Good</span>
<span class="x">$table-&gt;decimal(&#39;price&#39;, 8, 2); // For currency</span>
<span class="x">$table-&gt;text(&#39;description&#39;); // For long text</span>
<span class="x">$table-&gt;json(&#39;settings&#39;); // For structured data</span>

<span class="x">// Bad</span>
<span class="x">$table-&gt;string(&#39;price&#39;); // Could lose precision</span>
<span class="x">$table-&gt;string(&#39;description&#39;, 1000); // Limited length</span>
<span class="x">$table-&gt;text(&#39;settings&#39;); // Not structured</span>
</code></pre></div>

<h3 id="5-add-indexes-for-performance">5. Add Indexes for Performance</h3>
<div class="codehilite"><pre><span></span><code><span class="x">Schema::create(&#39;posts&#39;, function (Blueprint $table) {</span>
<span class="x">    $table-&gt;id();</span>
<span class="x">    $table-&gt;string(&#39;title&#39;);</span>
<span class="x">    $table-&gt;text(&#39;content&#39;);</span>
<span class="x">    $table-&gt;unsignedBigInteger(&#39;user_id&#39;);</span>
<span class="x">    $table-&gt;enum(&#39;status&#39;, [&#39;draft&#39;, &#39;published&#39;, &#39;archived&#39;]);</span>
<span class="x">    $table-&gt;timestamps();</span>

<span class="x">    // Indexes for common queries</span>
<span class="x">    $table-&gt;index(&#39;user_id&#39;);</span>
<span class="x">    $table-&gt;index(&#39;status&#39;);</span>
<span class="x">    $table-&gt;index(&#39;created_at&#39;);</span>
<span class="x">    $table-&gt;index([&#39;user_id&#39;, &#39;status&#39;]);</span>
<span class="x">});</span>
</code></pre></div>

<h3 id="6-use-foreign-keys-for-data-integrity">6. Use Foreign Keys for Data Integrity</h3>
<div class="codehilite"><pre><span></span><code><span class="x">Schema::create(&#39;posts&#39;, function (Blueprint $table) {</span>
<span class="x">    $table-&gt;id();</span>
<span class="x">    $table-&gt;string(&#39;title&#39;);</span>
<span class="x">    $table-&gt;unsignedBigInteger(&#39;user_id&#39;);</span>
<span class="x">    $table-&gt;unsignedBigInteger(&#39;category_id&#39;);</span>

<span class="x">    $table-&gt;foreign(&#39;user_id&#39;)-&gt;references(&#39;id&#39;)-&gt;on(&#39;users&#39;);</span>
<span class="x">    $table-&gt;foreign(&#39;category_id&#39;)-&gt;references(&#39;id&#39;)-&gt;on(&#39;categories&#39;);</span>
<span class="x">});</span>
</code></pre></div>

<h2 id="advanced-migration-features">Advanced Migration Features</h2>
<h3 id="raw-sql">Raw SQL</h3>
<div class="codehilite"><pre><span></span><code><span class="x">Schema::create(&#39;users&#39;, function (Blueprint $table) {</span>
<span class="x">    $table-&gt;id();</span>
<span class="x">    $table-&gt;string(&#39;name&#39;);</span>

<span class="x">    // Raw SQL for complex operations</span>
<span class="x">    DB::statement(&#39;ALTER TABLE users ADD FULLTEXT(name)&#39;);</span>
<span class="x">});</span>
</code></pre></div>

<h3 id="conditional-migrations">Conditional Migrations</h3>
<div class="codehilite"><pre><span></span><code><span class="x">Schema::create(&#39;users&#39;, function (Blueprint $table) {</span>
<span class="x">    $table-&gt;id();</span>
<span class="x">    $table-&gt;string(&#39;name&#39;);</span>

<span class="x">    // Only add column if database supports it</span>
<span class="x">    if (DB::connection()-&gt;getDriverName() === &#39;mysql&#39;) {</span>
<span class="x">        $table-&gt;fullText(&#39;name&#39;);</span>
<span class="x">    }</span>
<span class="x">});</span>
</code></pre></div>

<h3 id="custom-migration-commands">Custom Migration Commands</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// In your migration</span>
<span class="x">public function up(): void</span>
<span class="x">{</span>
<span class="x">    Schema::create(&#39;users&#39;, function (Blueprint $table) {</span>
<span class="x">        $table-&gt;id();</span>
<span class="x">        $table-&gt;string(&#39;name&#39;);</span>
<span class="x">        $table-&gt;string(&#39;email&#39;)-&gt;unique();</span>
<span class="x">        $table-&gt;timestamps();</span>
<span class="x">    });</span>

<span class="x">    // Insert default data</span>
<span class="x">    DB::table(&#39;users&#39;)-&gt;insert([</span>
<span class="x">        &#39;name&#39; =&gt; &#39;Admin User&#39;,</span>
<span class="x">        &#39;email&#39; =&gt; &#39;admin@example.com&#39;,</span>
<span class="x">        &#39;created_at&#39; =&gt; now(),</span>
<span class="x">        &#39;updated_at&#39; =&gt; now(),</span>
<span class="x">    ]);</span>
<span class="x">}</span>
</code></pre></div>

<h2 id="migration-examples">Migration Examples</h2>
<h3 id="users-table">Users Table</h3>
<div class="codehilite"><pre><span></span><code><span class="x">Schema::create(&#39;users&#39;, function (Blueprint $table) {</span>
<span class="x">    $table-&gt;id();</span>
<span class="x">    $table-&gt;string(&#39;name&#39;);</span>
<span class="x">    $table-&gt;string(&#39;email&#39;)-&gt;unique();</span>
<span class="x">    $table-&gt;string(&#39;username&#39;)-&gt;unique();</span>
<span class="x">    $table-&gt;timestamp(&#39;email_verified_at&#39;)-&gt;nullable();</span>
<span class="x">    $table-&gt;string(&#39;password&#39;);</span>
<span class="x">    $table-&gt;enum(&#39;role&#39;, [&#39;user&#39;, &#39;admin&#39;, &#39;moderator&#39;])-&gt;default(&#39;user&#39;);</span>
<span class="x">    $table-&gt;boolean(&#39;is_active&#39;)-&gt;default(true);</span>
<span class="x">    $table-&gt;string(&#39;phone&#39;)-&gt;nullable();</span>
<span class="x">    $table-&gt;date(&#39;birth_date&#39;)-&gt;nullable();</span>
<span class="x">    $table-&gt;text(&#39;bio&#39;)-&gt;nullable();</span>
<span class="x">    $table-&gt;json(&#39;settings&#39;)-&gt;nullable();</span>
<span class="x">    $table-&gt;string(&#39;avatar&#39;)-&gt;nullable();</span>
<span class="x">    $table-&gt;timestamp(&#39;last_login_at&#39;)-&gt;nullable();</span>
<span class="x">    $table-&gt;rememberToken();</span>
<span class="x">    $table-&gt;timestamps();</span>
<span class="x">    $table-&gt;softDeletes();</span>

<span class="x">    // Indexes</span>
<span class="x">    $table-&gt;index([&#39;name&#39;, &#39;email&#39;]);</span>
<span class="x">    $table-&gt;index(&#39;role&#39;);</span>
<span class="x">    $table-&gt;index(&#39;is_active&#39;);</span>
<span class="x">    $table-&gt;index(&#39;created_at&#39;);</span>
<span class="x">});</span>
</code></pre></div>

<h3 id="posts-table">Posts Table</h3>
<div class="codehilite"><pre><span></span><code><span class="x">Schema::create(&#39;posts&#39;, function (Blueprint $table) {</span>
<span class="x">    $table-&gt;id();</span>
<span class="x">    $table-&gt;string(&#39;title&#39;);</span>
<span class="x">    $table-&gt;string(&#39;slug&#39;)-&gt;unique();</span>
<span class="x">    $table-&gt;text(&#39;excerpt&#39;)-&gt;nullable();</span>
<span class="x">    $table-&gt;longText(&#39;content&#39;);</span>
<span class="x">    $table-&gt;string(&#39;featured_image&#39;)-&gt;nullable();</span>
<span class="x">    $table-&gt;enum(&#39;status&#39;, [&#39;draft&#39;, &#39;published&#39;, &#39;archived&#39;])-&gt;default(&#39;draft&#39;);</span>
<span class="x">    $table-&gt;boolean(&#39;is_featured&#39;)-&gt;default(false);</span>
<span class="x">    $table-&gt;unsignedBigInteger(&#39;user_id&#39;);</span>
<span class="x">    $table-&gt;unsignedBigInteger(&#39;category_id&#39;)-&gt;nullable();</span>
<span class="x">    $table-&gt;json(&#39;meta&#39;)-&gt;nullable();</span>
<span class="x">    $table-&gt;timestamp(&#39;published_at&#39;)-&gt;nullable();</span>
<span class="x">    $table-&gt;timestamps();</span>
<span class="x">    $table-&gt;softDeletes();</span>

<span class="x">    // Foreign keys</span>
<span class="x">    $table-&gt;foreign(&#39;user_id&#39;)-&gt;references(&#39;id&#39;)-&gt;on(&#39;users&#39;)-&gt;onDelete(&#39;cascade&#39;);</span>
<span class="x">    $table-&gt;foreign(&#39;category_id&#39;)-&gt;references(&#39;id&#39;)-&gt;on(&#39;categories&#39;)-&gt;onDelete(&#39;set null&#39;);</span>

<span class="x">    // Indexes</span>
<span class="x">    $table-&gt;index(&#39;slug&#39;);</span>
<span class="x">    $table-&gt;index(&#39;status&#39;);</span>
<span class="x">    $table-&gt;index(&#39;is_featured&#39;);</span>
<span class="x">    $table-&gt;index(&#39;published_at&#39;);</span>
<span class="x">    $table-&gt;index([&#39;user_id&#39;, &#39;status&#39;]);</span>
<span class="x">    $table-&gt;index([&#39;category_id&#39;, &#39;status&#39;]);</span>
<span class="x">});</span>
</code></pre></div>

<h3 id="comments-table">Comments Table</h3>
<div class="codehilite"><pre><span></span><code><span class="x">Schema::create(&#39;comments&#39;, function (Blueprint $table) {</span>
<span class="x">    $table-&gt;id();</span>
<span class="x">    $table-&gt;text(&#39;content&#39;);</span>
<span class="x">    $table-&gt;unsignedBigInteger(&#39;user_id&#39;);</span>
<span class="x">    $table-&gt;morphs(&#39;commentable&#39;); // Creates commentable_type and commentable_id</span>
<span class="x">    $table-&gt;unsignedBigInteger(&#39;parent_id&#39;)-&gt;nullable(); // For nested comments</span>
<span class="x">    $table-&gt;boolean(&#39;is_approved&#39;)-&gt;default(false);</span>
<span class="x">    $table-&gt;timestamps();</span>
<span class="x">    $table-&gt;softDeletes();</span>

<span class="x">    // Foreign keys</span>
<span class="x">    $table-&gt;foreign(&#39;user_id&#39;)-&gt;references(&#39;id&#39;)-&gt;on(&#39;users&#39;)-&gt;onDelete(&#39;cascade&#39;);</span>
<span class="x">    $table-&gt;foreign(&#39;parent_id&#39;)-&gt;references(&#39;id&#39;)-&gt;on(&#39;comments&#39;)-&gt;onDelete(&#39;cascade&#39;);</span>

<span class="x">    // Indexes</span>
<span class="x">    $table-&gt;index(&#39;commentable_type&#39;);</span>
<span class="x">    $table-&gt;index(&#39;commentable_id&#39;);</span>
<span class="x">    $table-&gt;index(&#39;parent_id&#39;);</span>
<span class="x">    $table-&gt;index(&#39;is_approved&#39;);</span>
<span class="x">    $table-&gt;index(&#39;created_at&#39;);</span>
<span class="x">});</span>
</code></pre></div>

<h2 id="summary">Summary</h2>
<p>In this chapter, we covered:</p>
<ul>
<li>✅ Creating and running migrations</li>
<li>✅ Column types and modifiers</li>
<li>✅ Indexes and foreign keys</li>
<li>✅ Common migration patterns</li>
<li>✅ Migration commands and status</li>
<li>✅ Best practices for migrations</li>
<li>✅ Advanced migration features</li>
<li>✅ Real-world migration examples</li>
</ul>
<p>Migrations provide a powerful way to manage your database schema. In the next chapter, we'll explore middleware for filtering HTTP requests.</p></div><div class="chapter" id="08-middleware"><h1 id="chapter-8-middleware">Chapter 8: Middleware</h1>
<h2 id="what-is-middleware">What is Middleware?</h2>
<p>Middleware provides a mechanism for filtering HTTP requests entering your application. Middleware can be used for a variety of tasks such as authentication, logging, CORS, and more. Each middleware handles a specific concern and can be applied to routes, route groups, or globally.</p>
<h2 id="how-middleware-works">How Middleware Works</h2>
<p>Middleware acts as a layer between the HTTP request and your application. When a request comes in, it passes through middleware in the order they are defined. Each middleware can:</p>
<ol>
<li><strong>Modify the request</strong> before it reaches your application</li>
<li><strong>Modify the response</strong> before it's sent back to the client</li>
<li><strong>Terminate the request</strong> early (e.g., redirect or return an error)</li>
<li><strong>Pass the request</strong> to the next middleware</li>
</ol>
<h2 id="built-in-middleware">Built-in Middleware</h2>
<p>Laravel comes with several built-in middleware:</p>
<h3 id="authentication-middleware">Authentication Middleware</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Check if user is authenticated</span>
<span class="x">Route::get(&#39;/profile&#39;, function () {</span>
<span class="x">    // Only authenticated users can access this</span>
<span class="x">})-&gt;middleware(&#39;auth&#39;);</span>

<span class="x">// Check if user is authenticated and email is verified</span>
<span class="x">Route::get(&#39;/settings&#39;, function () {</span>
<span class="x">    // Only verified users can access this</span>
<span class="x">})-&gt;middleware([&#39;auth&#39;, &#39;verified&#39;]);</span>

<span class="x">// Check if user is authenticated and has specific guard</span>
<span class="x">Route::get(&#39;/admin&#39;, function () {</span>
<span class="x">    // Only admin guard users can access this</span>
<span class="x">})-&gt;middleware(&#39;auth:admin&#39;);</span>
</code></pre></div>

<h3 id="csrf-protection">CSRF Protection</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// CSRF protection is automatically applied to web routes</span>
<span class="x">Route::post(&#39;/users&#39;, function () {</span>
<span class="x">    // CSRF token is automatically validated</span>
<span class="x">});</span>
</code></pre></div>

<h3 id="rate-limiting">Rate Limiting</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Limit requests to 60 per minute</span>
<span class="x">Route::get(&#39;/api/users&#39;, function () {</span>
<span class="x">    // Rate limited to 60 requests per minute</span>
<span class="x">})-&gt;middleware(&#39;throttle:60,1&#39;);</span>

<span class="x">// Limit requests with custom key</span>
<span class="x">Route::get(&#39;/api/users&#39;, function () {</span>
<span class="x">    // Rate limited by user ID</span>
<span class="x">})-&gt;middleware(&#39;throttle:60,1&#39;)-&gt;middleware(&#39;throttle:60,1,user_id&#39;);</span>
</code></pre></div>

<h3 id="cors-middleware">CORS Middleware</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Handle CORS for API routes</span>
<span class="x">Route::middleware(&#39;cors&#39;)-&gt;group(function () {</span>
<span class="x">    Route::get(&#39;/api/users&#39;, function () {</span>
<span class="x">        // CORS headers are automatically added</span>
<span class="x">    });</span>
<span class="x">});</span>
</code></pre></div>

<h2 id="creating-custom-middleware">Creating Custom Middleware</h2>
<h3 id="using-artisan-command">Using Artisan Command</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Create middleware</span>
php<span class="w"> </span>artisan<span class="w"> </span>make:middleware<span class="w"> </span>CheckAge

<span class="c1"># Create middleware with specific path</span>
php<span class="w"> </span>artisan<span class="w"> </span>make:middleware<span class="w"> </span>AdminMiddleware
</code></pre></div>

<h3 id="basic-middleware-structure">Basic Middleware Structure</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CheckAge</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Handle an incoming request.</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Closure(\Illuminate\Http\Request): (\Symfony\Component\HttpFoundation\Response)  $next</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">,</span> <span class="nv">$minimumAge</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">age</span> <span class="o">&lt;</span> <span class="nv">$minimumAge</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;You must be at least &#39;</span> <span class="o">.</span> <span class="nv">$minimumAge</span> <span class="o">.</span> <span class="s1">&#39; years old.&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="middleware-with-parameters">Middleware with Parameters</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CheckRole</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">,</span> <span class="o">...</span><span class="nv">$roles</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span> <span class="o">||</span> <span class="o">!</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">role</span><span class="p">,</span> <span class="nv">$roles</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">abort</span><span class="p">(</span><span class="mi">403</span><span class="p">,</span> <span class="s1">&#39;Unauthorized action.&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="terminating-middleware">Terminating Middleware</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">LogRequests</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>

        <span class="c1">// Log after response is sent</span>
        <span class="nx">\Log</span><span class="o">::</span><span class="na">info</span><span class="p">(</span><span class="s1">&#39;Request processed&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;url&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">url</span><span class="p">(),</span>
            <span class="s1">&#39;method&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">(),</span>
            <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getStatusCode</span><span class="p">(),</span>
        <span class="p">]);</span>

        <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="registering-middleware">Registering Middleware</h2>
<h3 id="global-middleware">Global Middleware</h3>
<p>Register middleware that runs on every request in <code>app/Http/Kernel.php</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="x">protected $middleware = [</span>
<span class="x">    // \App\Http\Middleware\TrustHosts::class,</span>
<span class="x">    \App\Http\Middleware\TrustProxies::class,</span>
<span class="x">    \Illuminate\Http\Middleware\HandleCors::class,</span>
<span class="x">    \App\Http\Middleware\PreventRequestsDuringMaintenance::class,</span>
<span class="x">    \Illuminate\Foundation\Http\Middleware\ValidatePostSize::class,</span>
<span class="x">    \App\Http\Middleware\TrimStrings::class,</span>
<span class="x">    \Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull::class,</span>
<span class="x">    \App\Http\Middleware\LogRequests::class, // Custom middleware</span>
<span class="x">];</span>
</code></pre></div>

<h3 id="route-middleware">Route Middleware</h3>
<p>Register middleware that can be assigned to routes in <code>app/Http/Kernel.php</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="x">protected $routeMiddleware = [</span>
<span class="x">    &#39;auth&#39; =&gt; \App\Http\Middleware\Authenticate::class,</span>
<span class="x">    &#39;auth.basic&#39; =&gt; \Illuminate\Auth\Middleware\AuthenticateWithBasicAuth::class,</span>
<span class="x">    &#39;auth.session&#39; =&gt; \Illuminate\Session\Middleware\AuthenticateSession::class,</span>
<span class="x">    &#39;cache.headers&#39; =&gt; \Illuminate\Http\Middleware\SetCacheHeaders::class,</span>
<span class="x">    &#39;can&#39; =&gt; \Illuminate\Auth\Middleware\Authorize::class,</span>
<span class="x">    &#39;guest&#39; =&gt; \App\Http\Middleware\RedirectIfAuthenticated::class,</span>
<span class="x">    &#39;password.confirm&#39; =&gt; \Illuminate\Auth\Middleware\RequirePassword::class,</span>
<span class="x">    &#39;precognitive&#39; =&gt; \Illuminate\Foundation\Http\Middleware\HandlePrecognitiveRequests::class,</span>
<span class="x">    &#39;signed&#39; =&gt; \App\Http\Middleware\ValidateSignature::class,</span>
<span class="x">    &#39;throttle&#39; =&gt; \Illuminate\Routing\Middleware\ThrottleRequests::class,</span>
<span class="x">    &#39;verified&#39; =&gt; \Illuminate\Auth\Middleware\EnsureEmailIsVerified::class,</span>
<span class="x">    &#39;check.age&#39; =&gt; \App\Http\Middleware\CheckAge::class, // Custom middleware</span>
<span class="x">    &#39;check.role&#39; =&gt; \App\Http\Middleware\CheckRole::class, // Custom middleware</span>
<span class="x">];</span>
</code></pre></div>

<h3 id="middleware-groups">Middleware Groups</h3>
<p>Group related middleware in <code>app/Http/Kernel.php</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="x">protected $middlewareGroups = [</span>
<span class="x">    &#39;web&#39; =&gt; [</span>
<span class="x">        \App\Http\Middleware\EncryptCookies::class,</span>
<span class="x">        \Illuminate\Cookie\Middleware\AddQueuedCookiesToResponse::class,</span>
<span class="x">        \Illuminate\Session\Middleware\StartSession::class,</span>
<span class="x">        \Illuminate\View\Middleware\ShareErrorsFromSession::class,</span>
<span class="x">        \App\Http\Middleware\VerifyCsrfToken::class,</span>
<span class="x">        \Illuminate\Routing\Middleware\SubstituteBindings::class,</span>
<span class="x">    ],</span>

<span class="x">    &#39;api&#39; =&gt; [</span>
<span class="x">        \Illuminate\Routing\Middleware\ThrottleRequests::class.&#39;:api&#39;,</span>
<span class="x">        \Illuminate\Routing\Middleware\SubstituteBindings::class,</span>
<span class="x">    ],</span>

<span class="x">    &#39;admin&#39; =&gt; [</span>
<span class="x">        &#39;auth&#39;,</span>
<span class="x">        &#39;check.role:admin&#39;,</span>
<span class="x">        \App\Http\Middleware\LogAdminActions::class,</span>
<span class="x">    ],</span>
<span class="x">];</span>
</code></pre></div>

<h2 id="applying-middleware">Applying Middleware</h2>
<h3 id="to-individual-routes">To Individual Routes</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Single middleware</span>
<span class="x">Route::get(&#39;/profile&#39;, function () {</span>
<span class="x">    return view(&#39;profile&#39;);</span>
<span class="x">})-&gt;middleware(&#39;auth&#39;);</span>

<span class="x">// Multiple middleware</span>
<span class="x">Route::get(&#39;/admin/users&#39;, function () {</span>
<span class="x">    return view(&#39;admin.users&#39;);</span>
<span class="x">})-&gt;middleware([&#39;auth&#39;, &#39;check.role:admin&#39;]);</span>

<span class="x">// Middleware with parameters</span>
<span class="x">Route::get(&#39;/adult-content&#39;, function () {</span>
<span class="x">    return view(&#39;adult.content&#39;);</span>
<span class="x">})-&gt;middleware(&#39;check.age:21&#39;);</span>
</code></pre></div>

<h3 id="to-route-groups">To Route Groups</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Apply middleware to group</span>
<span class="x">Route::middleware([&#39;auth&#39;, &#39;verified&#39;])-&gt;group(function () {</span>
<span class="x">    Route::get(&#39;/profile&#39;, function () {</span>
<span class="x">        return view(&#39;profile&#39;);</span>
<span class="x">    });</span>

<span class="x">    Route::get(&#39;/settings&#39;, function () {</span>
<span class="x">        return view(&#39;settings&#39;);</span>
<span class="x">    });</span>
<span class="x">});</span>

<span class="x">// Apply middleware group</span>
<span class="x">Route::middleware(&#39;admin&#39;)-&gt;group(function () {</span>
<span class="x">    Route::get(&#39;/admin/dashboard&#39;, function () {</span>
<span class="x">        return view(&#39;admin.dashboard&#39;);</span>
<span class="x">    });</span>

<span class="x">    Route::get(&#39;/admin/users&#39;, function () {</span>
<span class="x">        return view(&#39;admin.users&#39;);</span>
<span class="x">    });</span>
<span class="x">});</span>
</code></pre></div>

<h3 id="to-controllers">To Controllers</h3>
<div class="codehilite"><pre><span></span><code><span class="x">class UserController extends Controller</span>
<span class="x">{</span>
<span class="x">    public function __construct()</span>
<span class="x">    {</span>
<span class="x">        $this-&gt;middleware(&#39;auth&#39;);</span>
<span class="x">        $this-&gt;middleware(&#39;check.role:admin&#39;)-&gt;only([&#39;index&#39;, &#39;store&#39;]);</span>
<span class="x">        $this-&gt;middleware(&#39;check.age:18&#39;)-&gt;except([&#39;index&#39;]);</span>
<span class="x">    }</span>

<span class="x">    public function index()</span>
<span class="x">    {</span>
<span class="x">        // Requires auth and admin role</span>
<span class="x">    }</span>

<span class="x">    public function show($id)</span>
<span class="x">    {</span>
<span class="x">        // Requires auth only</span>
<span class="x">    }</span>

<span class="x">    public function store()</span>
<span class="x">    {</span>
<span class="x">        // Requires auth and admin role</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="conditional-middleware">Conditional Middleware</h3>
<div class="codehilite"><pre><span></span><code><span class="x">class UserController extends Controller</span>
<span class="x">{</span>
<span class="x">    public function __construct()</span>
<span class="x">    {</span>
<span class="x">        $this-&gt;middleware(&#39;auth&#39;)-&gt;only([&#39;profile&#39;, &#39;settings&#39;]);</span>
<span class="x">        $this-&gt;middleware(&#39;check.role:admin&#39;)-&gt;when(function ($request) {</span>
<span class="x">            return $request-&gt;is(&#39;admin/*&#39;);</span>
<span class="x">        });</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h2 id="common-middleware-examples">Common Middleware Examples</h2>
<h3 id="authentication-middleware_1">Authentication Middleware</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">EnsureUserIsSubscribed</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">subscribed</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">route</span><span class="p">(</span><span class="s1">&#39;subscription.create&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;You need an active subscription to access this feature.&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="logging-middleware">Logging Middleware</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">LogUserActivity</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">())</span> <span class="p">{</span>
            <span class="nx">\Log</span><span class="o">::</span><span class="na">info</span><span class="p">(</span><span class="s1">&#39;User activity&#39;</span><span class="p">,</span> <span class="p">[</span>
                <span class="s1">&#39;user_id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">,</span>
                <span class="s1">&#39;url&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">url</span><span class="p">(),</span>
                <span class="s1">&#39;method&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">(),</span>
                <span class="s1">&#39;ip&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">ip</span><span class="p">(),</span>
                <span class="s1">&#39;user_agent&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">userAgent</span><span class="p">(),</span>
            <span class="p">]);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="maintenance-mode-middleware">Maintenance Mode Middleware</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MaintenanceMode</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">app</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">isDownForMaintenance</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span><span class="o">?-&gt;</span><span class="na">isAdmin</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">view</span><span class="p">(</span><span class="s1">&#39;maintenance&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="mi">503</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="api-rate-limiting-middleware">API Rate Limiting Middleware</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Cache\RateLimiter</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span> <span class="k">as</span> <span class="nx">HttpResponse</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ApiRateLimit</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$limiter</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">RateLimiter</span> <span class="nv">$limiter</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">limiter</span> <span class="o">=</span> <span class="nv">$limiter</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">,</span> <span class="nv">$maxAttempts</span> <span class="o">=</span> <span class="mi">60</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$key</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">resolveRequestSignature</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">limiter</span><span class="o">-&gt;</span><span class="na">tooManyAttempts</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$maxAttempts</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">buildResponse</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$maxAttempts</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">limiter</span><span class="o">-&gt;</span><span class="na">hit</span><span class="p">(</span><span class="nv">$key</span><span class="p">);</span>

        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">addHeaders</span><span class="p">(</span>
            <span class="nv">$response</span><span class="p">,</span> <span class="nv">$maxAttempts</span><span class="p">,</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">calculateRemainingAttempts</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$maxAttempts</span><span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">resolveRequestSignature</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nb">sha1</span><span class="p">(</span><span class="nb">implode</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span><span class="o">?-&gt;</span><span class="na">id</span> <span class="o">??</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">ip</span><span class="p">(),</span>
            <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">route</span><span class="p">()</span><span class="o">?-&gt;</span><span class="na">getDomain</span><span class="p">()</span> <span class="o">??</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">getHost</span><span class="p">(),</span>
        <span class="p">]));</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">buildResponse</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$key</span><span class="p">,</span> <span class="nx">int</span> <span class="nv">$maxAttempts</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$retryAfter</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">limiter</span><span class="o">-&gt;</span><span class="na">availableIn</span><span class="p">(</span><span class="nv">$key</span><span class="p">);</span>

        <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">([</span>
            <span class="s1">&#39;error&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Too many requests.&#39;</span><span class="p">,</span>
            <span class="s1">&#39;retry_after&#39;</span> <span class="o">=&gt;</span> <span class="nv">$retryAfter</span><span class="p">,</span>
        <span class="p">],</span> <span class="mi">429</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">withHeaders</span><span class="p">([</span>
            <span class="s1">&#39;Retry-After&#39;</span> <span class="o">=&gt;</span> <span class="nv">$retryAfter</span><span class="p">,</span>
            <span class="s1">&#39;X-RateLimit-Limit&#39;</span> <span class="o">=&gt;</span> <span class="nv">$maxAttempts</span><span class="p">,</span>
            <span class="s1">&#39;X-RateLimit-Remaining&#39;</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">addHeaders</span><span class="p">(</span><span class="nx">Response</span> <span class="nv">$response</span><span class="p">,</span> <span class="nx">int</span> <span class="nv">$maxAttempts</span><span class="p">,</span> <span class="nx">int</span> <span class="nv">$remainingAttempts</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">withHeaders</span><span class="p">([</span>
            <span class="s1">&#39;X-RateLimit-Limit&#39;</span> <span class="o">=&gt;</span> <span class="nv">$maxAttempts</span><span class="p">,</span>
            <span class="s1">&#39;X-RateLimit-Remaining&#39;</span> <span class="o">=&gt;</span> <span class="nv">$remainingAttempts</span><span class="p">,</span>
        <span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">calculateRemainingAttempts</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$key</span><span class="p">,</span> <span class="nx">int</span> <span class="nv">$maxAttempts</span><span class="p">)</span><span class="o">:</span> <span class="nx">int</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$maxAttempts</span> <span class="o">-</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">limiter</span><span class="o">-&gt;</span><span class="na">attempts</span><span class="p">(</span><span class="nv">$key</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="middleware-best-practices">Middleware Best Practices</h2>
<h3 id="1-keep-middleware-focused">1. Keep Middleware Focused</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Good - Single responsibility</span>
<span class="x">class CheckAge</span>
<span class="x">{</span>
<span class="x">    public function handle(Request $request, Closure $next, $minimumAge = 18): Response</span>
<span class="x">    {</span>
<span class="x">        if ($request-&gt;user()-&gt;age &lt; $minimumAge) {</span>
<span class="x">            return redirect(&#39;home&#39;);</span>
<span class="x">        }</span>
<span class="x">        return $next($request);</span>
<span class="x">    }</span>
<span class="x">}</span>

<span class="x">// Bad - Multiple responsibilities</span>
<span class="x">class CheckAgeAndRoleAndSubscription</span>
<span class="x">{</span>
<span class="x">    public function handle(Request $request, Closure $next): Response</span>
<span class="x">    {</span>
<span class="x">        // Too many checks in one middleware</span>
<span class="x">        if ($request-&gt;user()-&gt;age &lt; 18) {</span>
<span class="x">            return redirect(&#39;home&#39;);</span>
<span class="x">        }</span>
<span class="x">        if ($request-&gt;user()-&gt;role !== &#39;admin&#39;) {</span>
<span class="x">            return redirect(&#39;home&#39;);</span>
<span class="x">        }</span>
<span class="x">        if (!$request-&gt;user()-&gt;subscribed()) {</span>
<span class="x">            return redirect(&#39;subscription&#39;);</span>
<span class="x">        }</span>
<span class="x">        return $next($request);</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="2-use-descriptive-names">2. Use Descriptive Names</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Good</span>
<span class="x">&#39;check.age&#39; =&gt; \App\Http\Middleware\CheckAge::class,</span>
<span class="x">&#39;ensure.subscribed&#39; =&gt; \App\Http\Middleware\EnsureUserIsSubscribed::class,</span>
<span class="x">&#39;log.activity&#39; =&gt; \App\Http\Middleware\LogUserActivity::class,</span>

<span class="x">// Bad</span>
<span class="x">&#39;middleware1&#39; =&gt; \App\Http\Middleware\Middleware1::class,</span>
<span class="x">&#39;check&#39; =&gt; \App\Http\Middleware\Check::class,</span>
</code></pre></div>

<h3 id="3-handle-errors-gracefully">3. Handle Errors Gracefully</h3>
<div class="codehilite"><pre><span></span><code><span class="x">class CheckRole</span>
<span class="x">{</span>
<span class="x">    public function handle(Request $request, Closure $next, ...$roles): Response</span>
<span class="x">    {</span>
<span class="x">        if (!$request-&gt;user()) {</span>
<span class="x">            return redirect()-&gt;route(&#39;login&#39;);</span>
<span class="x">        }</span>

<span class="x">        if (!in_array($request-&gt;user()-&gt;role, $roles)) {</span>
<span class="x">            abort(403, &#39;You do not have permission to access this resource.&#39;);</span>
<span class="x">        }</span>

<span class="x">        return $next($request);</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="4-use-middleware-groups-for-common-patterns">4. Use Middleware Groups for Common Patterns</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// In Kernel.php</span>
<span class="x">protected $middlewareGroups = [</span>
<span class="x">    &#39;web&#39; =&gt; [</span>
<span class="x">        // Web-specific middleware</span>
<span class="x">    ],</span>
<span class="x">    &#39;api&#39; =&gt; [</span>
<span class="x">        // API-specific middleware</span>
<span class="x">    ],</span>
<span class="x">    &#39;admin&#39; =&gt; [</span>
<span class="x">        &#39;auth&#39;,</span>
<span class="x">        &#39;check.role:admin&#39;,</span>
<span class="x">        &#39;log.activity&#39;,</span>
<span class="x">    ],</span>
<span class="x">    &#39;premium&#39; =&gt; [</span>
<span class="x">        &#39;auth&#39;,</span>
<span class="x">        &#39;ensure.subscribed&#39;,</span>
<span class="x">        &#39;check.role:premium&#39;,</span>
<span class="x">    ],</span>
<span class="x">];</span>
</code></pre></div>

<h3 id="5-test-your-middleware">5. Test Your Middleware</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Tests\Feature</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Tests\TestCase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Http\Middleware\CheckAge</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CheckAgeMiddlewareTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">test_middleware_allows_users_above_minimum_age</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$middleware</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CheckAge</span><span class="p">();</span>
        <span class="nv">$request</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;/test&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">);</span>
        <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">setUserResolver</span><span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">(</span><span class="nx">object</span><span class="p">)</span> <span class="p">[</span><span class="s1">&#39;age&#39;</span> <span class="o">=&gt;</span> <span class="mi">25</span><span class="p">];</span>
        <span class="p">});</span>

        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$middleware</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">response</span><span class="p">(</span><span class="s1">&#39;OK&#39;</span><span class="p">);</span>
        <span class="p">},</span> <span class="mi">18</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="s1">&#39;OK&#39;</span><span class="p">,</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getContent</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">test_middleware_redirects_users_below_minimum_age</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$middleware</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CheckAge</span><span class="p">();</span>
        <span class="nv">$request</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;/test&#39;</span><span class="p">,</span> <span class="s1">&#39;GET&#39;</span><span class="p">);</span>
        <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">setUserResolver</span><span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">(</span><span class="nx">object</span><span class="p">)</span> <span class="p">[</span><span class="s1">&#39;age&#39;</span> <span class="o">=&gt;</span> <span class="mi">16</span><span class="p">];</span>
        <span class="p">});</span>

        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$middleware</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">response</span><span class="p">(</span><span class="s1">&#39;OK&#39;</span><span class="p">);</span>
        <span class="p">},</span> <span class="mi">18</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">302</span><span class="p">,</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getStatusCode</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="summary">Summary</h2>
<p>In this chapter, we covered:</p>
<ul>
<li>✅ Understanding middleware and how it works</li>
<li>✅ Built-in Laravel middleware</li>
<li>✅ Creating custom middleware</li>
<li>✅ Registering and applying middleware</li>
<li>✅ Middleware groups and conditional middleware</li>
<li>✅ Common middleware examples</li>
<li>✅ Best practices for writing middleware</li>
<li>✅ Testing middleware</li>
</ul>
<p>Middleware provides a powerful way to filter and modify HTTP requests in your Laravel application. In the next chapter, we'll explore authentication and authorization.</p></div><div class="chapter" id="09-auth"><h1 id="chapter-9-authentication-authorization">Chapter 9: Authentication &amp; Authorization</h1>
<h2 id="what-is-authentication">What is Authentication?</h2>
<p>Authentication is the process of verifying who a user is, while authorization is the process of determining what a user can access. Laravel provides a complete authentication system that includes user registration, login, password reset, email verification, and more.</p>
<h2 id="laravel-authentication-packages">Laravel Authentication Packages</h2>
<h3 id="laravel-breeze">Laravel Breeze</h3>
<p>Laravel Breeze provides a minimal and simple authentication implementation:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Install Laravel Breeze</span>
composer<span class="w"> </span>require<span class="w"> </span>laravel/breeze<span class="w"> </span>--dev

<span class="c1"># Install Breeze with default stack</span>
php<span class="w"> </span>artisan<span class="w"> </span>breeze:install

<span class="c1"># Install with specific stack</span>
php<span class="w"> </span>artisan<span class="w"> </span>breeze:install<span class="w"> </span>blade
php<span class="w"> </span>artisan<span class="w"> </span>breeze:install<span class="w"> </span>react
php<span class="w"> </span>artisan<span class="w"> </span>breeze:install<span class="w"> </span>vue
php<span class="w"> </span>artisan<span class="w"> </span>breeze:install<span class="w"> </span>api
</code></pre></div>

<h3 id="laravel-jetstream">Laravel Jetstream</h3>
<p>Laravel Jetstream provides a more robust authentication system with additional features:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Install Laravel Jetstream</span>
composer<span class="w"> </span>require<span class="w"> </span>laravel/jetstream

<span class="c1"># Install with Livewire</span>
php<span class="w"> </span>artisan<span class="w"> </span>jetstream:install<span class="w"> </span>livewire

<span class="c1"># Install with Inertia.js</span>
php<span class="w"> </span>artisan<span class="w"> </span>jetstream:install<span class="w"> </span>inertia
</code></pre></div>

<h3 id="laravel-fortify">Laravel Fortify</h3>
<p>Laravel Fortify provides backend authentication services:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Install Laravel Fortify</span>
composer<span class="w"> </span>require<span class="w"> </span>laravel/fortify

<span class="c1"># Publish configuration</span>
php<span class="w"> </span>artisan<span class="w"> </span>vendor:publish<span class="w"> </span>--provider<span class="o">=</span><span class="s2">&quot;Laravel\Fortify\FortifyServiceProvider&quot;</span>
</code></pre></div>

<h2 id="basic-authentication-setup">Basic Authentication Setup</h2>
<h3 id="user-model">User Model</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Foundation\Auth\User</span> <span class="k">as</span> <span class="nx">Authenticatable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Notifications\Notifiable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Laravel\Sanctum\HasApiTokens</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Authenticatable</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">HasApiTokens</span><span class="p">,</span> <span class="nx">Notifiable</span><span class="p">;</span>

    <span class="k">protected</span> <span class="nv">$fillable</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;name&#39;</span><span class="p">,</span>
        <span class="s1">&#39;email&#39;</span><span class="p">,</span>
        <span class="s1">&#39;password&#39;</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="k">protected</span> <span class="nv">$hidden</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;password&#39;</span><span class="p">,</span>
        <span class="s1">&#39;remember_token&#39;</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="k">protected</span> <span class="nv">$casts</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;email_verified_at&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;datetime&#39;</span><span class="p">,</span>
        <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;hashed&#39;</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="authentication-configuration">Authentication Configuration</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// config/auth.php</span>
<span class="x">return [</span>
<span class="x">    &#39;defaults&#39; =&gt; [</span>
<span class="x">        &#39;guard&#39; =&gt; &#39;web&#39;,</span>
<span class="x">        &#39;passwords&#39; =&gt; &#39;users&#39;,</span>
<span class="x">    ],</span>

<span class="x">    &#39;guards&#39; =&gt; [</span>
<span class="x">        &#39;web&#39; =&gt; [</span>
<span class="x">            &#39;driver&#39; =&gt; &#39;session&#39;,</span>
<span class="x">            &#39;provider&#39; =&gt; &#39;users&#39;,</span>
<span class="x">        ],</span>
<span class="x">        &#39;api&#39; =&gt; [</span>
<span class="x">            &#39;driver&#39; =&gt; &#39;sanctum&#39;,</span>
<span class="x">            &#39;provider&#39; =&gt; &#39;users&#39;,</span>
<span class="x">        ],</span>
<span class="x">    ],</span>

<span class="x">    &#39;providers&#39; =&gt; [</span>
<span class="x">        &#39;users&#39; =&gt; [</span>
<span class="x">            &#39;driver&#39; =&gt; &#39;eloquent&#39;,</span>
<span class="x">            &#39;model&#39; =&gt; App\Models\User::class,</span>
<span class="x">        ],</span>
<span class="x">    ],</span>
<span class="x">];</span>
</code></pre></div>

<h2 id="authentication-controllers">Authentication Controllers</h2>
<h3 id="login-controller">Login Controller</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers\Auth</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Providers\RouteServiceProvider</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Auth\AuthenticatesUsers</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">LoginController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">AuthenticatesUsers</span><span class="p">;</span>

    <span class="k">protected</span> <span class="nv">$redirectTo</span> <span class="o">=</span> <span class="nx">RouteServiceProvider</span><span class="o">::</span><span class="na">HOME</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">middleware</span><span class="p">(</span><span class="s1">&#39;guest&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">except</span><span class="p">(</span><span class="s1">&#39;logout&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">authenticated</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$user</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">isAdmin</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">route</span><span class="p">(</span><span class="s1">&#39;admin.dashboard&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">intended</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectPath</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">loggedOut</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">route</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="s1">&#39;You have been successfully logged out.&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="register-controller">Register Controller</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers\Auth</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Providers\RouteServiceProvider</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Auth\RegistersUsers</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Hash</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Validator</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">RegisterController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">RegistersUsers</span><span class="p">;</span>

    <span class="k">protected</span> <span class="nv">$redirectTo</span> <span class="o">=</span> <span class="nx">RouteServiceProvider</span><span class="o">::</span><span class="na">HOME</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">middleware</span><span class="p">(</span><span class="s1">&#39;guest&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">validator</span><span class="p">(</span><span class="k">array</span> <span class="nv">$data</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Validator</span><span class="o">::</span><span class="na">make</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;required&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="s1">&#39;max:255&#39;</span><span class="p">],</span>
            <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;required&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;max:255&#39;</span><span class="p">,</span> <span class="s1">&#39;unique:users&#39;</span><span class="p">],</span>
            <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;required&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="s1">&#39;min:8&#39;</span><span class="p">,</span> <span class="s1">&#39;confirmed&#39;</span><span class="p">],</span>
        <span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">create</span><span class="p">(</span><span class="k">array</span> <span class="nv">$data</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">User</span><span class="o">::</span><span class="na">create</span><span class="p">([</span>
            <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="nv">$data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
            <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="nv">$data</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">],</span>
            <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="nx">Hash</span><span class="o">::</span><span class="na">make</span><span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]),</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="authentication-routes">Authentication Routes</h2>
<h3 id="web-routes">Web Routes</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// routes/web.php</span>
<span class="x">use App\Http\Controllers\Auth\LoginController;</span>
<span class="x">use App\Http\Controllers\Auth\RegisterController;</span>

<span class="x">// Authentication Routes</span>
<span class="x">Route::middleware(&#39;guest&#39;)-&gt;group(function () {</span>
<span class="x">    Route::get(&#39;login&#39;, [LoginController::class, &#39;showLoginForm&#39;])-&gt;name(&#39;login&#39;);</span>
<span class="x">    Route::post(&#39;login&#39;, [LoginController::class, &#39;login&#39;]);</span>

<span class="x">    Route::get(&#39;register&#39;, [RegisterController::class, &#39;showRegistrationForm&#39;])-&gt;name(&#39;register&#39;);</span>
<span class="x">    Route::post(&#39;register&#39;, [RegisterController::class, &#39;register&#39;]);</span>
<span class="x">});</span>

<span class="x">Route::middleware(&#39;auth&#39;)-&gt;group(function () {</span>
<span class="x">    Route::post(&#39;logout&#39;, [LoginController::class, &#39;logout&#39;])-&gt;name(&#39;logout&#39;);</span>
<span class="x">    Route::get(&#39;profile&#39;, [ProfileController::class, &#39;show&#39;])-&gt;name(&#39;profile&#39;);</span>
<span class="x">});</span>
</code></pre></div>

<h3 id="api-routes">API Routes</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// routes/api.php</span>
<span class="x">use App\Http\Controllers\Auth\AuthController;</span>

<span class="x">Route::post(&#39;login&#39;, [AuthController::class, &#39;login&#39;]);</span>
<span class="x">Route::post(&#39;register&#39;, [AuthController::class, &#39;register&#39;]);</span>

<span class="x">Route::middleware(&#39;auth:sanctum&#39;)-&gt;group(function () {</span>
<span class="x">    Route::post(&#39;logout&#39;, [AuthController::class, &#39;logout&#39;]);</span>
<span class="x">    Route::get(&#39;user&#39;, [AuthController::class, &#39;user&#39;]);</span>
<span class="x">});</span>
</code></pre></div>

<h2 id="manual-authentication">Manual Authentication</h2>
<h3 id="logging-in">Logging In</h3>
<div class="codehilite"><pre><span></span><code><span class="x">use Illuminate\Support\Facades\Auth;</span>

<span class="x">// Attempt to log in</span>
<span class="x">if (Auth::attempt([&#39;email&#39; =&gt; $email, &#39;password&#39; =&gt; $password])) {</span>
<span class="x">    // Authentication successful</span>
<span class="x">    return redirect()-&gt;intended(&#39;/dashboard&#39;);</span>
<span class="x">}</span>

<span class="x">// Attempt with additional conditions</span>
<span class="x">if (Auth::attempt([&#39;email&#39; =&gt; $email, &#39;password&#39; =&gt; $password, &#39;active&#39; =&gt; 1])) {</span>
<span class="x">    // User is active and credentials are correct</span>
<span class="x">}</span>

<span class="x">// Remember user</span>
<span class="x">if (Auth::attempt([&#39;email&#39; =&gt; $email, &#39;password&#39; =&gt; $password], $remember)) {</span>
<span class="x">    // User will be remembered</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="logging-out">Logging Out</h3>
<div class="codehilite"><pre><span></span><code><span class="x">use Illuminate\Support\Facades\Auth;</span>

<span class="x">// Log out the current user</span>
<span class="x">Auth::logout();</span>

<span class="x">// Log out and invalidate session</span>
<span class="x">Auth::logout();</span>
<span class="x">$request-&gt;session()-&gt;invalidate();</span>
<span class="x">$request-&gt;session()-&gt;regenerateToken();</span>
</code></pre></div>

<h3 id="checking-authentication-status">Checking Authentication Status</h3>
<div class="codehilite"><pre><span></span><code><span class="x">use Illuminate\Support\Facades\Auth;</span>

<span class="x">// Check if user is authenticated</span>
<span class="x">if (Auth::check()) {</span>
<span class="x">    // User is logged in</span>
<span class="x">}</span>

<span class="x">// Get current user</span>
<span class="x">$user = Auth::user();</span>

<span class="x">// Get user ID</span>
<span class="x">$userId = Auth::id();</span>

<span class="x">// Check if user is guest</span>
<span class="x">if (Auth::guest()) {</span>
<span class="x">    // User is not logged in</span>
<span class="x">}</span>
</code></pre></div>

<h2 id="password-reset">Password Reset</h2>
<h3 id="password-reset-controller">Password Reset Controller</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers\Auth</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Auth\SendsPasswordResetEmails</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Auth\ResetsPasswords</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ForgotPasswordController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">SendsPasswordResetEmails</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">middleware</span><span class="p">(</span><span class="s1">&#39;guest&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">ResetPasswordController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">ResetsPasswords</span><span class="p">;</span>

    <span class="k">protected</span> <span class="nv">$redirectTo</span> <span class="o">=</span> <span class="s1">&#39;/home&#39;</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">middleware</span><span class="p">(</span><span class="s1">&#39;guest&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="password-reset-routes">Password Reset Routes</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// routes/web.php</span>
<span class="x">use App\Http\Controllers\Auth\ForgotPasswordController;</span>
<span class="x">use App\Http\Controllers\Auth\ResetPasswordController;</span>

<span class="x">Route::get(&#39;password/reset&#39;, [ForgotPasswordController::class, &#39;showLinkRequestForm&#39;])</span>
<span class="x">    -&gt;name(&#39;password.request&#39;);</span>
<span class="x">Route::post(&#39;password/email&#39;, [ForgotPasswordController::class, &#39;sendResetLinkEmail&#39;])</span>
<span class="x">    -&gt;name(&#39;password.email&#39;);</span>

<span class="x">Route::get(&#39;password/reset/{token}&#39;, [ResetPasswordController::class, &#39;showResetForm&#39;])</span>
<span class="x">    -&gt;name(&#39;password.reset&#39;);</span>
<span class="x">Route::post(&#39;password/reset&#39;, [ResetPasswordController::class, &#39;reset&#39;])</span>
<span class="x">    -&gt;name(&#39;password.update&#39;);</span>
</code></pre></div>

<h3 id="custom-password-reset">Custom Password Reset</h3>
<div class="codehilite"><pre><span></span><code><span class="x">use Illuminate\Support\Facades\Password;</span>
<span class="x">use Illuminate\Support\Facades\Hash;</span>

<span class="x">// Send password reset link</span>
<span class="x">$status = Password::sendResetLink($request-&gt;only(&#39;email&#39;));</span>

<span class="x">// Reset password</span>
<span class="x">$status = Password::reset($request-&gt;only(&#39;email&#39;, &#39;password&#39;, &#39;password_confirmation&#39;, &#39;token&#39;), function ($user, $password) {</span>
<span class="x">    $user-&gt;forceFill([</span>
<span class="x">        &#39;password&#39; =&gt; Hash::make($password)</span>
<span class="x">    ])-&gt;save();</span>
<span class="x">});</span>
</code></pre></div>

<h2 id="email-verification">Email Verification</h2>
<h3 id="enabling-email-verification">Enabling Email Verification</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// User model</span>
<span class="x">use Illuminate\Contracts\Auth\MustVerifyEmail;</span>

<span class="x">class User extends Authenticatable implements MustVerifyEmail</span>
<span class="x">{</span>
<span class="x">    // ...</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="email-verification-controller">Email Verification Controller</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers\Auth</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Auth\VerifiesEmails</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">VerificationController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">VerifiesEmails</span><span class="p">;</span>

    <span class="k">protected</span> <span class="nv">$redirectTo</span> <span class="o">=</span> <span class="s1">&#39;/home&#39;</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">middleware</span><span class="p">(</span><span class="s1">&#39;auth&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">middleware</span><span class="p">(</span><span class="s1">&#39;signed&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">only</span><span class="p">(</span><span class="s1">&#39;verify&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">middleware</span><span class="p">(</span><span class="s1">&#39;throttle:6,1&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">only</span><span class="p">(</span><span class="s1">&#39;verify&#39;</span><span class="p">,</span> <span class="s1">&#39;resend&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="email-verification-routes">Email Verification Routes</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// routes/web.php</span>
<span class="x">use App\Http\Controllers\Auth\VerificationController;</span>

<span class="x">Route::get(&#39;email/verify&#39;, [VerificationController::class, &#39;show&#39;])</span>
<span class="x">    -&gt;name(&#39;verification.notice&#39;);</span>
<span class="x">Route::get(&#39;email/verify/{id}/{hash}&#39;, [VerificationController::class, &#39;verify&#39;])</span>
<span class="x">    -&gt;name(&#39;verification.verify&#39;);</span>
<span class="x">Route::post(&#39;email/resend&#39;, [VerificationController::class, &#39;resend&#39;])</span>
<span class="x">    -&gt;name(&#39;verification.resend&#39;);</span>
</code></pre></div>

<h2 id="authorization">Authorization</h2>
<h3 id="gates">Gates</h3>
<p>Gates are simple closures that determine if a user is authorized to perform a given action:</p>
<div class="codehilite"><pre><span></span><code><span class="x">// In AuthServiceProvider</span>
<span class="x">use Illuminate\Support\Facades\Gate;</span>

<span class="x">public function boot()</span>
<span class="x">{</span>
<span class="x">    Gate::define(&#39;update-post&#39;, function (User $user, Post $post) {</span>
<span class="x">        return $user-&gt;id === $post-&gt;user_id;</span>
<span class="x">    });</span>

<span class="x">    Gate::define(&#39;delete-post&#39;, function (User $user, Post $post) {</span>
<span class="x">        return $user-&gt;id === $post-&gt;user_id || $user-&gt;isAdmin();</span>
<span class="x">    });</span>

<span class="x">    Gate::define(&#39;admin-access&#39;, function (User $user) {</span>
<span class="x">        return $user-&gt;role === &#39;admin&#39;;</span>
<span class="x">    });</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="using-gates">Using Gates</h3>
<div class="codehilite"><pre><span></span><code><span class="x">use Illuminate\Support\Facades\Gate;</span>

<span class="x">// Check if user can perform action</span>
<span class="x">if (Gate::allows(&#39;update-post&#39;, $post)) {</span>
<span class="x">    // User can update the post</span>
<span class="x">}</span>

<span class="x">// Check if user cannot perform action</span>
<span class="x">if (Gate::denies(&#39;delete-post&#39;, $post)) {</span>
<span class="x">    abort(403);</span>
<span class="x">}</span>

<span class="x">// Check for any user</span>
<span class="x">if (Gate::forUser($user)-&gt;allows(&#39;update-post&#39;, $post)) {</span>
<span class="x">    // Specific user can update the post</span>
<span class="x">}</span>

<span class="x">// In Blade templates</span>
<span class="x">@can(&#39;update-post&#39;, $post)</span>
<span class="x">    &lt;a href=&quot;{{ route(&#39;posts.edit&#39;, $post) }}&quot;&gt;Edit&lt;/a&gt;</span>
<span class="x">@endcan</span>

<span class="x">@cannot(&#39;delete-post&#39;, $post)</span>
<span class="x">    &lt;p&gt;You cannot delete this post.&lt;/p&gt;</span>
<span class="x">@endcannot</span>
</code></pre></div>

<h3 id="policies">Policies</h3>
<p>Policies are classes that organize authorization logic around a particular model:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Create policy</span>
php<span class="w"> </span>artisan<span class="w"> </span>make:policy<span class="w"> </span>PostPolicy<span class="w"> </span>--model<span class="o">=</span>Post
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Policies</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\Post</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PostPolicy</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">viewAny</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">true</span><span class="p">;</span> <span class="c1">// Anyone can view posts</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">view</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">,</span> <span class="nx">Post</span> <span class="nv">$post</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">true</span><span class="p">;</span> <span class="c1">// Anyone can view a specific post</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">create</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">isVerified</span><span class="p">();</span> <span class="c1">// Only verified users can create posts</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">,</span> <span class="nx">Post</span> <span class="nv">$post</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">===</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">user_id</span> <span class="o">||</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">isAdmin</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">delete</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">,</span> <span class="nx">Post</span> <span class="nv">$post</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">===</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">user_id</span> <span class="o">||</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">isAdmin</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">restore</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">,</span> <span class="nx">Post</span> <span class="nv">$post</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">isAdmin</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">forceDelete</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">,</span> <span class="nx">Post</span> <span class="nv">$post</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">isAdmin</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="registering-policies">Registering Policies</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// In AuthServiceProvider</span>
<span class="x">protected $policies = [</span>
<span class="x">    Post::class =&gt; PostPolicy::class,</span>
<span class="x">    Comment::class =&gt; CommentPolicy::class,</span>
<span class="x">];</span>
</code></pre></div>

<h3 id="using-policies">Using Policies</h3>
<div class="codehilite"><pre><span></span><code><span class="x">use Illuminate\Support\Facades\Gate;</span>

<span class="x">// Check authorization</span>
<span class="x">if (Gate::allows(&#39;update&#39;, $post)) {</span>
<span class="x">    // User can update the post</span>
<span class="x">}</span>

<span class="x">// Authorize action (throws exception if not authorized)</span>
<span class="x">Gate::authorize(&#39;update&#39;, $post);</span>

<span class="x">// In controllers</span>
<span class="x">public function update(Request $request, Post $post)</span>
<span class="x">{</span>
<span class="x">    $this-&gt;authorize(&#39;update&#39;, $post);</span>

<span class="x">    // Update the post</span>
<span class="x">}</span>

<span class="x">// In Blade templates</span>
<span class="x">@can(&#39;update&#39;, $post)</span>
<span class="x">    &lt;a href=&quot;{{ route(&#39;posts.edit&#39;, $post) }}&quot;&gt;Edit&lt;/a&gt;</span>
<span class="x">@endcan</span>
</code></pre></div>

<h2 id="role-based-authorization">Role-Based Authorization</h2>
<h3 id="user-roles">User Roles</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// User model</span>
<span class="x">class User extends Authenticatable</span>
<span class="x">{</span>
<span class="x">    public function hasRole($role)</span>
<span class="x">    {</span>
<span class="x">        return $this-&gt;role === $role;</span>
<span class="x">    }</span>

<span class="x">    public function hasAnyRole($roles)</span>
<span class="x">    {</span>
<span class="x">        return in_array($this-&gt;role, (array) $roles);</span>
<span class="x">    }</span>

<span class="x">    public function hasAllRoles($roles)</span>
<span class="x">    {</span>
<span class="x">        return empty(array_diff((array) $roles, [$this-&gt;role]));</span>
<span class="x">    }</span>

<span class="x">    public function isAdmin()</span>
<span class="x">    {</span>
<span class="x">        return $this-&gt;hasRole(&#39;admin&#39;);</span>
<span class="x">    }</span>

<span class="x">    public function isModerator()</span>
<span class="x">    {</span>
<span class="x">        return $this-&gt;hasRole(&#39;moderator&#39;);</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="role-middleware">Role Middleware</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CheckRole</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">,</span> <span class="o">...</span><span class="nv">$roles</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span> <span class="o">||</span> <span class="o">!</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">hasAnyRole</span><span class="p">(</span><span class="nv">$roles</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">abort</span><span class="p">(</span><span class="mi">403</span><span class="p">,</span> <span class="s1">&#39;Unauthorized action.&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="using-role-middleware">Using Role Middleware</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// routes/web.php</span>
<span class="x">Route::middleware([&#39;auth&#39;, &#39;role:admin&#39;])-&gt;group(function () {</span>
<span class="x">    Route::get(&#39;/admin&#39;, [AdminController::class, &#39;index&#39;]);</span>
<span class="x">});</span>

<span class="x">Route::middleware([&#39;auth&#39;, &#39;role:admin,moderator&#39;])-&gt;group(function () {</span>
<span class="x">    Route::get(&#39;/moderate&#39;, [ModerationController::class, &#39;index&#39;]);</span>
<span class="x">});</span>
</code></pre></div>

<h2 id="api-authentication-with-sanctum">API Authentication with Sanctum</h2>
<h3 id="installing-sanctum">Installing Sanctum</h3>
<div class="codehilite"><pre><span></span><code>composer<span class="w"> </span>require<span class="w"> </span>laravel/sanctum
php<span class="w"> </span>artisan<span class="w"> </span>vendor:publish<span class="w"> </span>--provider<span class="o">=</span><span class="s2">&quot;Laravel\Sanctum\SanctumServiceProvider&quot;</span>
php<span class="w"> </span>artisan<span class="w"> </span>migrate
</code></pre></div>

<h3 id="api-authentication-controller">API Authentication Controller</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers\Auth</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Auth</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Hash</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Validation\ValidationException</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AuthController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">([</span>
            <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|string|max:255&#39;</span><span class="p">,</span>
            <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|string|email|max:255|unique:users&#39;</span><span class="p">,</span>
            <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|string|min:8|confirmed&#39;</span><span class="p">,</span>
        <span class="p">]);</span>

        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">create</span><span class="p">([</span>
            <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">,</span>
            <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">email</span><span class="p">,</span>
            <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="nx">Hash</span><span class="o">::</span><span class="na">make</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">password</span><span class="p">),</span>
        <span class="p">]);</span>

        <span class="nv">$token</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">createToken</span><span class="p">(</span><span class="s1">&#39;auth_token&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">plainTextToken</span><span class="p">;</span>

        <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">([</span>
            <span class="s1">&#39;user&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="p">,</span>
            <span class="s1">&#39;token&#39;</span> <span class="o">=&gt;</span> <span class="nv">$token</span><span class="p">,</span>
        <span class="p">],</span> <span class="mi">201</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">login</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">([</span>
            <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required|email&#39;</span><span class="p">,</span>
            <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span>
        <span class="p">]);</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Auth</span><span class="o">::</span><span class="na">attempt</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">only</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">)))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="nx">ValidationException</span><span class="o">::</span><span class="na">withMessages</span><span class="p">([</span>
                <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;The provided credentials are incorrect.&#39;</span><span class="p">],</span>
            <span class="p">]);</span>
        <span class="p">}</span>

        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">email</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">firstOrFail</span><span class="p">();</span>
        <span class="nv">$token</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">createToken</span><span class="p">(</span><span class="s1">&#39;auth_token&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">plainTextToken</span><span class="p">;</span>

        <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">([</span>
            <span class="s1">&#39;user&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="p">,</span>
            <span class="s1">&#39;token&#39;</span> <span class="o">=&gt;</span> <span class="nv">$token</span><span class="p">,</span>
        <span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">logout</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">currentAccessToken</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">();</span>

        <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">([</span><span class="s1">&#39;message&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Logged out successfully&#39;</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">user</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="api-routes_1">API Routes</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// routes/api.php</span>
<span class="x">Route::post(&#39;register&#39;, [AuthController::class, &#39;register&#39;]);</span>
<span class="x">Route::post(&#39;login&#39;, [AuthController::class, &#39;login&#39;]);</span>

<span class="x">Route::middleware(&#39;auth:sanctum&#39;)-&gt;group(function () {</span>
<span class="x">    Route::post(&#39;logout&#39;, [AuthController::class, &#39;logout&#39;]);</span>
<span class="x">    Route::get(&#39;user&#39;, [AuthController::class, &#39;user&#39;]);</span>
<span class="x">});</span>
</code></pre></div>

<h2 id="authentication-best-practices">Authentication Best Practices</h2>
<h3 id="1-use-strong-passwords">1. Use Strong Passwords</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// In validation rules</span>
<span class="x">&#39;password&#39; =&gt; [</span>
<span class="x">    &#39;required&#39;,</span>
<span class="x">    &#39;string&#39;,</span>
<span class="x">    &#39;min:8&#39;,</span>
<span class="x">    &#39;regex:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&amp;])[A-Za-z\d@$!%*?&amp;]{8,}$/&#39;,</span>
<span class="x">    &#39;confirmed&#39;,</span>
<span class="x">],</span>
</code></pre></div>

<h3 id="2-implement-rate-limiting">2. Implement Rate Limiting</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// In routes</span>
<span class="x">Route::post(&#39;login&#39;, [LoginController::class, &#39;login&#39;])</span>
<span class="x">    -&gt;middleware(&#39;throttle:5,1&#39;); // 5 attempts per minute</span>

<span class="x">Route::post(&#39;password/email&#39;, [ForgotPasswordController::class, &#39;sendResetLinkEmail&#39;])</span>
<span class="x">    -&gt;middleware(&#39;throttle:3,1&#39;); // 3 attempts per minute</span>
</code></pre></div>

<h3 id="3-use-https-in-production">3. Use HTTPS in Production</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// In AppServiceProvider</span>
<span class="x">public function boot()</span>
<span class="x">{</span>
<span class="x">    if (app()-&gt;environment(&#39;production&#39;)) {</span>
<span class="x">        \URL::forceScheme(&#39;https&#39;);</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="4-implement-two-factor-authentication">4. Implement Two-Factor Authentication</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Using Laravel Fortify</span>
<span class="x">composer require laravel/fortify</span>
<span class="x">php artisan vendor:publish --provider=&quot;Laravel\Fortify\FortifyServiceProvider&quot;</span>
</code></pre></div>

<h3 id="5-log-authentication-events">5. Log Authentication Events</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// In EventServiceProvider</span>
<span class="x">protected $listen = [</span>
<span class="x">    &#39;Illuminate\Auth\Events\Login&#39; =&gt; [</span>
<span class="x">        &#39;App\Listeners\LogSuccessfulLogin&#39;,</span>
<span class="x">    ],</span>
<span class="x">    &#39;Illuminate\Auth\Events\Failed&#39; =&gt; [</span>
<span class="x">        &#39;App\Listeners\LogFailedLogin&#39;,</span>
<span class="x">    ],</span>
<span class="x">    &#39;Illuminate\Auth\Events\Logout&#39; =&gt; [</span>
<span class="x">        &#39;App\Listeners\LogSuccessfulLogout&#39;,</span>
<span class="x">    ],</span>
<span class="x">];</span>
</code></pre></div>

<h2 id="summary">Summary</h2>
<p>In this chapter, we covered:</p>
<ul>
<li>✅ Laravel authentication packages (Breeze, Jetstream, Fortify)</li>
<li>✅ Basic authentication setup and configuration</li>
<li>✅ Authentication controllers and routes</li>
<li>✅ Manual authentication methods</li>
<li>✅ Password reset functionality</li>
<li>✅ Email verification</li>
<li>✅ Authorization with Gates and Policies</li>
<li>✅ Role-based authorization</li>
<li>✅ API authentication with Sanctum</li>
<li>✅ Authentication best practices</li>
</ul>
<p>Authentication and authorization are crucial for securing your Laravel application. In the next chapter, we'll explore events and queues for handling background tasks.</p></div><div class="chapter" id="10-events-queues"><h1 id="chapter-10-events-queues">Chapter 10: Events &amp; Queues</h1>
<h2 id="what-are-events">What are Events?</h2>
<p>Events in Laravel provide a simple observer pattern implementation that allows you to subscribe and listen for various events that occur in your application. Events are great for decoupling various aspects of your application, since a single event can have multiple listeners that do not depend on each other.</p>
<h2 id="creating-events">Creating Events</h2>
<h3 id="using-artisan-command">Using Artisan Command</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Create event</span>
php<span class="w"> </span>artisan<span class="w"> </span>make:event<span class="w"> </span>UserRegistered

<span class="c1"># Create event with model</span>
php<span class="w"> </span>artisan<span class="w"> </span>make:event<span class="w"> </span>UserRegistered<span class="w"> </span>--model<span class="o">=</span>User
</code></pre></div>

<h3 id="basic-event-structure">Basic Event Structure</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Events</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Broadcasting\Channel</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Broadcasting\InteractsWithSockets</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Broadcasting\PresenceChannel</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Broadcasting\PrivateChannel</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Broadcasting\ShouldBroadcast</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Events\Dispatchable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\SerializesModels</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserRegistered</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Dispatchable</span><span class="p">,</span> <span class="nx">InteractsWithSockets</span><span class="p">,</span> <span class="nx">SerializesModels</span><span class="p">;</span>

    <span class="k">public</span> <span class="nv">$user</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new event instance.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span> <span class="o">=</span> <span class="nv">$user</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Get the channels the event should broadcast on.</span>
<span class="sd">     *</span>
<span class="sd">     * @return array&lt;int, \Illuminate\Broadcasting\Channel&gt;</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">broadcastOn</span><span class="p">()</span><span class="o">:</span> <span class="k">array</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="k">new</span> <span class="nx">PrivateChannel</span><span class="p">(</span><span class="s1">&#39;channel-name&#39;</span><span class="p">),</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="broadcasting-events">Broadcasting Events</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Events</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Broadcasting\Channel</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Broadcasting\InteractsWithSockets</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Broadcasting\PresenceChannel</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Broadcasting\PrivateChannel</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Broadcasting\ShouldBroadcast</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Events\Dispatchable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\SerializesModels</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserStatusChanged</span> <span class="k">implements</span> <span class="nx">ShouldBroadcast</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Dispatchable</span><span class="p">,</span> <span class="nx">InteractsWithSockets</span><span class="p">,</span> <span class="nx">SerializesModels</span><span class="p">;</span>

    <span class="k">public</span> <span class="nv">$user</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$status</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">,</span> <span class="nv">$status</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span> <span class="o">=</span> <span class="nv">$user</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">status</span> <span class="o">=</span> <span class="nv">$status</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">broadcastOn</span><span class="p">()</span><span class="o">:</span> <span class="k">array</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="k">new</span> <span class="nx">PrivateChannel</span><span class="p">(</span><span class="s1">&#39;user.&#39;</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">),</span>
        <span class="p">];</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">broadcastAs</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;user.status.changed&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">broadcastWith</span><span class="p">()</span><span class="o">:</span> <span class="k">array</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">&#39;user_id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">,</span>
            <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">status</span><span class="p">,</span>
            <span class="s1">&#39;timestamp&#39;</span> <span class="o">=&gt;</span> <span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">toISOString</span><span class="p">(),</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="creating-listeners">Creating Listeners</h2>
<h3 id="using-artisan-command_1">Using Artisan Command</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Create listener</span>
php<span class="w"> </span>artisan<span class="w"> </span>make:listener<span class="w"> </span>SendWelcomeEmail

<span class="c1"># Create listener for specific event</span>
php<span class="w"> </span>artisan<span class="w"> </span>make:listener<span class="w"> </span>SendWelcomeEmail<span class="w"> </span>--event<span class="o">=</span>UserRegistered
</code></pre></div>

<h3 id="basic-listener-structure">Basic Listener Structure</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Listeners</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Events\UserRegistered</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Queue\ShouldQueue</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\InteractsWithQueue</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SendWelcomeEmail</span> <span class="k">implements</span> <span class="nx">ShouldQueue</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">InteractsWithQueue</span><span class="p">;</span>

    <span class="k">public</span> <span class="nv">$tries</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$timeout</span> <span class="o">=</span> <span class="mi">120</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create the event listener.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Handle the event.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">UserRegistered</span> <span class="nv">$event</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="c1">// Send welcome email to the user</span>
        <span class="nx">Mail</span><span class="o">::</span><span class="na">to</span><span class="p">(</span><span class="nv">$event</span><span class="o">-&gt;</span><span class="na">user</span><span class="o">-&gt;</span><span class="na">email</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="k">new</span> <span class="nx">WelcomeEmail</span><span class="p">(</span><span class="nv">$event</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Handle a job failure.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">failed</span><span class="p">(</span><span class="nx">UserRegistered</span> <span class="nv">$event</span><span class="p">,</span> <span class="nx">\Throwable</span> <span class="nv">$exception</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="c1">// Handle the failure</span>
        <span class="nx">Log</span><span class="o">::</span><span class="na">error</span><span class="p">(</span><span class="s1">&#39;Failed to send welcome email&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;user_id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">user</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">,</span>
            <span class="s1">&#39;error&#39;</span> <span class="o">=&gt;</span> <span class="nv">$exception</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">(),</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="queueable-listeners">Queueable Listeners</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Listeners</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Events\UserRegistered</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Queue\ShouldQueue</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\InteractsWithQueue</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SendWelcomeEmail</span> <span class="k">implements</span> <span class="nx">ShouldQueue</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">InteractsWithQueue</span><span class="p">;</span>

    <span class="k">public</span> <span class="nv">$connection</span> <span class="o">=</span> <span class="s1">&#39;redis&#39;</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$queue</span> <span class="o">=</span> <span class="s1">&#39;emails&#39;</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$delay</span> <span class="o">=</span> <span class="mi">60</span><span class="p">;</span> <span class="c1">// Delay in seconds</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">UserRegistered</span> <span class="nv">$event</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="c1">// This will be queued</span>
        <span class="nx">Mail</span><span class="o">::</span><span class="na">to</span><span class="p">(</span><span class="nv">$event</span><span class="o">-&gt;</span><span class="na">user</span><span class="o">-&gt;</span><span class="na">email</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="k">new</span> <span class="nx">WelcomeEmail</span><span class="p">(</span><span class="nv">$event</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="registering-events-and-listeners">Registering Events and Listeners</h2>
<h3 id="in-eventserviceprovider">In EventServiceProvider</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Providers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Events\UserRegistered</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Listeners\SendWelcomeEmail</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Listeners\CreateUserProfile</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Listeners\SendAdminNotification</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Support\Providers\EventServiceProvider</span> <span class="k">as</span> <span class="nx">ServiceProvider</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">EventServiceProvider</span> <span class="k">extends</span> <span class="nx">ServiceProvider</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * The event to listener mappings for the application.</span>
<span class="sd">     *</span>
<span class="sd">     * @var array&lt;class-string, array&lt;int, class-string&gt;&gt;</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$listen</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nx">UserRegistered</span><span class="o">::</span><span class="na">class</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="nx">SendWelcomeEmail</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
            <span class="nx">CreateUserProfile</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
            <span class="nx">SendAdminNotification</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="p">],</span>

        <span class="s1">&#39;Illuminate\Auth\Events\Login&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;App\Listeners\LogSuccessfulLogin&#39;</span><span class="p">,</span>
        <span class="p">],</span>

        <span class="s1">&#39;Illuminate\Auth\Events\Failed&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;App\Listeners\LogFailedLogin&#39;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">];</span>

    <span class="sd">/**</span>
<span class="sd">     * Register any events for your application.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">boot</span><span class="p">();</span>

        <span class="c1">// Register events using wildcards</span>
        <span class="nx">Event</span><span class="o">::</span><span class="na">listen</span><span class="p">(</span><span class="s1">&#39;user.*&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$eventName</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$data</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Log</span><span class="o">::</span><span class="na">info</span><span class="p">(</span><span class="s2">&quot;User event: </span><span class="si">{</span><span class="nv">$eventName</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">$data</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="dispatching-events">Dispatching Events</h2>
<h3 id="using-event-facade">Using Event Facade</h3>
<div class="codehilite"><pre><span></span><code><span class="x">use App\Events\UserRegistered;</span>
<span class="x">use Illuminate\Support\Facades\Event;</span>

<span class="x">// Dispatch event</span>
<span class="x">Event::dispatch(new UserRegistered($user));</span>

<span class="x">// Or use the event class directly</span>
<span class="x">UserRegistered::dispatch($user);</span>
</code></pre></div>

<h3 id="in-controllers">In Controllers</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Events\UserRegistered</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">store</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">validated</span><span class="p">());</span>

        <span class="c1">// Dispatch event</span>
        <span class="nx">UserRegistered</span><span class="o">::</span><span class="na">dispatch</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>

        <span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">route</span><span class="p">(</span><span class="s1">&#39;users.show&#39;</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="in-models">In Models</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Events\UserRegistered</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Auth\User</span> <span class="k">as</span> <span class="nx">Authenticatable</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Authenticatable</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$dispatchesEvents</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;created&#39;</span> <span class="o">=&gt;</span> <span class="nx">UserRegistered</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="p">];</span>

    <span class="c1">// Or manually in the model</span>
    <span class="k">protected</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">booted</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">static</span><span class="o">::</span><span class="na">created</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">UserRegistered</span><span class="o">::</span><span class="na">dispatch</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
        <span class="p">});</span>

        <span class="k">static</span><span class="o">::</span><span class="na">updated</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">UserStatusChanged</span><span class="o">::</span><span class="na">dispatch</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">status</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="event-subscribers">Event Subscribers</h2>
<h3 id="creating-subscribers">Creating Subscribers</h3>
<div class="codehilite"><pre><span></span><code>php<span class="w"> </span>artisan<span class="w"> </span>make:listener<span class="w"> </span>UserEventSubscriber
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Listeners</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Events\UserRegistered</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Events\UserUpdated</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Events\UserDeleted</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Events\Dispatcher</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserEventSubscriber</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handleUserRegistered</span><span class="p">(</span><span class="nv">$event</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="c1">// Handle user registered event</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">handleUserUpdated</span><span class="p">(</span><span class="nv">$event</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="c1">// Handle user updated event</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">handleUserDeleted</span><span class="p">(</span><span class="nv">$event</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="c1">// Handle user deleted event</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">subscribe</span><span class="p">(</span><span class="nx">Dispatcher</span> <span class="nv">$events</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$events</span><span class="o">-&gt;</span><span class="na">listen</span><span class="p">(</span>
            <span class="nx">UserRegistered</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
            <span class="p">[</span><span class="nx">UserEventSubscriber</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">&#39;handleUserRegistered&#39;</span><span class="p">]</span>
        <span class="p">);</span>

        <span class="nv">$events</span><span class="o">-&gt;</span><span class="na">listen</span><span class="p">(</span>
            <span class="nx">UserUpdated</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
            <span class="p">[</span><span class="nx">UserEventSubscriber</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">&#39;handleUserUpdated&#39;</span><span class="p">]</span>
        <span class="p">);</span>

        <span class="nv">$events</span><span class="o">-&gt;</span><span class="na">listen</span><span class="p">(</span>
            <span class="nx">UserDeleted</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
            <span class="p">[</span><span class="nx">UserEventSubscriber</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">&#39;handleUserDeleted&#39;</span><span class="p">]</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="registering-subscribers">Registering Subscribers</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// In EventServiceProvider</span>
<span class="x">protected $subscribe = [</span>
<span class="x">    UserEventSubscriber::class,</span>
<span class="x">];</span>
</code></pre></div>

<h2 id="queues">Queues</h2>
<h3 id="what-are-queues">What are Queues?</h3>
<p>Queues allow you to defer the processing of a time-consuming task, such as sending an email, until a later time. This drastically speeds up web requests to your application.</p>
<h3 id="queue-configuration">Queue Configuration</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// config/queue.php</span>
<span class="x">return [</span>
<span class="x">    &#39;default&#39; =&gt; env(&#39;QUEUE_CONNECTION&#39;, &#39;sync&#39;),</span>

<span class="x">    &#39;connections&#39; =&gt; [</span>
<span class="x">        &#39;sync&#39; =&gt; [</span>
<span class="x">            &#39;driver&#39; =&gt; &#39;sync&#39;,</span>
<span class="x">        ],</span>

<span class="x">        &#39;database&#39; =&gt; [</span>
<span class="x">            &#39;driver&#39; =&gt; &#39;database&#39;,</span>
<span class="x">            &#39;table&#39; =&gt; &#39;jobs&#39;,</span>
<span class="x">            &#39;queue&#39; =&gt; &#39;default&#39;,</span>
<span class="x">            &#39;retry_after&#39; =&gt; 90,</span>
<span class="x">            &#39;after_commit&#39; =&gt; false,</span>
<span class="x">        ],</span>

<span class="x">        &#39;redis&#39; =&gt; [</span>
<span class="x">            &#39;driver&#39; =&gt; &#39;redis&#39;,</span>
<span class="x">            &#39;connection&#39; =&gt; &#39;default&#39;,</span>
<span class="x">            &#39;queue&#39; =&gt; env(&#39;REDIS_QUEUE&#39;, &#39;default&#39;),</span>
<span class="x">            &#39;retry_after&#39; =&gt; 90,</span>
<span class="x">            &#39;block_for&#39; =&gt; null,</span>
<span class="x">            &#39;after_commit&#39; =&gt; false,</span>
<span class="x">        ],</span>
<span class="x">    ],</span>
<span class="x">];</span>
</code></pre></div>

<h3 id="creating-jobs">Creating Jobs</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Create job</span>
php<span class="w"> </span>artisan<span class="w"> </span>make:job<span class="w"> </span>SendWelcomeEmail

<span class="c1"># Create job with model</span>
php<span class="w"> </span>artisan<span class="w"> </span>make:job<span class="w"> </span>ProcessOrder<span class="w"> </span>--model<span class="o">=</span>Order
</code></pre></div>

<h3 id="basic-job-structure">Basic Job Structure</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Jobs</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Bus\Queueable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Queue\ShouldQueue</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Bus\Dispatchable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\InteractsWithQueue</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\SerializesModels</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SendWelcomeEmail</span> <span class="k">implements</span> <span class="nx">ShouldQueue</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Dispatchable</span><span class="p">,</span> <span class="nx">InteractsWithQueue</span><span class="p">,</span> <span class="nx">Queueable</span><span class="p">,</span> <span class="nx">SerializesModels</span><span class="p">;</span>

    <span class="k">public</span> <span class="nv">$user</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$tries</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$timeout</span> <span class="o">=</span> <span class="mi">120</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$maxExceptions</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * Create a new job instance.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span> <span class="o">=</span> <span class="nv">$user</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Execute the job.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="c1">// Send welcome email</span>
        <span class="nx">Mail</span><span class="o">::</span><span class="na">to</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span><span class="o">-&gt;</span><span class="na">email</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="k">new</span> <span class="nx">WelcomeEmail</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Handle a job failure.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">failed</span><span class="p">(</span><span class="nx">\Throwable</span> <span class="nv">$exception</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="c1">// Handle the failure</span>
        <span class="nx">Log</span><span class="o">::</span><span class="na">error</span><span class="p">(</span><span class="s1">&#39;Failed to send welcome email&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;user_id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">,</span>
            <span class="s1">&#39;error&#39;</span> <span class="o">=&gt;</span> <span class="nv">$exception</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">(),</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="dispatching-jobs">Dispatching Jobs</h3>
<div class="codehilite"><pre><span></span><code><span class="x">use App\Jobs\SendWelcomeEmail;</span>

<span class="x">// Dispatch job</span>
<span class="x">SendWelcomeEmail::dispatch($user);</span>

<span class="x">// Dispatch with delay</span>
<span class="x">SendWelcomeEmail::dispatch($user)-&gt;delay(now()-&gt;addMinutes(10));</span>

<span class="x">// Dispatch to specific queue</span>
<span class="x">SendWelcomeEmail::dispatch($user)-&gt;onQueue(&#39;emails&#39;);</span>

<span class="x">// Dispatch with chain</span>
<span class="x">ProcessOrder::withChain([</span>
<span class="x">    new SendOrderConfirmation($order),</span>
<span class="x">    new UpdateInventory($order),</span>
<span class="x">])-&gt;dispatch($order);</span>
</code></pre></div>

<h3 id="job-batching">Job Batching</h3>
<div class="codehilite"><pre><span></span><code><span class="x">use Illuminate\Bus\Batch;</span>
<span class="x">use Illuminate\Support\Facades\Bus;</span>

<span class="x">$batch = Bus::batch([</span>
<span class="x">    new ProcessPodcast(Podcast::find(1)),</span>
<span class="x">    new ProcessPodcast(Podcast::find(2)),</span>
<span class="x">    new ProcessPodcast(Podcast::find(3)),</span>
<span class="x">])-&gt;then(function (Batch $batch) {</span>
<span class="x">    // All jobs completed successfully</span>
<span class="x">})-&gt;catch(function (Batch $batch, \Throwable $e) {</span>
<span class="x">    // First batch job failure</span>
<span class="x">})-&gt;finally(function (Batch $batch) {</span>
<span class="x">    // Batch completed</span>
<span class="x">})-&gt;dispatch();</span>
</code></pre></div>

<h2 id="queue-workers">Queue Workers</h2>
<h3 id="starting-queue-workers">Starting Queue Workers</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Start queue worker</span>
php<span class="w"> </span>artisan<span class="w"> </span>queue:work

<span class="c1"># Start with specific connection</span>
php<span class="w"> </span>artisan<span class="w"> </span>queue:work<span class="w"> </span>redis

<span class="c1"># Start with specific queue</span>
php<span class="w"> </span>artisan<span class="w"> </span>queue:work<span class="w"> </span>--queue<span class="o">=</span>high,default,low

<span class="c1"># Start with timeout</span>
php<span class="w"> </span>artisan<span class="w"> </span>queue:work<span class="w"> </span>--timeout<span class="o">=</span><span class="m">60</span>

<span class="c1"># Start with memory limit</span>
php<span class="w"> </span>artisan<span class="w"> </span>queue:work<span class="w"> </span>--memory<span class="o">=</span><span class="m">1024</span>

<span class="c1"># Start in daemon mode</span>
php<span class="w"> </span>artisan<span class="w"> </span>queue:work<span class="w"> </span>--daemon
</code></pre></div>

<h3 id="queue-monitoring">Queue Monitoring</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check queue status</span>
php<span class="w"> </span>artisan<span class="w"> </span>queue:monitor

<span class="c1"># Clear failed jobs</span>
php<span class="w"> </span>artisan<span class="w"> </span>queue:flush

<span class="c1"># Retry failed jobs</span>
php<span class="w"> </span>artisan<span class="w"> </span>queue:retry<span class="w"> </span>all

<span class="c1"># Retry specific failed job</span>
php<span class="w"> </span>artisan<span class="w"> </span>queue:retry<span class="w"> </span><span class="m">5</span>
</code></pre></div>

<h2 id="common-event-examples">Common Event Examples</h2>
<h3 id="user-registration-event">User Registration Event</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Events</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Events\Dispatchable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\SerializesModels</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserRegistered</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Dispatchable</span><span class="p">,</span> <span class="nx">SerializesModels</span><span class="p">;</span>

    <span class="k">public</span> <span class="nv">$user</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span> <span class="o">=</span> <span class="nv">$user</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="user-registration-listeners">User Registration Listeners</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Listeners</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Events\UserRegistered</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Jobs\SendWelcomeEmail</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Jobs\CreateUserProfile</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Queue\ShouldQueue</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SendWelcomeEmail</span> <span class="k">implements</span> <span class="nx">ShouldQueue</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">UserRegistered</span> <span class="nv">$event</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nx">SendWelcomeEmail</span><span class="o">::</span><span class="na">dispatch</span><span class="p">(</span><span class="nv">$event</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">CreateUserProfile</span> <span class="k">implements</span> <span class="nx">ShouldQueue</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">UserRegistered</span> <span class="nv">$event</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">user</span><span class="o">-&gt;</span><span class="na">profile</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">([</span>
            <span class="s1">&#39;bio&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;avatar&#39;</span> <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">SendAdminNotification</span> <span class="k">implements</span> <span class="nx">ShouldQueue</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">UserRegistered</span> <span class="nv">$event</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="c1">// Notify admin about new user</span>
        <span class="nx">Mail</span><span class="o">::</span><span class="na">to</span><span class="p">(</span><span class="s1">&#39;admin@example.com&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="k">new</span> <span class="nx">NewUserNotification</span><span class="p">(</span><span class="nv">$event</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="order-processing-event">Order Processing Event</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Events</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\Order</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Events\Dispatchable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\SerializesModels</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">OrderPlaced</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Dispatchable</span><span class="p">,</span> <span class="nx">SerializesModels</span><span class="p">;</span>

    <span class="k">public</span> <span class="nv">$order</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">Order</span> <span class="nv">$order</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">order</span> <span class="o">=</span> <span class="nv">$order</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="order-processing-listeners">Order Processing Listeners</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Listeners</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Events\OrderPlaced</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Jobs\SendOrderConfirmation</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Jobs\UpdateInventory</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Jobs\ProcessPayment</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Queue\ShouldQueue</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SendOrderConfirmation</span> <span class="k">implements</span> <span class="nx">ShouldQueue</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">OrderPlaced</span> <span class="nv">$event</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nx">SendOrderConfirmation</span><span class="o">::</span><span class="na">dispatch</span><span class="p">(</span><span class="nv">$event</span><span class="o">-&gt;</span><span class="na">order</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">UpdateInventory</span> <span class="k">implements</span> <span class="nx">ShouldQueue</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">OrderPlaced</span> <span class="nv">$event</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nx">UpdateInventory</span><span class="o">::</span><span class="na">dispatch</span><span class="p">(</span><span class="nv">$event</span><span class="o">-&gt;</span><span class="na">order</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">ProcessPayment</span> <span class="k">implements</span> <span class="nx">ShouldQueue</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">OrderPlaced</span> <span class="nv">$event</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nx">ProcessPayment</span><span class="o">::</span><span class="na">dispatch</span><span class="p">(</span><span class="nv">$event</span><span class="o">-&gt;</span><span class="na">order</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="common-job-examples">Common Job Examples</h2>
<h3 id="email-job">Email Job</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Jobs</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Mail\WelcomeEmail</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Bus\Queueable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Queue\ShouldQueue</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Bus\Dispatchable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\InteractsWithQueue</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\SerializesModels</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Mail</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SendWelcomeEmail</span> <span class="k">implements</span> <span class="nx">ShouldQueue</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Dispatchable</span><span class="p">,</span> <span class="nx">InteractsWithQueue</span><span class="p">,</span> <span class="nx">Queueable</span><span class="p">,</span> <span class="nx">SerializesModels</span><span class="p">;</span>

    <span class="k">public</span> <span class="nv">$user</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$tries</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span> <span class="o">=</span> <span class="nv">$user</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nx">Mail</span><span class="o">::</span><span class="na">to</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span><span class="o">-&gt;</span><span class="na">email</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span><span class="k">new</span> <span class="nx">WelcomeEmail</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">failed</span><span class="p">(</span><span class="nx">\Throwable</span> <span class="nv">$exception</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nx">Log</span><span class="o">::</span><span class="na">error</span><span class="p">(</span><span class="s1">&#39;Failed to send welcome email&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;user_id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">,</span>
            <span class="s1">&#39;error&#39;</span> <span class="o">=&gt;</span> <span class="nv">$exception</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">(),</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="file-processing-job">File Processing Job</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Jobs</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\File</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Bus\Queueable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Queue\ShouldQueue</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Bus\Dispatchable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\InteractsWithQueue</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\SerializesModels</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Storage</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ProcessUploadedFile</span> <span class="k">implements</span> <span class="nx">ShouldQueue</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Dispatchable</span><span class="p">,</span> <span class="nx">InteractsWithQueue</span><span class="p">,</span> <span class="nx">Queueable</span><span class="p">,</span> <span class="nx">SerializesModels</span><span class="p">;</span>

    <span class="k">public</span> <span class="nv">$file</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$timeout</span> <span class="o">=</span> <span class="mi">300</span><span class="p">;</span> <span class="c1">// 5 minutes</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">File</span> <span class="nv">$file</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">file</span> <span class="o">=</span> <span class="nv">$file</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$path</span> <span class="o">=</span> <span class="nx">Storage</span><span class="o">::</span><span class="na">path</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">file</span><span class="o">-&gt;</span><span class="na">path</span><span class="p">);</span>

        <span class="c1">// Process the file</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">file</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">([</span>
            <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;processing&#39;</span><span class="p">,</span>
        <span class="p">]);</span>

        <span class="c1">// Simulate file processing</span>
        <span class="nb">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">file</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">([</span>
            <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;completed&#39;</span><span class="p">,</span>
            <span class="s1">&#39;processed_at&#39;</span> <span class="o">=&gt;</span> <span class="nx">now</span><span class="p">(),</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="api-job">API Job</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Jobs</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Bus\Queueable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Queue\ShouldQueue</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Bus\Dispatchable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\InteractsWithQueue</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\SerializesModels</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Http</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SyncUserToExternalAPI</span> <span class="k">implements</span> <span class="nx">ShouldQueue</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Dispatchable</span><span class="p">,</span> <span class="nx">InteractsWithQueue</span><span class="p">,</span> <span class="nx">Queueable</span><span class="p">,</span> <span class="nx">SerializesModels</span><span class="p">;</span>

    <span class="k">public</span> <span class="nv">$user</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$tries</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span> <span class="o">=</span> <span class="nv">$user</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nx">Http</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;https://api.example.com/users&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">,</span>
            <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span><span class="o">-&gt;</span><span class="na">email</span><span class="p">,</span>
        <span class="p">]);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">successful</span><span class="p">())</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">([</span>
                <span class="s1">&#39;external_id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">),</span>
                <span class="s1">&#39;synced_at&#39;</span> <span class="o">=&gt;</span> <span class="nx">now</span><span class="p">(),</span>
            <span class="p">]);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">\Exception</span><span class="p">(</span><span class="s1">&#39;Failed to sync user to external API&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="best-practices">Best Practices</h2>
<h3 id="1-keep-events-simple">1. Keep Events Simple</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Good</span>
<span class="x">class UserRegistered</span>
<span class="x">{</span>
<span class="x">    public $user;</span>

<span class="x">    public function __construct(User $user)</span>
<span class="x">    {</span>
<span class="x">        $this-&gt;user = $user;</span>
<span class="x">    }</span>
<span class="x">}</span>

<span class="x">// Bad - Too much data</span>
<span class="x">class UserRegistered</span>
<span class="x">{</span>
<span class="x">    public $user;</span>
<span class="x">    public $ip;</span>
<span class="x">    public $userAgent;</span>
<span class="x">    public $timestamp;</span>
<span class="x">    public $referrer;</span>
<span class="x">    // ... many more properties</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="2-use-queues-for-heavy-operations">2. Use Queues for Heavy Operations</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Good - Queue heavy operations</span>
<span class="x">class SendWelcomeEmail implements ShouldQueue</span>
<span class="x">{</span>
<span class="x">    public function handle(UserRegistered $event): void</span>
<span class="x">    {</span>
<span class="x">        // This will be queued</span>
<span class="x">        Mail::to($event-&gt;user-&gt;email)-&gt;send(new WelcomeEmail($event-&gt;user));</span>
<span class="x">    }</span>
<span class="x">}</span>

<span class="x">// Bad - Blocking operation</span>
<span class="x">class SendWelcomeEmail</span>
<span class="x">{</span>
<span class="x">    public function handle(UserRegistered $event): void</span>
<span class="x">    {</span>
<span class="x">        // This blocks the request</span>
<span class="x">        Mail::to($event-&gt;user-&gt;email)-&gt;send(new WelcomeEmail($event-&gt;user));</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="3-handle-job-failures">3. Handle Job Failures</h3>
<div class="codehilite"><pre><span></span><code><span class="x">class SendWelcomeEmail implements ShouldQueue</span>
<span class="x">{</span>
<span class="x">    public $tries = 3;</span>
<span class="x">    public $timeout = 120;</span>

<span class="x">    public function failed(\Throwable $exception): void</span>
<span class="x">    {</span>
<span class="x">        Log::error(&#39;Failed to send welcome email&#39;, [</span>
<span class="x">            &#39;user_id&#39; =&gt; $this-&gt;user-&gt;id,</span>
<span class="x">            &#39;error&#39; =&gt; $exception-&gt;getMessage(),</span>
<span class="x">        ]);</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="4-use-job-batching-for-related-tasks">4. Use Job Batching for Related Tasks</h3>
<div class="codehilite"><pre><span></span><code><span class="x">$batch = Bus::batch([</span>
<span class="x">    new ProcessOrder($order),</span>
<span class="x">    new SendOrderConfirmation($order),</span>
<span class="x">    new UpdateInventory($order),</span>
<span class="x">])-&gt;then(function (Batch $batch) {</span>
<span class="x">    // All jobs completed successfully</span>
<span class="x">})-&gt;catch(function (Batch $batch, \Throwable $e) {</span>
<span class="x">    // Handle failure</span>
<span class="x">})-&gt;dispatch();</span>
</code></pre></div>

<h3 id="5-monitor-queue-performance">5. Monitor Queue Performance</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Monitor queue status</span>
php<span class="w"> </span>artisan<span class="w"> </span>queue:monitor

<span class="c1"># Check failed jobs</span>
php<span class="w"> </span>artisan<span class="w"> </span>queue:failed

<span class="c1"># Retry failed jobs</span>
php<span class="w"> </span>artisan<span class="w"> </span>queue:retry<span class="w"> </span>all
</code></pre></div>

<h2 id="summary">Summary</h2>
<p>In this chapter, we covered:</p>
<ul>
<li>✅ Creating and dispatching events</li>
<li>✅ Creating and registering listeners</li>
<li>✅ Event subscribers</li>
<li>✅ Broadcasting events</li>
<li>✅ Creating and dispatching jobs</li>
<li>✅ Queue configuration and workers</li>
<li>✅ Job batching and monitoring</li>
<li>✅ Common event and job examples</li>
<li>✅ Best practices for events and queues</li>
</ul>
<p>Events and queues provide powerful ways to decouple your application and handle background tasks. In the next chapter, we'll explore testing in Laravel.</p></div><div class="chapter" id="11-testing"><h1 id="chapter-11-testing">Chapter 11: Testing</h1>
<h2 id="what-is-testing">What is Testing?</h2>
<p>Testing is a crucial part of software development that helps ensure your code works correctly and continues to work as you make changes. Laravel provides excellent testing support with PHPUnit and additional testing helpers that make it easy to test your applications.</p>
<h2 id="types-of-tests">Types of Tests</h2>
<h3 id="unit-tests">Unit Tests</h3>
<p>Test individual components in isolation (models, services, helpers).</p>
<h3 id="feature-tests">Feature Tests</h3>
<p>Test complete features from the user's perspective (HTTP requests, database interactions).</p>
<h3 id="integration-tests">Integration Tests</h3>
<p>Test how different components work together.</p>
<h2 id="setting-up-testing">Setting Up Testing</h2>
<h3 id="phpunit-configuration">PHPUnit Configuration</h3>
<div class="codehilite"><pre><span></span><code><span class="cm">&lt;!-- phpunit.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;phpunit</span><span class="w"> </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="w">         </span><span class="na">xsi:noNamespaceSchemaLocation=</span><span class="s">&quot;vendor/phpunit/phpunit/phpunit.xsd&quot;</span>
<span class="w">         </span><span class="na">bootstrap=</span><span class="s">&quot;vendor/autoload.php&quot;</span>
<span class="w">         </span><span class="na">colors=</span><span class="s">&quot;true&quot;</span>
<span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;testsuites&gt;</span>
<span class="w">        </span><span class="nt">&lt;testsuite</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Unit&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;directory</span><span class="w"> </span><span class="na">suffix=</span><span class="s">&quot;Test.php&quot;</span><span class="nt">&gt;</span>./tests/Unit<span class="nt">&lt;/directory&gt;</span>
<span class="w">        </span><span class="nt">&lt;/testsuite&gt;</span>
<span class="w">        </span><span class="nt">&lt;testsuite</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Feature&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;directory</span><span class="w"> </span><span class="na">suffix=</span><span class="s">&quot;Test.php&quot;</span><span class="nt">&gt;</span>./tests/Feature<span class="nt">&lt;/directory&gt;</span>
<span class="w">        </span><span class="nt">&lt;/testsuite&gt;</span>
<span class="w">    </span><span class="nt">&lt;/testsuites&gt;</span>
<span class="w">    </span><span class="nt">&lt;source&gt;</span>
<span class="w">        </span><span class="nt">&lt;include&gt;</span>
<span class="w">            </span><span class="nt">&lt;directory</span><span class="w"> </span><span class="na">suffix=</span><span class="s">&quot;.php&quot;</span><span class="nt">&gt;</span>./app<span class="nt">&lt;/directory&gt;</span>
<span class="w">        </span><span class="nt">&lt;/include&gt;</span>
<span class="w">    </span><span class="nt">&lt;/source&gt;</span>
<span class="w">    </span><span class="nt">&lt;php&gt;</span>
<span class="w">        </span><span class="nt">&lt;env</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;APP_ENV&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;testing&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;env</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;BCRYPT_ROUNDS&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;4&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;env</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;CACHE_DRIVER&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;array&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;env</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;DB_CONNECTION&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;sqlite&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;env</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;DB_DATABASE&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;:memory:&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;env</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;MAIL_MAILER&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;array&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;env</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;QUEUE_CONNECTION&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;sync&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;env</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;SESSION_DRIVER&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;array&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;env</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;TELESCOPE_ENABLED&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/php&gt;</span>
<span class="nt">&lt;/phpunit&gt;</span>
</code></pre></div>

<h3 id="test-database-configuration">Test Database Configuration</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// config/database.php</span>
<span class="x">&#39;testing&#39; =&gt; [</span>
<span class="x">    &#39;driver&#39; =&gt; &#39;sqlite&#39;,</span>
<span class="x">    &#39;database&#39; =&gt; &#39;:memory:&#39;,</span>
<span class="x">    &#39;prefix&#39; =&gt; &#39;&#39;,</span>
<span class="x">],</span>
</code></pre></div>

<h2 id="running-tests">Running Tests</h2>
<h3 id="basic-commands">Basic Commands</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Run all tests</span>
php<span class="w"> </span>artisan<span class="w"> </span><span class="nb">test</span>

<span class="c1"># Run specific test file</span>
php<span class="w"> </span>artisan<span class="w"> </span><span class="nb">test</span><span class="w"> </span>tests/Feature/UserTest.php

<span class="c1"># Run specific test method</span>
php<span class="w"> </span>artisan<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--filter<span class="w"> </span>test_user_can_register

<span class="c1"># Run tests with coverage</span>
php<span class="w"> </span>artisan<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--coverage

<span class="c1"># Run tests in parallel</span>
php<span class="w"> </span>artisan<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--parallel

<span class="c1"># Run tests with verbose output</span>
php<span class="w"> </span>artisan<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--verbose
</code></pre></div>

<h3 id="using-phpunit-directly">Using PHPUnit Directly</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Run all tests</span>
./vendor/bin/phpunit

<span class="c1"># Run specific test suite</span>
./vendor/bin/phpunit<span class="w"> </span>--testsuite<span class="o">=</span>Feature

<span class="c1"># Run with coverage</span>
./vendor/bin/phpunit<span class="w"> </span>--coverage-html<span class="w"> </span>coverage
</code></pre></div>

<h2 id="feature-tests_1">Feature Tests</h2>
<h3 id="creating-feature-tests">Creating Feature Tests</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Create feature test</span>
php<span class="w"> </span>artisan<span class="w"> </span>make:test<span class="w"> </span>UserTest

<span class="c1"># Create test for specific model</span>
php<span class="w"> </span>artisan<span class="w"> </span>make:test<span class="w"> </span>UserTest<span class="w"> </span>--model<span class="o">=</span>User
</code></pre></div>

<h3 id="basic-feature-test-structure">Basic Feature Test Structure</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Tests\Feature</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\RefreshDatabase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Tests\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">RefreshDatabase</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">test_user_can_register</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;/register&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;John Doe&#39;</span><span class="p">,</span>
            <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;john@example.com&#39;</span><span class="p">,</span>
            <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span>
            <span class="s1">&#39;password_confirmation&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span>
        <span class="p">]);</span>

        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">assertStatus</span><span class="p">(</span><span class="mi">302</span><span class="p">);</span>
        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">assertRedirect</span><span class="p">(</span><span class="s1">&#39;/home&#39;</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertDatabaseHas</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;John Doe&#39;</span><span class="p">,</span>
            <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;john@example.com&#39;</span><span class="p">,</span>
        <span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">test_user_can_login</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">();</span>

        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">email</span><span class="p">,</span>
            <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span>
        <span class="p">]);</span>

        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">assertStatus</span><span class="p">(</span><span class="mi">302</span><span class="p">);</span>
        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">assertRedirect</span><span class="p">(</span><span class="s1">&#39;/home&#39;</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertAuthenticated</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">test_user_cannot_access_protected_route</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/profile&#39;</span><span class="p">);</span>

        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">assertStatus</span><span class="p">(</span><span class="mi">302</span><span class="p">);</span>
        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">assertRedirect</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="http-testing">HTTP Testing</h3>
<div class="codehilite"><pre><span></span><code><span class="x">class HttpTest extends TestCase</span>
<span class="x">{</span>
<span class="x">    public function test_get_request(): void</span>
<span class="x">    {</span>
<span class="x">        $response = $this-&gt;get(&#39;/users&#39;);</span>

<span class="x">        $response-&gt;assertStatus(200);</span>
<span class="x">        $response-&gt;assertViewIs(&#39;users.index&#39;);</span>
<span class="x">    }</span>

<span class="x">    public function test_post_request(): void</span>
<span class="x">    {</span>
<span class="x">        $response = $this-&gt;post(&#39;/users&#39;, [</span>
<span class="x">            &#39;name&#39; =&gt; &#39;John Doe&#39;,</span>
<span class="x">            &#39;email&#39; =&gt; &#39;john@example.com&#39;,</span>
<span class="x">        ]);</span>

<span class="x">        $response-&gt;assertStatus(302);</span>
<span class="x">        $response-&gt;assertRedirect(&#39;/users&#39;);</span>
<span class="x">    }</span>

<span class="x">    public function test_put_request(): void</span>
<span class="x">    {</span>
<span class="x">        $user = User::factory()-&gt;create();</span>

<span class="x">        $response = $this-&gt;put(&quot;/users/{$user-&gt;id}&quot;, [</span>
<span class="x">            &#39;name&#39; =&gt; &#39;Jane Doe&#39;,</span>
<span class="x">            &#39;email&#39; =&gt; &#39;jane@example.com&#39;,</span>
<span class="x">        ]);</span>

<span class="x">        $response-&gt;assertStatus(302);</span>

<span class="x">        $this-&gt;assertDatabaseHas(&#39;users&#39;, [</span>
<span class="x">            &#39;id&#39; =&gt; $user-&gt;id,</span>
<span class="x">            &#39;name&#39; =&gt; &#39;Jane Doe&#39;,</span>
<span class="x">        ]);</span>
<span class="x">    }</span>

<span class="x">    public function test_delete_request(): void</span>
<span class="x">    {</span>
<span class="x">        $user = User::factory()-&gt;create();</span>

<span class="x">        $response = $this-&gt;delete(&quot;/users/{$user-&gt;id}&quot;);</span>

<span class="x">        $response-&gt;assertStatus(302);</span>

<span class="x">        $this-&gt;assertDatabaseMissing(&#39;users&#39;, [</span>
<span class="x">            &#39;id&#39; =&gt; $user-&gt;id,</span>
<span class="x">        ]);</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="response-assertions">Response Assertions</h3>
<div class="codehilite"><pre><span></span><code><span class="x">class ResponseTest extends TestCase</span>
<span class="x">{</span>
<span class="x">    public function test_response_assertions(): void</span>
<span class="x">    {</span>
<span class="x">        $response = $this-&gt;get(&#39;/users&#39;);</span>

<span class="x">        // Status assertions</span>
<span class="x">        $response-&gt;assertStatus(200);</span>
<span class="x">        $response-&gt;assertOk();</span>
<span class="x">        $response-&gt;assertNotFound();</span>
<span class="x">        $response-&gt;assertForbidden();</span>
<span class="x">        $response-&gt;assertUnauthorized();</span>

<span class="x">        // Redirect assertions</span>
<span class="x">        $response-&gt;assertRedirect(&#39;/login&#39;);</span>
<span class="x">        $response-&gt;assertRedirect(route(&#39;login&#39;));</span>

<span class="x">        // View assertions</span>
<span class="x">        $response-&gt;assertViewIs(&#39;users.index&#39;);</span>
<span class="x">        $response-&gt;assertViewHas(&#39;users&#39;);</span>
<span class="x">        $response-&gt;assertViewHas(&#39;users&#39;, $users);</span>

<span class="x">        // JSON assertions</span>
<span class="x">        $response-&gt;assertJson([&#39;name&#39; =&gt; &#39;John Doe&#39;]);</span>
<span class="x">        $response-&gt;assertJsonFragment([&#39;name&#39; =&gt; &#39;John Doe&#39;]);</span>
<span class="x">        $response-&gt;assertJsonMissing([&#39;password&#39;]);</span>

<span class="x">        // Header assertions</span>
<span class="x">        $response-&gt;assertHeader(&#39;Content-Type&#39;, &#39;application/json&#39;);</span>
<span class="x">        $response-&gt;assertHeaderMissing(&#39;X-Custom-Header&#39;);</span>

<span class="x">        // Cookie assertions</span>
<span class="x">        $response-&gt;assertCookie(&#39;name&#39;, &#39;value&#39;);</span>
<span class="x">        $response-&gt;assertCookieMissing(&#39;name&#39;);</span>

<span class="x">        // Session assertions</span>
<span class="x">        $response-&gt;assertSessionHas(&#39;key&#39;);</span>
<span class="x">        $response-&gt;assertSessionHas(&#39;key&#39;, &#39;value&#39;);</span>
<span class="x">        $response-&gt;assertSessionMissing(&#39;key&#39;);</span>
<span class="x">        $response-&gt;assertSessionHasErrors([&#39;email&#39;]);</span>
<span class="x">        $response-&gt;assertSessionHasNoErrors();</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="authentication-testing">Authentication Testing</h3>
<div class="codehilite"><pre><span></span><code><span class="x">class AuthenticationTest extends TestCase</span>
<span class="x">{</span>
<span class="x">    public function test_guest_cannot_access_protected_route(): void</span>
<span class="x">    {</span>
<span class="x">        $response = $this-&gt;get(&#39;/profile&#39;);</span>

<span class="x">        $response-&gt;assertRedirect(&#39;/login&#39;);</span>
<span class="x">    }</span>

<span class="x">    public function test_authenticated_user_can_access_protected_route(): void</span>
<span class="x">    {</span>
<span class="x">        $user = User::factory()-&gt;create();</span>

<span class="x">        $response = $this-&gt;actingAs($user)-&gt;get(&#39;/profile&#39;);</span>

<span class="x">        $response-&gt;assertOk();</span>
<span class="x">        $this-&gt;assertAuthenticated();</span>
<span class="x">    }</span>

<span class="x">    public function test_user_can_logout(): void</span>
<span class="x">    {</span>
<span class="x">        $user = User::factory()-&gt;create();</span>

<span class="x">        $response = $this-&gt;actingAs($user)-&gt;post(&#39;/logout&#39;);</span>

<span class="x">        $response-&gt;assertRedirect(&#39;/&#39;);</span>
<span class="x">        $this-&gt;assertGuest();</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h2 id="unit-tests_1">Unit Tests</h2>
<h3 id="creating-unit-tests">Creating Unit Tests</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Create unit test</span>
php<span class="w"> </span>artisan<span class="w"> </span>make:test<span class="w"> </span>UserTest<span class="w"> </span>--unit

<span class="c1"># Create test for specific class</span>
php<span class="w"> </span>artisan<span class="w"> </span>make:test<span class="w"> </span>UserServiceTest<span class="w"> </span>--unit
</code></pre></div>

<h3 id="testing-models">Testing Models</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Tests\Unit</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\RefreshDatabase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Tests\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">RefreshDatabase</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">test_user_has_full_name</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">([</span>
            <span class="s1">&#39;first_name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span>
            <span class="s1">&#39;last_name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Doe&#39;</span><span class="p">,</span>
        <span class="p">]);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="s1">&#39;John Doe&#39;</span><span class="p">,</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">full_name</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">test_user_can_be_admin</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">([</span><span class="s1">&#39;role&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;admin&#39;</span><span class="p">]);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">isAdmin</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">test_user_has_many_posts</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">();</span>
        <span class="nv">$posts</span> <span class="o">=</span> <span class="nx">Post</span><span class="o">::</span><span class="na">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">([</span><span class="s1">&#39;user_id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">]);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertCount</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">posts</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertInstanceOf</span><span class="p">(</span><span class="nx">Post</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">posts</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="testing-services">Testing Services</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Tests\Unit</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Services\UserService</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\RefreshDatabase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Tests\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserServiceTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">RefreshDatabase</span><span class="p">;</span>

    <span class="k">protected</span> <span class="nx">UserService</span> <span class="nv">$userService</span><span class="p">;</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">setUp</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">userService</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UserService</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">test_create_user</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$userData</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;John Doe&#39;</span><span class="p">,</span>
            <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;john@example.com&#39;</span><span class="p">,</span>
            <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span>
        <span class="p">];</span>

        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">userService</span><span class="o">-&gt;</span><span class="na">createUser</span><span class="p">(</span><span class="nv">$userData</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertInstanceOf</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="s1">&#39;John Doe&#39;</span><span class="p">,</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="s1">&#39;john@example.com&#39;</span><span class="p">,</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">email</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">test_update_user</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">();</span>
        <span class="nv">$updateData</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Jane Doe&#39;</span><span class="p">];</span>

        <span class="nv">$updatedUser</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">userService</span><span class="o">-&gt;</span><span class="na">updateUser</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="nv">$updateData</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="s1">&#39;Jane Doe&#39;</span><span class="p">,</span> <span class="nv">$updatedUser</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">test_delete_user</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">userService</span><span class="o">-&gt;</span><span class="na">deleteUser</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertDatabaseMissing</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="database-testing">Database Testing</h2>
<h3 id="database-assertions">Database Assertions</h3>
<div class="codehilite"><pre><span></span><code><span class="x">class DatabaseTest extends TestCase</span>
<span class="x">{</span>
<span class="x">    use RefreshDatabase;</span>

<span class="x">    public function test_database_assertions(): void</span>
<span class="x">    {</span>
<span class="x">        $user = User::factory()-&gt;create();</span>

<span class="x">        // Assert record exists</span>
<span class="x">        $this-&gt;assertDatabaseHas(&#39;users&#39;, [</span>
<span class="x">            &#39;id&#39; =&gt; $user-&gt;id,</span>
<span class="x">            &#39;name&#39; =&gt; $user-&gt;name,</span>
<span class="x">        ]);</span>

<span class="x">        // Assert record doesn&#39;t exist</span>
<span class="x">        $this-&gt;assertDatabaseMissing(&#39;users&#39;, [</span>
<span class="x">            &#39;email&#39; =&gt; &#39;nonexistent@example.com&#39;,</span>
<span class="x">        ]);</span>

<span class="x">        // Assert count</span>
<span class="x">        $this-&gt;assertDatabaseCount(&#39;users&#39;, 1);</span>

<span class="x">        // Assert table is empty</span>
<span class="x">        $this-&gt;assertDatabaseEmpty(&#39;posts&#39;);</span>
<span class="x">    }</span>

<span class="x">    public function test_soft_deletes(): void</span>
<span class="x">    {</span>
<span class="x">        $user = User::factory()-&gt;create();</span>
<span class="x">        $user-&gt;delete();</span>

<span class="x">        // Assert record is soft deleted</span>
<span class="x">        $this-&gt;assertSoftDeleted(&#39;users&#39;, [&#39;id&#39; =&gt; $user-&gt;id]);</span>

<span class="x">        // Assert record exists in database but is soft deleted</span>
<span class="x">        $this-&gt;assertDatabaseHas(&#39;users&#39;, [&#39;id&#39; =&gt; $user-&gt;id]);</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="database-factories">Database Factories</h3>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Database\Factories</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Factories\Factory</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Str</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserFactory</span> <span class="k">extends</span> <span class="nx">Factory</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$model</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">class</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">definition</span><span class="p">()</span><span class="o">:</span> <span class="k">array</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">faker</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(),</span>
            <span class="s1">&#39;email&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">faker</span><span class="o">-&gt;</span><span class="na">unique</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">safeEmail</span><span class="p">(),</span>
            <span class="s1">&#39;email_verified_at&#39;</span> <span class="o">=&gt;</span> <span class="nx">now</span><span class="p">(),</span>
            <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi&#39;</span><span class="p">,</span> <span class="c1">// password</span>
            <span class="s1">&#39;remember_token&#39;</span> <span class="o">=&gt;</span> <span class="nx">Str</span><span class="o">::</span><span class="na">random</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
        <span class="p">];</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">unverified</span><span class="p">()</span><span class="o">:</span> <span class="k">static</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">state</span><span class="p">(</span><span class="nx">fn</span> <span class="p">(</span><span class="k">array</span> <span class="nv">$attributes</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;email_verified_at&#39;</span> <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span>
        <span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">admin</span><span class="p">()</span><span class="o">:</span> <span class="k">static</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">state</span><span class="p">(</span><span class="nx">fn</span> <span class="p">(</span><span class="k">array</span> <span class="nv">$attributes</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;role&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;admin&#39;</span><span class="p">,</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="using-factories-in-tests">Using Factories in Tests</h3>
<div class="codehilite"><pre><span></span><code><span class="x">class FactoryTest extends TestCase</span>
<span class="x">{</span>
<span class="x">    use RefreshDatabase;</span>

<span class="x">    public function test_using_factories(): void</span>
<span class="x">    {</span>
<span class="x">        // Create single user</span>
<span class="x">        $user = User::factory()-&gt;create();</span>

<span class="x">        // Create user with specific attributes</span>
<span class="x">        $admin = User::factory()-&gt;create([&#39;role&#39; =&gt; &#39;admin&#39;]);</span>

<span class="x">        // Create multiple users</span>
<span class="x">        $users = User::factory()-&gt;count(5)-&gt;create();</span>

<span class="x">        // Create user with state</span>
<span class="x">        $unverifiedUser = User::factory()-&gt;unverified()-&gt;create();</span>

<span class="x">        // Create user with relationships</span>
<span class="x">        $userWithPosts = User::factory()</span>
<span class="x">            -&gt;has(Post::factory()-&gt;count(3))</span>
<span class="x">            -&gt;create();</span>

<span class="x">        // Create user without saving</span>
<span class="x">        $user = User::factory()-&gt;make();</span>

<span class="x">        // Create user with raw attributes</span>
<span class="x">        $userData = User::factory()-&gt;raw();</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h2 id="mocking-and-stubbing">Mocking and Stubbing</h2>
<h3 id="mocking-services">Mocking Services</h3>
<div class="codehilite"><pre><span></span><code><span class="x">use Mockery;</span>
<span class="x">use App\Services\EmailService;</span>

<span class="x">class MockTest extends TestCase</span>
<span class="x">{</span>
<span class="x">    public function test_mocking_service(): void</span>
<span class="x">    {</span>
<span class="x">        $mock = Mockery::mock(EmailService::class);</span>
<span class="x">        $mock-&gt;shouldReceive(&#39;send&#39;)</span>
<span class="x">            -&gt;once()</span>
<span class="x">            -&gt;with(&#39;john@example.com&#39;, &#39;Welcome!&#39;)</span>
<span class="x">            -&gt;andReturn(true);</span>

<span class="x">        app()-&gt;instance(EmailService::class, $mock);</span>

<span class="x">        $user = User::factory()-&gt;create();</span>

<span class="x">        // Your code that uses EmailService</span>
<span class="x">        $this-&gt;assertTrue($mock-&gt;send(&#39;john@example.com&#39;, &#39;Welcome!&#39;));</span>
<span class="x">    }</span>

<span class="x">    public function test_partial_mock(): void</span>
<span class="x">    {</span>
<span class="x">        $user = User::factory()-&gt;create();</span>

<span class="x">        $mock = Mockery::mock($user)-&gt;makePartial();</span>
<span class="x">        $mock-&gt;shouldReceive(&#39;sendEmail&#39;)</span>
<span class="x">            -&gt;once()</span>
<span class="x">            -&gt;andReturn(true);</span>

<span class="x">        $this-&gt;assertTrue($mock-&gt;sendEmail());</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="mocking-http-requests">Mocking HTTP Requests</h3>
<div class="codehilite"><pre><span></span><code><span class="x">use Illuminate\Support\Facades\Http;</span>

<span class="x">class HttpMockTest extends TestCase</span>
<span class="x">{</span>
<span class="x">    public function test_mocking_http_requests(): void</span>
<span class="x">    {</span>
<span class="x">        Http::fake([</span>
<span class="x">            &#39;api.example.com/*&#39; =&gt; Http::response([</span>
<span class="x">                &#39;id&#39; =&gt; 1,</span>
<span class="x">                &#39;name&#39; =&gt; &#39;John Doe&#39;,</span>
<span class="x">            ], 200),</span>
<span class="x">        ]);</span>

<span class="x">        $response = Http::get(&#39;api.example.com/users/1&#39;);</span>

<span class="x">        $this-&gt;assertEquals(200, $response-&gt;status());</span>
<span class="x">        $this-&gt;assertEquals(&#39;John Doe&#39;, $response-&gt;json(&#39;name&#39;));</span>

<span class="x">        Http::assertSent(function ($request) {</span>
<span class="x">            return $request-&gt;url() == &#39;api.example.com/users/1&#39; &amp;&amp;</span>
<span class="x">                   $request-&gt;method() == &#39;GET&#39;;</span>
<span class="x">        });</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h2 id="testing-events-and-jobs">Testing Events and Jobs</h2>
<h3 id="testing-events">Testing Events</h3>
<div class="codehilite"><pre><span></span><code><span class="x">use App\Events\UserRegistered;</span>
<span class="x">use Illuminate\Support\Facades\Event;</span>

<span class="x">class EventTest extends TestCase</span>
<span class="x">{</span>
<span class="x">    public function test_event_is_dispatched(): void</span>
<span class="x">    {</span>
<span class="x">        Event::fake();</span>

<span class="x">        $user = User::factory()-&gt;create();</span>

<span class="x">        UserRegistered::dispatch($user);</span>

<span class="x">        Event::assertDispatched(UserRegistered::class);</span>
<span class="x">        Event::assertDispatched(UserRegistered::class, function ($event) use ($user) {</span>
<span class="x">            return $event-&gt;user-&gt;id === $user-&gt;id;</span>
<span class="x">        });</span>
<span class="x">    }</span>

<span class="x">    public function test_event_is_not_dispatched(): void</span>
<span class="x">    {</span>
<span class="x">        Event::fake();</span>

<span class="x">        $user = User::factory()-&gt;create();</span>

<span class="x">        Event::assertNotDispatched(UserRegistered::class);</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="testing-jobs">Testing Jobs</h3>
<div class="codehilite"><pre><span></span><code><span class="x">use App\Jobs\SendWelcomeEmail;</span>
<span class="x">use Illuminate\Support\Facades\Queue;</span>

<span class="x">class JobTest extends TestCase</span>
<span class="x">{</span>
<span class="x">    public function test_job_is_dispatched(): void</span>
<span class="x">    {</span>
<span class="x">        Queue::fake();</span>

<span class="x">        $user = User::factory()-&gt;create();</span>

<span class="x">        SendWelcomeEmail::dispatch($user);</span>

<span class="x">        Queue::assertPushed(SendWelcomeEmail::class);</span>
<span class="x">        Queue::assertPushed(SendWelcomeEmail::class, function ($job) use ($user) {</span>
<span class="x">            return $job-&gt;user-&gt;id === $user-&gt;id;</span>
<span class="x">        });</span>
<span class="x">    }</span>

<span class="x">    public function test_job_is_not_dispatched(): void</span>
<span class="x">    {</span>
<span class="x">        Queue::fake();</span>

<span class="x">        $user = User::factory()-&gt;create();</span>

<span class="x">        Queue::assertNotPushed(SendWelcomeEmail::class);</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h2 id="testing-mail-and-notifications">Testing Mail and Notifications</h2>
<h3 id="testing-mail">Testing Mail</h3>
<div class="codehilite"><pre><span></span><code><span class="x">use App\Mail\WelcomeEmail;</span>
<span class="x">use Illuminate\Support\Facades\Mail;</span>

<span class="x">class MailTest extends TestCase</span>
<span class="x">{</span>
<span class="x">    public function test_mail_is_sent(): void</span>
<span class="x">    {</span>
<span class="x">        Mail::fake();</span>

<span class="x">        $user = User::factory()-&gt;create();</span>

<span class="x">        Mail::to($user-&gt;email)-&gt;send(new WelcomeEmail($user));</span>

<span class="x">        Mail::assertSent(WelcomeEmail::class);</span>
<span class="x">        Mail::assertSent(WelcomeEmail::class, function ($mail) use ($user) {</span>
<span class="x">            return $mail-&gt;hasTo($user-&gt;email);</span>
<span class="x">        });</span>
<span class="x">    }</span>

<span class="x">    public function test_mail_is_not_sent(): void</span>
<span class="x">    {</span>
<span class="x">        Mail::fake();</span>

<span class="x">        $user = User::factory()-&gt;create();</span>

<span class="x">        Mail::assertNotSent(WelcomeEmail::class);</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="testing-notifications">Testing Notifications</h3>
<div class="codehilite"><pre><span></span><code><span class="x">use App\Notifications\WelcomeNotification;</span>
<span class="x">use Illuminate\Support\Facades\Notification;</span>

<span class="x">class NotificationTest extends TestCase</span>
<span class="x">{</span>
<span class="x">    public function test_notification_is_sent(): void</span>
<span class="x">    {</span>
<span class="x">        Notification::fake();</span>

<span class="x">        $user = User::factory()-&gt;create();</span>

<span class="x">        $user-&gt;notify(new WelcomeNotification());</span>

<span class="x">        Notification::assertSentTo($user, WelcomeNotification::class);</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h2 id="testing-api-endpoints">Testing API Endpoints</h2>
<h3 id="api-testing">API Testing</h3>
<div class="codehilite"><pre><span></span><code><span class="x">class ApiTest extends TestCase</span>
<span class="x">{</span>
<span class="x">    public function test_api_endpoint(): void</span>
<span class="x">    {</span>
<span class="x">        $user = User::factory()-&gt;create();</span>

<span class="x">        $response = $this-&gt;actingAs($user)</span>
<span class="x">            -&gt;getJson(&#39;/api/users&#39;);</span>

<span class="x">        $response-&gt;assertStatus(200)</span>
<span class="x">            -&gt;assertJsonStructure([</span>
<span class="x">                &#39;data&#39; =&gt; [</span>
<span class="x">                    &#39;*&#39; =&gt; [&#39;id&#39;, &#39;name&#39;, &#39;email&#39;]</span>
<span class="x">                ]</span>
<span class="x">            ]);</span>
<span class="x">    }</span>

<span class="x">    public function test_api_validation(): void</span>
<span class="x">    {</span>
<span class="x">        $response = $this-&gt;postJson(&#39;/api/users&#39;, []);</span>

<span class="x">        $response-&gt;assertStatus(422)</span>
<span class="x">            -&gt;assertJsonValidationErrors([&#39;name&#39;, &#39;email&#39;]);</span>
<span class="x">    }</span>

<span class="x">    public function test_api_authentication(): void</span>
<span class="x">    {</span>
<span class="x">        $response = $this-&gt;getJson(&#39;/api/profile&#39;);</span>

<span class="x">        $response-&gt;assertStatus(401);</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h2 id="test-data-providers">Test Data Providers</h2>
<h3 id="using-data-providers">Using Data Providers</h3>
<div class="codehilite"><pre><span></span><code><span class="x">class DataProviderTest extends TestCase</span>
<span class="x">{</span>
<span class="x">    /**</span>
<span class="x">     * @dataProvider userDataProvider</span>
<span class="x">     */</span>
<span class="x">    public function test_user_validation($name, $email, $expectedStatus): void</span>
<span class="x">    {</span>
<span class="x">        $response = $this-&gt;post(&#39;/users&#39;, [</span>
<span class="x">            &#39;name&#39; =&gt; $name,</span>
<span class="x">            &#39;email&#39; =&gt; $email,</span>
<span class="x">        ]);</span>

<span class="x">        $response-&gt;assertStatus($expectedStatus);</span>
<span class="x">    }</span>

<span class="x">    public function userDataProvider(): array</span>
<span class="x">    {</span>
<span class="x">        return [</span>
<span class="x">            &#39;valid user&#39; =&gt; [&#39;John Doe&#39;, &#39;john@example.com&#39;, 302],</span>
<span class="x">            &#39;invalid email&#39; =&gt; [&#39;John Doe&#39;, &#39;invalid-email&#39;, 422],</span>
<span class="x">            &#39;empty name&#39; =&gt; [&#39;&#39;, &#39;john@example.com&#39;, 422],</span>
<span class="x">        ];</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h2 id="testing-best-practices">Testing Best Practices</h2>
<h3 id="1-use-descriptive-test-names">1. Use Descriptive Test Names</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Good</span>
<span class="x">public function test_user_can_register_with_valid_data(): void</span>
<span class="x">public function test_user_cannot_register_with_invalid_email(): void</span>
<span class="x">public function test_admin_can_delete_any_user(): void</span>

<span class="x">// Bad</span>
<span class="x">public function test_register(): void</span>
<span class="x">public function test_email(): void</span>
<span class="x">public function test_delete(): void</span>
</code></pre></div>

<h3 id="2-follow-aaa-pattern">2. Follow AAA Pattern</h3>
<div class="codehilite"><pre><span></span><code><span class="x">public function test_user_can_login(): void</span>
<span class="x">{</span>
<span class="x">    // Arrange</span>
<span class="x">    $user = User::factory()-&gt;create();</span>

<span class="x">    // Act</span>
<span class="x">    $response = $this-&gt;post(&#39;/login&#39;, [</span>
<span class="x">        &#39;email&#39; =&gt; $user-&gt;email,</span>
<span class="x">        &#39;password&#39; =&gt; &#39;password&#39;,</span>
<span class="x">    ]);</span>

<span class="x">    // Assert</span>
<span class="x">    $response-&gt;assertRedirect(&#39;/home&#39;);</span>
<span class="x">    $this-&gt;assertAuthenticated();</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="3-test-one-thing-at-a-time">3. Test One Thing at a Time</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Good - Single responsibility</span>
<span class="x">public function test_user_can_register(): void</span>
<span class="x">{</span>
<span class="x">    // Test registration only</span>
<span class="x">}</span>

<span class="x">public function test_user_can_login(): void</span>
<span class="x">{</span>
<span class="x">    // Test login only</span>
<span class="x">}</span>

<span class="x">// Bad - Multiple responsibilities</span>
<span class="x">public function test_user_authentication(): void</span>
<span class="x">{</span>
<span class="x">    // Testing registration, login, and logout in one test</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="4-use-factories-for-test-data">4. Use Factories for Test Data</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Good</span>
<span class="x">$user = User::factory()-&gt;create();</span>

<span class="x">// Bad</span>
<span class="x">$user = new User();</span>
<span class="x">$user-&gt;name = &#39;John Doe&#39;;</span>
<span class="x">$user-&gt;email = &#39;john@example.com&#39;;</span>
<span class="x">$user-&gt;save();</span>
</code></pre></div>

<h3 id="5-test-edge-cases">5. Test Edge Cases</h3>
<div class="codehilite"><pre><span></span><code><span class="x">public function test_user_cannot_register_with_existing_email(): void</span>
<span class="x">{</span>
<span class="x">    $existingUser = User::factory()-&gt;create();</span>

<span class="x">    $response = $this-&gt;post(&#39;/register&#39;, [</span>
<span class="x">        &#39;name&#39; =&gt; &#39;John Doe&#39;,</span>
<span class="x">        &#39;email&#39; =&gt; $existingUser-&gt;email,</span>
<span class="x">        &#39;password&#39; =&gt; &#39;password&#39;,</span>
<span class="x">    ]);</span>

<span class="x">    $response-&gt;assertSessionHasErrors([&#39;email&#39;]);</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="6-use-database-transactions">6. Use Database Transactions</h3>
<div class="codehilite"><pre><span></span><code><span class="x">use Illuminate\Foundation\Testing\DatabaseTransactions;</span>

<span class="x">class TransactionTest extends TestCase</span>
<span class="x">{</span>
<span class="x">    use DatabaseTransactions;</span>

<span class="x">    // Tests will run in transactions and be rolled back</span>
<span class="x">}</span>
</code></pre></div>

<h2 id="summary">Summary</h2>
<p>In this chapter, we covered:</p>
<ul>
<li>✅ Setting up testing environment</li>
<li>✅ Feature tests for HTTP requests</li>
<li>✅ Unit tests for individual components</li>
<li>✅ Database testing and factories</li>
<li>✅ Mocking and stubbing</li>
<li>✅ Testing events and jobs</li>
<li>✅ Testing mail and notifications</li>
<li>✅ API testing</li>
<li>✅ Test data providers</li>
<li>✅ Testing best practices</li>
</ul>
<p>Testing is essential for building reliable and maintainable applications. In the next chapter, we'll explore deployment strategies for Laravel applications.</p></div><div class="chapter" id="12-deployment"><h1 id="chapter-12-deployment">Chapter 12: Deployment</h1>
<h2 id="what-is-deployment">What is Deployment?</h2>
<p>Deployment is the process of making your Laravel application available to users on a production server. This involves setting up the server environment, configuring the application, and ensuring it runs reliably in production.</p>
<h2 id="pre-deployment-checklist">Pre-Deployment Checklist</h2>
<h3 id="environment-configuration">Environment Configuration</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Set production environment</span>
<span class="nv">APP_ENV</span><span class="o">=</span>production
<span class="nv">APP_DEBUG</span><span class="o">=</span><span class="nb">false</span>
<span class="nv">APP_URL</span><span class="o">=</span>https://yourdomain.com

<span class="c1"># Database configuration</span>
<span class="nv">DB_CONNECTION</span><span class="o">=</span>mysql
<span class="nv">DB_HOST</span><span class="o">=</span><span class="m">127</span>.0.0.1
<span class="nv">DB_PORT</span><span class="o">=</span><span class="m">3306</span>
<span class="nv">DB_DATABASE</span><span class="o">=</span>your_database
<span class="nv">DB_USERNAME</span><span class="o">=</span>your_username
<span class="nv">DB_PASSWORD</span><span class="o">=</span>your_password

<span class="c1"># Cache and session</span>
<span class="nv">CACHE_DRIVER</span><span class="o">=</span>redis
<span class="nv">SESSION_DRIVER</span><span class="o">=</span>redis
<span class="nv">QUEUE_CONNECTION</span><span class="o">=</span>redis

<span class="c1"># Mail configuration</span>
<span class="nv">MAIL_MAILER</span><span class="o">=</span>smtp
<span class="nv">MAIL_HOST</span><span class="o">=</span>your-smtp-host
<span class="nv">MAIL_PORT</span><span class="o">=</span><span class="m">587</span>
<span class="nv">MAIL_USERNAME</span><span class="o">=</span>your-email
<span class="nv">MAIL_PASSWORD</span><span class="o">=</span>your-password
<span class="nv">MAIL_ENCRYPTION</span><span class="o">=</span>tls
<span class="nv">MAIL_FROM_ADDRESS</span><span class="o">=</span>noreply@yourdomain.com
<span class="nv">MAIL_FROM_NAME</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">APP_NAME</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div>

<h3 id="security-considerations">Security Considerations</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Generate application key</span>
php<span class="w"> </span>artisan<span class="w"> </span>key:generate

<span class="c1"># Set secure session configuration</span>
<span class="nv">SESSION_SECURE_COOKIE</span><span class="o">=</span><span class="nb">true</span>
<span class="nv">SESSION_SAME_SITE</span><span class="o">=</span>strict

<span class="c1"># Enable HTTPS</span>
<span class="nv">FORCE_HTTPS</span><span class="o">=</span><span class="nb">true</span>

<span class="c1"># Set secure headers</span>
<span class="nv">SECURE_HEADERS</span><span class="o">=</span><span class="nb">true</span>
</code></pre></div>

<h3 id="performance-optimization">Performance Optimization</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Enable caching</span>
php<span class="w"> </span>artisan<span class="w"> </span>config:cache
php<span class="w"> </span>artisan<span class="w"> </span>route:cache
php<span class="w"> </span>artisan<span class="w"> </span>view:cache

<span class="c1"># Optimize autoloader</span>
composer<span class="w"> </span>install<span class="w"> </span>--optimize-autoloader<span class="w"> </span>--no-dev

<span class="c1"># Set proper permissions</span>
chmod<span class="w"> </span>-R<span class="w"> </span><span class="m">755</span><span class="w"> </span>storage<span class="w"> </span>bootstrap/cache
chown<span class="w"> </span>-R<span class="w"> </span>www-data:www-data<span class="w"> </span>storage<span class="w"> </span>bootstrap/cache
</code></pre></div>

<h2 id="deployment-methods">Deployment Methods</h2>
<h3 id="1-traditional-server-deployment">1. Traditional Server Deployment</h3>
<h4 id="server-requirements">Server Requirements</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Install required packages</span>
sudo<span class="w"> </span>apt<span class="w"> </span>update
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>nginx<span class="w"> </span>mysql-server<span class="w"> </span>php8.1-fpm<span class="w"> </span>php8.1-mysql<span class="w"> </span>php8.1-xml<span class="w"> </span>php8.1-mbstring<span class="w"> </span>php8.1-curl<span class="w"> </span>php8.1-zip<span class="w"> </span>php8.1-gd<span class="w"> </span>php8.1-bcmath<span class="w"> </span>php8.1-redis<span class="w"> </span>composer
</code></pre></div>

<h4 id="nginx-configuration">Nginx Configuration</h4>
<div class="codehilite"><pre><span></span><code><span class="k">server</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">listen</span><span class="w"> </span><span class="mi">80</span><span class="p">;</span>
<span class="w">    </span><span class="kn">server_name</span><span class="w"> </span><span class="s">yourdomain.com</span><span class="p">;</span>
<span class="w">    </span><span class="kn">root</span><span class="w"> </span><span class="s">/var/www/your-app/public</span><span class="p">;</span>

<span class="w">    </span><span class="kn">add_header</span><span class="w"> </span><span class="s">X-Frame-Options</span><span class="w"> </span><span class="s">&quot;SAMEORIGIN&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="kn">add_header</span><span class="w"> </span><span class="s">X-Content-Type-Options</span><span class="w"> </span><span class="s">&quot;nosniff&quot;</span><span class="p">;</span>

<span class="w">    </span><span class="kn">index</span><span class="w"> </span><span class="s">index.php</span><span class="p">;</span>

<span class="w">    </span><span class="kn">charset</span><span class="w"> </span><span class="s">utf-8</span><span class="p">;</span>

<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">try_files</span><span class="w"> </span><span class="nv">$uri</span><span class="w"> </span><span class="nv">$uri/</span><span class="w"> </span><span class="s">/index.php?</span><span class="nv">$query_string</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">/favicon.ico</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kn">access_log</span><span class="w"> </span><span class="no">off</span><span class="p">;</span><span class="w"> </span><span class="kn">log_not_found</span><span class="w"> </span><span class="no">off</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">/robots.txt</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="kn">access_log</span><span class="w"> </span><span class="no">off</span><span class="p">;</span><span class="w"> </span><span class="kn">log_not_found</span><span class="w"> </span><span class="no">off</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kn">error_page</span><span class="w"> </span><span class="mi">404</span><span class="w"> </span><span class="s">/index.php</span><span class="p">;</span>

<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="p">~</span><span class="w"> </span><span class="sr">\.php$</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">fastcgi_pass</span><span class="w"> </span><span class="s">unix:/var/run/php/php8.1-fpm.sock</span><span class="p">;</span>
<span class="w">        </span><span class="kn">fastcgi_param</span><span class="w"> </span><span class="s">SCRIPT_FILENAME</span><span class="w"> </span><span class="nv">$realpath_root$fastcgi_script_name</span><span class="p">;</span>
<span class="w">        </span><span class="kn">include</span><span class="w"> </span><span class="s">fastcgi_params</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="p">~</span><span class="w"> </span><span class="sr">/\.(?!well-known).*</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">deny</span><span class="w"> </span><span class="s">all</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="deployment-script">Deployment Script</h4>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Deployment script</span>
<span class="nb">set</span><span class="w"> </span>-e

<span class="c1"># Variables</span>
<span class="nv">APP_DIR</span><span class="o">=</span><span class="s2">&quot;/var/www/your-app&quot;</span>
<span class="nv">BACKUP_DIR</span><span class="o">=</span><span class="s2">&quot;/var/backups/your-app&quot;</span>
<span class="nv">RELEASE_DIR</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$APP_DIR</span><span class="s2">/releases/</span><span class="k">$(</span>date<span class="w"> </span>+%Y%m%d_%H%M%S<span class="k">)</span><span class="s2">&quot;</span>

<span class="c1"># Create release directory</span>
mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$RELEASE_DIR</span>

<span class="c1"># Clone or pull latest code</span>
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/your-username/your-app.git<span class="w"> </span><span class="nv">$RELEASE_DIR</span>

<span class="c1"># Install dependencies</span>
<span class="nb">cd</span><span class="w"> </span><span class="nv">$RELEASE_DIR</span>
composer<span class="w"> </span>install<span class="w"> </span>--optimize-autoloader<span class="w"> </span>--no-dev

<span class="c1"># Copy environment file</span>
cp<span class="w"> </span>.env.example<span class="w"> </span>.env

<span class="c1"># Set permissions</span>
chmod<span class="w"> </span>-R<span class="w"> </span><span class="m">755</span><span class="w"> </span>storage<span class="w"> </span>bootstrap/cache
chown<span class="w"> </span>-R<span class="w"> </span>www-data:www-data<span class="w"> </span>storage<span class="w"> </span>bootstrap/cache

<span class="c1"># Run migrations</span>
php<span class="w"> </span>artisan<span class="w"> </span>migrate<span class="w"> </span>--force

<span class="c1"># Optimize application</span>
php<span class="w"> </span>artisan<span class="w"> </span>config:cache
php<span class="w"> </span>artisan<span class="w"> </span>route:cache
php<span class="w"> </span>artisan<span class="w"> </span>view:cache

<span class="c1"># Create symlink</span>
ln<span class="w"> </span>-sfn<span class="w"> </span><span class="nv">$RELEASE_DIR</span><span class="w"> </span><span class="nv">$APP_DIR</span>/current

<span class="c1"># Restart services</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>php8.1-fpm
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>nginx

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Deployment completed successfully!&quot;</span>
</code></pre></div>

<h3 id="2-laravel-forge-deployment">2. Laravel Forge Deployment</h3>
<p>Laravel Forge is a server management service that simplifies deployment:</p>
<h4 id="setting-up-forge">Setting Up Forge</h4>
<ol>
<li><strong>Connect Server</strong>: Add your server to Forge</li>
<li><strong>Install PHP</strong>: Install PHP 8.1 and required extensions</li>
<li><strong>Install Database</strong>: Install MySQL or PostgreSQL</li>
<li><strong>Create Site</strong>: Create a new site in Forge</li>
<li><strong>Deploy</strong>: Use Forge's deployment features</li>
</ol>
<h4 id="forge-deployment-script">Forge Deployment Script</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Forge deployment script</span>
<span class="nb">cd</span><span class="w"> </span>/home/forge/yourdomain.com
git<span class="w"> </span>pull<span class="w"> </span>origin<span class="w"> </span>main
composer<span class="w"> </span>install<span class="w"> </span>--no-interaction<span class="w"> </span>--prefer-dist<span class="w"> </span>--optimize-autoloader

<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-f<span class="w"> </span>artisan<span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nv">$FORGE_PHP</span><span class="w"> </span>artisan<span class="w"> </span>migrate<span class="w"> </span>--force
<span class="w">    </span><span class="nv">$FORGE_PHP</span><span class="w"> </span>artisan<span class="w"> </span>config:cache
<span class="w">    </span><span class="nv">$FORGE_PHP</span><span class="w"> </span>artisan<span class="w"> </span>route:cache
<span class="w">    </span><span class="nv">$FORGE_PHP</span><span class="w"> </span>artisan<span class="w"> </span>view:cache
<span class="k">fi</span>
</code></pre></div>

<h3 id="3-laravel-vapor-deployment">3. Laravel Vapor Deployment</h3>
<p>Laravel Vapor is a serverless deployment platform:</p>
<h4 id="installing-vapor">Installing Vapor</h4>
<div class="codehilite"><pre><span></span><code>composer<span class="w"> </span>require<span class="w"> </span>laravel/vapor-cli<span class="w"> </span>--update-with-dependencies
vapor<span class="w"> </span>install
</code></pre></div>

<h4 id="vapor-configuration">Vapor Configuration</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># vapor.yml</span>
<span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">your-app-id</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">your-app-name</span>
<span class="nt">environments</span><span class="p">:</span>
<span class="w">    </span><span class="nt">production</span><span class="p">:</span>
<span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1024</span>
<span class="w">        </span><span class="nt">cli-memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512</span>
<span class="w">        </span><span class="nt">runtime</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;php-8.1&#39;</span>
<span class="w">        </span><span class="nt">build</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;composer</span><span class="nv"> </span><span class="s">install</span><span class="nv"> </span><span class="s">--no-dev&#39;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;php</span><span class="nv"> </span><span class="s">artisan</span><span class="nv"> </span><span class="s">event:cache&#39;</span>
<span class="w">        </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;php</span><span class="nv"> </span><span class="s">artisan</span><span class="nv"> </span><span class="s">migrate</span><span class="nv"> </span><span class="s">--force&#39;</span>
<span class="w">        </span><span class="nt">env</span><span class="p">:</span>
<span class="w">            </span><span class="nt">APP_ENV</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class="w">            </span><span class="nt">APP_DEBUG</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</code></pre></div>

<h4 id="deploying-with-vapor">Deploying with Vapor</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Deploy to production</span>
vapor<span class="w"> </span>deploy<span class="w"> </span>production

<span class="c1"># Deploy with environment variables</span>
vapor<span class="w"> </span>deploy<span class="w"> </span>production<span class="w"> </span>--env<span class="o">=</span>production
</code></pre></div>

<h3 id="4-docker-deployment">4. Docker Deployment</h3>
<h4 id="dockerfile">Dockerfile</h4>
<div class="codehilite"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">php:8.1-fpm</span>

<span class="c"># Install system dependencies</span>
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>git<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>curl<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>libpng-dev<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>libonig-dev<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>libxml2-dev<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>zip<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>unzip

<span class="c"># Clear cache</span>
<span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>clean<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>/var/lib/apt/lists/*

<span class="c"># Install PHP extensions</span>
<span class="k">RUN</span><span class="w"> </span>docker-php-ext-install<span class="w"> </span>pdo_mysql<span class="w"> </span>mbstring<span class="w"> </span>exif<span class="w"> </span>pcntl<span class="w"> </span>bcmath<span class="w"> </span>gd

<span class="c"># Get latest Composer</span>
<span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>composer:latest<span class="w"> </span>/usr/bin/composer<span class="w"> </span>/usr/bin/composer

<span class="c"># Set working directory</span>
<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/var/www</span>

<span class="c"># Copy existing application directory contents</span>
<span class="k">COPY</span><span class="w"> </span>.<span class="w"> </span>/var/www

<span class="c"># Copy existing application directory permissions</span>
<span class="k">COPY</span><span class="w"> </span>--chown<span class="o">=</span>www-data:www-data<span class="w"> </span>.<span class="w"> </span>/var/www

<span class="c"># Install dependencies</span>
<span class="k">RUN</span><span class="w"> </span>composer<span class="w"> </span>install<span class="w"> </span>--optimize-autoloader<span class="w"> </span>--no-dev

<span class="c"># Change current user to www</span>
<span class="k">USER</span><span class="w"> </span><span class="s">www-data</span>

<span class="c"># Expose port 9000 and start php-fpm server</span>
<span class="k">EXPOSE</span><span class="w"> </span><span class="s">9000</span>
<span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;php-fpm&quot;</span><span class="p">]</span>
</code></pre></div>

<h4 id="docker-compose">Docker Compose</h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># docker-compose.yml</span>
<span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3&#39;</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">app</span><span class="p">:</span>
<span class="w">    </span><span class="nt">build</span><span class="p">:</span>
<span class="w">      </span><span class="nt">context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.</span>
<span class="w">      </span><span class="nt">dockerfile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Dockerfile</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">laravel_app</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<span class="w">    </span><span class="nt">working_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/www</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./:/var/www</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">laravel_network</span>

<span class="w">  </span><span class="nt">nginx</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">laravel_nginx</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8000:80&quot;</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./:/var/www</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./docker/nginx/conf.d:/etc/nginx/conf.d</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">laravel_network</span>

<span class="w">  </span><span class="nt">db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql:8.0</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">laravel_db</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">MYSQL_DATABASE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">laravel</span>
<span class="w">      </span><span class="nt">MYSQL_ROOT_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">your_mysql_root_password</span>
<span class="w">      </span><span class="nt">MYSQL_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">your_mysql_password</span>
<span class="w">      </span><span class="nt">MYSQL_USER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">your_mysql_user</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dbdata:/var/lib/mysql</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">laravel_network</span>

<span class="w">  </span><span class="nt">redis</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis:alpine</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">laravel_redis</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
<span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">laravel_network</span>

<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">laravel_network</span><span class="p">:</span>
<span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>

<span class="nt">volumes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">dbdata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
</code></pre></div>

<h2 id="continuous-integrationcontinuous-deployment-cicd">Continuous Integration/Continuous Deployment (CI/CD)</h2>
<h3 id="github-actions">GitHub Actions</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># .github/workflows/deploy.yml</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy to Production</span>

<span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="nt">push</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">main</span><span class="w"> </span><span class="p p-Indicator">]</span>

<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>

<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Setup PHP</span>
<span class="w">      </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">shivammathur/setup-php@v2</span>
<span class="w">      </span><span class="nt">with</span><span class="p">:</span>
<span class="w">        </span><span class="nt">php-version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;8.1&#39;</span>
<span class="w">        </span><span class="nt">extensions</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mbstring, xml, ctype, iconv, intl, pdo_mysql, dom, filter, gd, iconv, json, mbstring, pdo, xml</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Copy .env</span>
<span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">php -r &quot;file_exists(&#39;.env&#39;) || copy(&#39;.env.example&#39;, &#39;.env&#39;);&quot;</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install Dependencies</span>
<span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">composer install -q --no-ansi --no-interaction --no-scripts --no-progress --prefer-dist</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Generate key</span>
<span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">php artisan key:generate</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Directory Permissions</span>
<span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">chmod -R 777 storage bootstrap/cache</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create Database</span>
<span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">        </span><span class="no">mkdir -p database</span>
<span class="w">        </span><span class="no">touch database/database.sqlite</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Execute tests (Unit and Feature tests) via PHPUnit</span>
<span class="w">      </span><span class="nt">env</span><span class="p">:</span>
<span class="w">        </span><span class="nt">DB_CONNECTION</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sqlite</span>
<span class="w">        </span><span class="nt">DB_DATABASE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">database/database.sqlite</span>
<span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vendor/bin/phpunit</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy to server</span>
<span class="w">      </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">appleboy/ssh-action@v0.1.5</span>
<span class="w">      </span><span class="nt">with</span><span class="p">:</span>
<span class="w">        </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.HOST }}</span>
<span class="w">        </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.USERNAME }}</span>
<span class="w">        </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.KEY }}</span>
<span class="w">        </span><span class="nt">script</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">cd /var/www/your-app</span>
<span class="w">          </span><span class="no">git pull origin main</span>
<span class="w">          </span><span class="no">composer install --no-dev --optimize-autoloader</span>
<span class="w">          </span><span class="no">php artisan migrate --force</span>
<span class="w">          </span><span class="no">php artisan config:cache</span>
<span class="w">          </span><span class="no">php artisan route:cache</span>
<span class="w">          </span><span class="no">php artisan view:cache</span>
<span class="w">          </span><span class="no">sudo systemctl restart php8.1-fpm</span>
<span class="w">          </span><span class="no">sudo systemctl restart nginx</span>
</code></pre></div>

<h3 id="gitlab-cicd">GitLab CI/CD</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># .gitlab-ci.yml</span>
<span class="nt">stages</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>

<span class="nt">test</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">php:8.1</span>
<span class="w">  </span><span class="nt">services</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql:8.0</span>
<span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
<span class="w">    </span><span class="nt">MYSQL_DATABASE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">laravel_test</span>
<span class="w">    </span><span class="nt">MYSQL_ROOT_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
<span class="w">  </span><span class="nt">before_script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apt-get update -qq &amp;&amp; apt-get install -y -qq git unzip libzip-dev</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker-php-ext-install pdo_mysql zip</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cp .env.example .env</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">composer install --no-interaction --no-progress --prefer-dist</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">php artisan key:generate</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">php artisan migrate --force</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vendor/bin/phpunit</span>

<span class="nt">deploy</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
<span class="w">  </span><span class="nt">before_script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apk add --no-cache openssh-client</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eval $(ssh-agent -s)</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;$SSH_PRIVATE_KEY&quot; | tr -d &#39;\r&#39; | ssh-add -</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mkdir -p ~/.ssh</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">chmod 700 ~/.ssh</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ssh -o StrictHostKeyChecking=no $SERVER_USER@$SERVER_HOST &quot;cd /var/www/your-app &amp;&amp; git pull origin main &amp;&amp; composer install --no-dev --optimize-autoloader &amp;&amp; php artisan migrate --force &amp;&amp; php artisan config:cache &amp;&amp; php artisan route:cache &amp;&amp; php artisan view:cache &amp;&amp; sudo systemctl restart php8.1-fpm &amp;&amp; sudo systemctl restart nginx&quot;</span>
<span class="w">  </span><span class="nt">only</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
</code></pre></div>

<h2 id="environment-specific-configurations">Environment-Specific Configurations</h2>
<h3 id="production-environment">Production Environment</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// config/app.php</span>
<span class="x">&#39;debug&#39; =&gt; env(&#39;APP_DEBUG&#39;, false),</span>
<span class="x">&#39;env&#39; =&gt; env(&#39;APP_ENV&#39;, &#39;production&#39;),</span>

<span class="x">// config/database.php</span>
<span class="x">&#39;default&#39; =&gt; env(&#39;DB_CONNECTION&#39;, &#39;mysql&#39;),</span>
<span class="x">&#39;mysql&#39; =&gt; [</span>
<span class="x">    &#39;driver&#39; =&gt; &#39;mysql&#39;,</span>
<span class="x">    &#39;host&#39; =&gt; env(&#39;DB_HOST&#39;, &#39;127.0.0.1&#39;),</span>
<span class="x">    &#39;port&#39; =&gt; env(&#39;DB_PORT&#39;, &#39;3306&#39;),</span>
<span class="x">    &#39;database&#39; =&gt; env(&#39;DB_DATABASE&#39;, &#39;forge&#39;),</span>
<span class="x">    &#39;username&#39; =&gt; env(&#39;DB_USERNAME&#39;, &#39;forge&#39;),</span>
<span class="x">    &#39;password&#39; =&gt; env(&#39;DB_PASSWORD&#39;, &#39;&#39;),</span>
<span class="x">    &#39;charset&#39; =&gt; &#39;utf8mb4&#39;,</span>
<span class="x">    &#39;collation&#39; =&gt; &#39;utf8mb4_unicode_ci&#39;,</span>
<span class="x">    &#39;prefix&#39; =&gt; &#39;&#39;,</span>
<span class="x">    &#39;strict&#39; =&gt; true,</span>
<span class="x">    &#39;engine&#39; =&gt; null,</span>
<span class="x">],</span>

<span class="x">// config/cache.php</span>
<span class="x">&#39;default&#39; =&gt; env(&#39;CACHE_DRIVER&#39;, &#39;redis&#39;),</span>
<span class="x">&#39;redis&#39; =&gt; [</span>
<span class="x">    &#39;driver&#39; =&gt; &#39;redis&#39;,</span>
<span class="x">    &#39;connection&#39; =&gt; &#39;cache&#39;,</span>
<span class="x">    &#39;lock_connection&#39; =&gt; &#39;default&#39;,</span>
<span class="x">],</span>

<span class="x">// config/session.php</span>
<span class="x">&#39;driver&#39; =&gt; env(&#39;SESSION_DRIVER&#39;, &#39;redis&#39;),</span>
<span class="x">&#39;lifetime&#39; =&gt; env(&#39;SESSION_LIFETIME&#39;, 120),</span>
<span class="x">&#39;expire_on_close&#39; =&gt; false,</span>
<span class="x">&#39;secure&#39; =&gt; env(&#39;SESSION_SECURE_COOKIE&#39;, true),</span>
<span class="x">&#39;same_site&#39; =&gt; env(&#39;SESSION_SAME_SITE&#39;, &#39;strict&#39;),</span>
</code></pre></div>

<h3 id="staging-environment">Staging Environment</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># .env.staging</span>
<span class="nv">APP_ENV</span><span class="o">=</span>staging
<span class="nv">APP_DEBUG</span><span class="o">=</span><span class="nb">true</span>
<span class="nv">APP_URL</span><span class="o">=</span>https://staging.yourdomain.com

<span class="nv">DB_CONNECTION</span><span class="o">=</span>mysql
<span class="nv">DB_HOST</span><span class="o">=</span>staging-db-host
<span class="nv">DB_DATABASE</span><span class="o">=</span>staging_database
<span class="nv">DB_USERNAME</span><span class="o">=</span>staging_user
<span class="nv">DB_PASSWORD</span><span class="o">=</span>staging_password

<span class="nv">CACHE_DRIVER</span><span class="o">=</span>file
<span class="nv">SESSION_DRIVER</span><span class="o">=</span>file
<span class="nv">QUEUE_CONNECTION</span><span class="o">=</span>sync
</code></pre></div>

<h2 id="monitoring-and-logging">Monitoring and Logging</h2>
<h3 id="application-monitoring">Application Monitoring</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// config/logging.php</span>
<span class="x">&#39;channels&#39; =&gt; [</span>
<span class="x">    &#39;stack&#39; =&gt; [</span>
<span class="x">        &#39;driver&#39; =&gt; &#39;stack&#39;,</span>
<span class="x">        &#39;channels&#39; =&gt; [&#39;single&#39;, &#39;daily&#39;],</span>
<span class="x">        &#39;ignore_exceptions&#39; =&gt; false,</span>
<span class="x">    ],</span>
<span class="x">    &#39;single&#39; =&gt; [</span>
<span class="x">        &#39;driver&#39; =&gt; &#39;single&#39;,</span>
<span class="x">        &#39;path&#39; =&gt; storage_path(&#39;logs/laravel.log&#39;),</span>
<span class="x">        &#39;level&#39; =&gt; env(&#39;LOG_LEVEL&#39;, &#39;debug&#39;),</span>
<span class="x">    ],</span>
<span class="x">    &#39;daily&#39; =&gt; [</span>
<span class="x">        &#39;driver&#39; =&gt; &#39;daily&#39;,</span>
<span class="x">        &#39;path&#39; =&gt; storage_path(&#39;logs/laravel.log&#39;),</span>
<span class="x">        &#39;level&#39; =&gt; env(&#39;LOG_LEVEL&#39;, &#39;debug&#39;),</span>
<span class="x">        &#39;days&#39; =&gt; 14,</span>
<span class="x">    ],</span>
<span class="x">    &#39;slack&#39; =&gt; [</span>
<span class="x">        &#39;driver&#39; =&gt; &#39;slack&#39;,</span>
<span class="x">        &#39;url&#39; =&gt; env(&#39;LOG_SLACK_WEBHOOK_URL&#39;),</span>
<span class="x">        &#39;username&#39; =&gt; &#39;Laravel Log&#39;,</span>
<span class="x">        &#39;emoji&#39; =&gt; &#39;:boom:&#39;,</span>
<span class="x">        &#39;level&#39; =&gt; env(&#39;LOG_LEVEL&#39;, &#39;critical&#39;),</span>
<span class="x">    ],</span>
<span class="x">],</span>
</code></pre></div>

<h3 id="error-tracking">Error Tracking</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// config/app.php</span>
<span class="x">&#39;providers&#39; =&gt; [</span>
<span class="x">    // ...</span>
<span class="x">    Sentry\Laravel\ServiceProvider::class,</span>
<span class="x">],</span>

<span class="x">// config/sentry.php</span>
<span class="x">&#39;dsn&#39; =&gt; env(&#39;SENTRY_LARAVEL_DSN&#39;),</span>
<span class="x">&#39;breadcrumbs&#39; =&gt; [</span>
<span class="x">    &#39;logs&#39; =&gt; true,</span>
<span class="x">    &#39;sql_queries&#39; =&gt; true,</span>
<span class="x">    &#39;sql_bindings&#39; =&gt; true,</span>
<span class="x">    &#39;queue_info&#39; =&gt; true,</span>
<span class="x">    &#39;command_info&#39; =&gt; true,</span>
<span class="x">],</span>
</code></pre></div>

<h2 id="performance-optimization_1">Performance Optimization</h2>
<h3 id="caching-strategies">Caching Strategies</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Cache configuration</span>
php<span class="w"> </span>artisan<span class="w"> </span>config:cache

<span class="c1"># Cache routes</span>
php<span class="w"> </span>artisan<span class="w"> </span>route:cache

<span class="c1"># Cache views</span>
php<span class="w"> </span>artisan<span class="w"> </span>view:cache

<span class="c1"># Cache events</span>
php<span class="w"> </span>artisan<span class="w"> </span>event:cache
</code></pre></div>

<h3 id="database-optimization">Database Optimization</h3>
<div class="codehilite"><pre><span></span><code><span class="c1">-- Add indexes for better performance</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_users_email</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="p">(</span><span class="n">email</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_posts_user_id</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">posts</span><span class="p">(</span><span class="n">user_id</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_posts_created_at</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">posts</span><span class="p">(</span><span class="n">created_at</span><span class="p">);</span>

<span class="c1">-- Optimize tables</span>
<span class="n">OPTIMIZE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">users</span><span class="p">;</span>
<span class="n">OPTIMIZE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">posts</span><span class="p">;</span>
</code></pre></div>

<h3 id="queue-configuration">Queue Configuration</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// config/queue.php</span>
<span class="x">&#39;default&#39; =&gt; env(&#39;QUEUE_CONNECTION&#39;, &#39;redis&#39;),</span>
<span class="x">&#39;connections&#39; =&gt; [</span>
<span class="x">    &#39;redis&#39; =&gt; [</span>
<span class="x">        &#39;driver&#39; =&gt; &#39;redis&#39;,</span>
<span class="x">        &#39;connection&#39; =&gt; &#39;default&#39;,</span>
<span class="x">        &#39;queue&#39; =&gt; env(&#39;REDIS_QUEUE&#39;, &#39;default&#39;),</span>
<span class="x">        &#39;retry_after&#39; =&gt; 90,</span>
<span class="x">        &#39;block_for&#39; =&gt; null,</span>
<span class="x">        &#39;after_commit&#39; =&gt; false,</span>
<span class="x">    ],</span>
<span class="x">],</span>
</code></pre></div>

<h2 id="sslhttps-configuration">SSL/HTTPS Configuration</h2>
<h3 id="lets-encrypt-ssl">Let's Encrypt SSL</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Install Certbot</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>certbot<span class="w"> </span>python3-certbot-nginx

<span class="c1"># Obtain SSL certificate</span>
sudo<span class="w"> </span>certbot<span class="w"> </span>--nginx<span class="w"> </span>-d<span class="w"> </span>yourdomain.com<span class="w"> </span>-d<span class="w"> </span>www.yourdomain.com

<span class="c1"># Auto-renewal</span>
sudo<span class="w"> </span>crontab<span class="w"> </span>-e
<span class="c1"># Add: 0 12 * * * /usr/bin/certbot renew --quiet</span>
</code></pre></div>

<h3 id="nginx-ssl-configuration">Nginx SSL Configuration</h3>
<div class="codehilite"><pre><span></span><code><span class="k">server</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">listen</span><span class="w"> </span><span class="mi">443</span><span class="w"> </span><span class="s">ssl</span><span class="w"> </span><span class="s">http2</span><span class="p">;</span>
<span class="w">    </span><span class="kn">server_name</span><span class="w"> </span><span class="s">yourdomain.com</span><span class="p">;</span>

<span class="w">    </span><span class="kn">ssl_certificate</span><span class="w"> </span><span class="s">/etc/letsencrypt/live/yourdomain.com/fullchain.pem</span><span class="p">;</span>
<span class="w">    </span><span class="kn">ssl_certificate_key</span><span class="w"> </span><span class="s">/etc/letsencrypt/live/yourdomain.com/privkey.pem</span><span class="p">;</span>

<span class="w">    </span><span class="kn">ssl_protocols</span><span class="w"> </span><span class="s">TLSv1.2</span><span class="w"> </span><span class="s">TLSv1.3</span><span class="p">;</span>
<span class="w">    </span><span class="kn">ssl_ciphers</span><span class="w"> </span><span class="s">ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384</span><span class="p">;</span>
<span class="w">    </span><span class="kn">ssl_prefer_server_ciphers</span><span class="w"> </span><span class="no">off</span><span class="p">;</span>

<span class="w">    </span><span class="c1"># HSTS</span>
<span class="w">    </span><span class="kn">add_header</span><span class="w"> </span><span class="s">Strict-Transport-Security</span><span class="w"> </span><span class="s">&quot;max-age=63072000&quot;</span><span class="w"> </span><span class="s">always</span><span class="p">;</span>

<span class="w">    </span><span class="kn">root</span><span class="w"> </span><span class="s">/var/www/your-app/public</span><span class="p">;</span>
<span class="w">    </span><span class="kn">index</span><span class="w"> </span><span class="s">index.php</span><span class="p">;</span>

<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">try_files</span><span class="w"> </span><span class="nv">$uri</span><span class="w"> </span><span class="nv">$uri/</span><span class="w"> </span><span class="s">/index.php?</span><span class="nv">$query_string</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="p">~</span><span class="w"> </span><span class="sr">\.php$</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">fastcgi_pass</span><span class="w"> </span><span class="s">unix:/var/run/php/php8.1-fpm.sock</span><span class="p">;</span>
<span class="w">        </span><span class="kn">fastcgi_param</span><span class="w"> </span><span class="s">SCRIPT_FILENAME</span><span class="w"> </span><span class="nv">$realpath_root$fastcgi_script_name</span><span class="p">;</span>
<span class="w">        </span><span class="kn">include</span><span class="w"> </span><span class="s">fastcgi_params</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Redirect HTTP to HTTPS</span>
<span class="k">server</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">listen</span><span class="w"> </span><span class="mi">80</span><span class="p">;</span>
<span class="w">    </span><span class="kn">server_name</span><span class="w"> </span><span class="s">yourdomain.com</span><span class="p">;</span>
<span class="w">    </span><span class="kn">return</span><span class="w"> </span><span class="mi">301</span><span class="w"> </span><span class="s">https://</span><span class="nv">$server_name$request_uri</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="backup-strategies">Backup Strategies</h2>
<h3 id="database-backups">Database Backups</h3>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># backup.sh</span>

<span class="nv">DATE</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%Y%m%d_%H%M%S<span class="k">)</span>
<span class="nv">BACKUP_DIR</span><span class="o">=</span><span class="s2">&quot;/var/backups/database&quot;</span>
<span class="nv">DB_NAME</span><span class="o">=</span><span class="s2">&quot;your_database&quot;</span>
<span class="nv">DB_USER</span><span class="o">=</span><span class="s2">&quot;your_username&quot;</span>

<span class="c1"># Create backup directory</span>
mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$BACKUP_DIR</span>

<span class="c1"># Create backup</span>
mysqldump<span class="w"> </span>-u<span class="w"> </span><span class="nv">$DB_USER</span><span class="w"> </span>-p<span class="w"> </span><span class="nv">$DB_NAME</span><span class="w"> </span>&gt;<span class="w"> </span><span class="nv">$BACKUP_DIR</span>/backup_<span class="nv">$DATE</span>.sql

<span class="c1"># Compress backup</span>
gzip<span class="w"> </span><span class="nv">$BACKUP_DIR</span>/backup_<span class="nv">$DATE</span>.sql

<span class="c1"># Keep only last 7 days of backups</span>
find<span class="w"> </span><span class="nv">$BACKUP_DIR</span><span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;backup_*.sql.gz&quot;</span><span class="w"> </span>-mtime<span class="w"> </span>+7<span class="w"> </span>-delete

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Backup completed: backup_</span><span class="nv">$DATE</span><span class="s2">.sql.gz&quot;</span>
</code></pre></div>

<h3 id="file-backups">File Backups</h3>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1"># file_backup.sh</span>

<span class="nv">DATE</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%Y%m%d_%H%M%S<span class="k">)</span>
<span class="nv">BACKUP_DIR</span><span class="o">=</span><span class="s2">&quot;/var/backups/files&quot;</span>
<span class="nv">APP_DIR</span><span class="o">=</span><span class="s2">&quot;/var/www/your-app&quot;</span>

<span class="c1"># Create backup directory</span>
mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$BACKUP_DIR</span>

<span class="c1"># Create backup of storage directory</span>
tar<span class="w"> </span>-czf<span class="w"> </span><span class="nv">$BACKUP_DIR</span>/storage_backup_<span class="nv">$DATE</span>.tar.gz<span class="w"> </span>-C<span class="w"> </span><span class="nv">$APP_DIR</span><span class="w"> </span>storage

<span class="c1"># Create backup of public directory</span>
tar<span class="w"> </span>-czf<span class="w"> </span><span class="nv">$BACKUP_DIR</span>/public_backup_<span class="nv">$DATE</span>.tar.gz<span class="w"> </span>-C<span class="w"> </span><span class="nv">$APP_DIR</span><span class="w"> </span>public

<span class="c1"># Keep only last 7 days of backups</span>
find<span class="w"> </span><span class="nv">$BACKUP_DIR</span><span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;*_backup_*.tar.gz&quot;</span><span class="w"> </span>-mtime<span class="w"> </span>+7<span class="w"> </span>-delete

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;File backup completed&quot;</span>
</code></pre></div>

<h2 id="troubleshooting-common-issues">Troubleshooting Common Issues</h2>
<h3 id="permission-issues">Permission Issues</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Fix storage permissions</span>
sudo<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>www-data:www-data<span class="w"> </span>storage<span class="w"> </span>bootstrap/cache
sudo<span class="w"> </span>chmod<span class="w"> </span>-R<span class="w"> </span><span class="m">755</span><span class="w"> </span>storage<span class="w"> </span>bootstrap/cache

<span class="c1"># Fix log permissions</span>
sudo<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>www-data:www-data<span class="w"> </span>storage/logs
sudo<span class="w"> </span>chmod<span class="w"> </span>-R<span class="w"> </span><span class="m">755</span><span class="w"> </span>storage/logs
</code></pre></div>

<h3 id="memory-issues">Memory Issues</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Increase PHP memory limit</span>
sudo<span class="w"> </span>nano<span class="w"> </span>/etc/php/8.1/fpm/php.ini
<span class="c1"># memory_limit = 512M</span>

<span class="c1"># Increase PHP-FPM memory</span>
sudo<span class="w"> </span>nano<span class="w"> </span>/etc/php/8.1/fpm/php-fpm.conf
<span class="c1"># pm.max_children = 50</span>
<span class="c1"># pm.start_servers = 5</span>
<span class="c1"># pm.min_spare_servers = 5</span>
<span class="c1"># pm.max_spare_servers = 35</span>
</code></pre></div>

<h3 id="database-connection-issues">Database Connection Issues</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Check MySQL status</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>mysql

<span class="c1"># Check MySQL logs</span>
sudo<span class="w"> </span>tail<span class="w"> </span>-f<span class="w"> </span>/var/log/mysql/error.log

<span class="c1"># Test database connection</span>
mysql<span class="w"> </span>-u<span class="w"> </span>your_username<span class="w"> </span>-p<span class="w"> </span>-h<span class="w"> </span>your_host<span class="w"> </span>your_database
</code></pre></div>

<h2 id="deployment-best-practices">Deployment Best Practices</h2>
<h3 id="1-use-environment-variables">1. Use Environment Variables</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Never commit sensitive data</span>
<span class="c1"># Use .env files for configuration</span>
<span class="nv">APP_KEY</span><span class="o">=</span>base64:your-key-here
<span class="nv">DB_PASSWORD</span><span class="o">=</span>your-secure-password
<span class="nv">MAIL_PASSWORD</span><span class="o">=</span>your-email-password
</code></pre></div>

<h3 id="2-implement-zero-downtime-deployment">2. Implement Zero-Downtime Deployment</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Use blue-green deployment</span>
<span class="c1"># Deploy to new server</span>
<span class="c1"># Switch traffic when ready</span>
<span class="c1"># Keep old server as backup</span>
</code></pre></div>

<h3 id="3-monitor-application-health">3. Monitor Application Health</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Set up health checks</span>
<span class="c1"># Monitor error rates</span>
<span class="c1"># Track response times</span>
<span class="c1"># Set up alerts</span>
</code></pre></div>

<h3 id="4-regular-maintenance">4. Regular Maintenance</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Update dependencies regularly</span>
<span class="c1"># Monitor security patches</span>
<span class="c1"># Clean up old logs</span>
<span class="c1"># Optimize database</span>
</code></pre></div>

<h2 id="summary">Summary</h2>
<p>In this chapter, we covered:</p>
<ul>
<li>✅ Pre-deployment checklist and preparation</li>
<li>✅ Different deployment methods (traditional, Forge, Vapor, Docker)</li>
<li>✅ CI/CD pipeline setup</li>
<li>✅ Environment-specific configurations</li>
<li>✅ Monitoring and logging strategies</li>
<li>✅ Performance optimization techniques</li>
<li>✅ SSL/HTTPS configuration</li>
<li>✅ Backup strategies</li>
<li>✅ Troubleshooting common issues</li>
<li>✅ Deployment best practices</li>
</ul>
<p>Deployment is the final step in bringing your Laravel application to production. With proper planning and execution, you can ensure a smooth and reliable deployment process.</p>
<p>Congratulations! You've completed the Laravel: From Zero to Production book. You now have a comprehensive understanding of Laravel development and are ready to build and deploy production-ready applications.</p></div><div class="chapter" id="13-caching"><h1 id="caching">Caching</h1>
<h2 id="overview">Overview</h2>
<p>Caching is essential for improving application performance. Laravel provides a powerful caching system that supports multiple cache drivers and offers various caching strategies. This chapter covers everything you need to know about implementing effective caching in your Laravel applications.</p>
<h2 id="what-is-caching">What is Caching?</h2>
<p>Caching is the process of storing frequently accessed data in memory or fast storage to reduce response times and server load. Laravel's caching system provides a unified API for working with different cache backends.</p>
<h2 id="cache-drivers">Cache Drivers</h2>
<p>Laravel supports multiple cache drivers, each with different characteristics:</p>
<h3 id="available-drivers">Available Drivers</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// config/cache.php</span>
<span class="x">&#39;default&#39; =&gt; env(&#39;CACHE_DRIVER&#39;, &#39;file&#39;),</span>

<span class="x">&#39;stores&#39; =&gt; [</span>
<span class="x">    &#39;apc&#39; =&gt; [</span>
<span class="x">        &#39;driver&#39; =&gt; &#39;apc&#39;,</span>
<span class="x">    ],</span>
<span class="x">    &#39;array&#39; =&gt; [</span>
<span class="x">        &#39;driver&#39; =&gt; &#39;array&#39;,</span>
<span class="x">    ],</span>
<span class="x">    &#39;file&#39; =&gt; [</span>
<span class="x">        &#39;driver&#39; =&gt; &#39;file&#39;,</span>
<span class="x">        &#39;path&#39; =&gt; storage_path(&#39;framework/cache/data&#39;),</span>
<span class="x">    ],</span>
<span class="x">    &#39;redis&#39; =&gt; [</span>
<span class="x">        &#39;driver&#39; =&gt; &#39;redis&#39;,</span>
<span class="x">        &#39;connection&#39; =&gt; &#39;cache&#39;,</span>
<span class="x">    ],</span>
<span class="x">    &#39;memcached&#39; =&gt; [</span>
<span class="x">        &#39;driver&#39; =&gt; &#39;memcached&#39;,</span>
<span class="x">        &#39;persistent_id&#39; =&gt; env(&#39;MEMCACHED_PERSISTENT_ID&#39;),</span>
<span class="x">        &#39;sasl&#39; =&gt; [</span>
<span class="x">            env(&#39;MEMCACHED_USERNAME&#39;),</span>
<span class="x">            env(&#39;MEMCACHED_PASSWORD&#39;),</span>
<span class="x">        ],</span>
<span class="x">        &#39;options&#39; =&gt; [</span>
<span class="x">            // Memcached::OPT_CONNECT_TIMEOUT =&gt; 2000,</span>
<span class="x">        ],</span>
<span class="x">        &#39;servers&#39; =&gt; [</span>
<span class="x">            [</span>
<span class="x">                &#39;host&#39; =&gt; env(&#39;MEMCACHED_HOST&#39;, &#39;127.0.0.1&#39;),</span>
<span class="x">                &#39;port&#39; =&gt; env(&#39;MEMCACHED_PORT&#39;, 11211),</span>
<span class="x">                &#39;weight&#39; =&gt; 100,</span>
<span class="x">            ],</span>
<span class="x">        ],</span>
<span class="x">    ],</span>
<span class="x">],</span>
</code></pre></div>

<h3 id="driver-comparison">Driver Comparison</h3>
<table>
<thead>
<tr>
<th>Driver</th>
<th>Speed</th>
<th>Persistence</th>
<th>Memory Usage</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td>Array</td>
<td>Fastest</td>
<td>No</td>
<td>High</td>
<td>Testing</td>
</tr>
<tr>
<td>File</td>
<td>Slow</td>
<td>Yes</td>
<td>Low</td>
<td>Development</td>
</tr>
<tr>
<td>Redis</td>
<td>Fast</td>
<td>Yes</td>
<td>Medium</td>
<td>Production</td>
</tr>
<tr>
<td>Memcached</td>
<td>Fast</td>
<td>No</td>
<td>Low</td>
<td>Production</td>
</tr>
<tr>
<td>APC</td>
<td>Fastest</td>
<td>No</td>
<td>High</td>
<td>Single Server</td>
</tr>
</tbody>
</table>
<h2 id="basic-caching-operations">Basic Caching Operations</h2>
<h3 id="storing-items">Storing Items</h3>
<div class="codehilite"><pre><span></span><code><span class="x">use Illuminate\Support\Facades\Cache;</span>

<span class="x">// Store a simple value</span>
<span class="x">Cache::put(&#39;key&#39;, &#39;value&#39;, $seconds = 60);</span>

<span class="x">// Store forever</span>
<span class="x">Cache::forever(&#39;key&#39;, &#39;value&#39;);</span>

<span class="x">// Store if not exists</span>
<span class="x">Cache::add(&#39;key&#39;, &#39;value&#39;, $seconds = 60);</span>

<span class="x">// Store with helper function</span>
<span class="x">cache([&#39;key&#39; =&gt; &#39;value&#39;], $seconds = 60);</span>
</code></pre></div>

<h3 id="retrieving-items">Retrieving Items</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Get value</span>
<span class="x">$value = Cache::get(&#39;key&#39;);</span>

<span class="x">// Get with default</span>
<span class="x">$value = Cache::get(&#39;key&#39;, &#39;default&#39;);</span>

<span class="x">// Get and delete</span>
<span class="x">$value = Cache::pull(&#39;key&#39;);</span>

<span class="x">// Check if exists</span>
<span class="x">if (Cache::has(&#39;key&#39;)) {</span>
<span class="x">    // Key exists</span>
<span class="x">}</span>

<span class="x">// Get multiple items</span>
<span class="x">$values = Cache::many([&#39;key1&#39;, &#39;key2&#39;, &#39;key3&#39;]);</span>
</code></pre></div>

<h3 id="removing-items">Removing Items</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Remove single item</span>
<span class="x">Cache::forget(&#39;key&#39;);</span>

<span class="x">// Remove multiple items</span>
<span class="x">Cache::forget([&#39;key1&#39;, &#39;key2&#39;]);</span>

<span class="x">// Clear all cache</span>
<span class="x">Cache::flush();</span>

<span class="x">// Remove by pattern (Redis only)</span>
<span class="x">Cache::flush(&#39;user:*&#39;);</span>
</code></pre></div>

<h2 id="cache-tags">Cache Tags</h2>
<p>Cache tags allow you to group related cache items and flush them together:</p>
<div class="codehilite"><pre><span></span><code><span class="x">// Store with tags</span>
<span class="x">Cache::tags([&#39;users&#39;, &#39;posts&#39;])-&gt;put(&#39;user_posts&#39;, $posts, 3600);</span>

<span class="x">// Retrieve with tags</span>
<span class="x">$posts = Cache::tags([&#39;users&#39;, &#39;posts&#39;])-&gt;get(&#39;user_posts&#39;);</span>

<span class="x">// Flush specific tags</span>
<span class="x">Cache::tags(&#39;users&#39;)-&gt;flush();</span>

<span class="x">// Flush multiple tags</span>
<span class="x">Cache::tags([&#39;users&#39;, &#39;posts&#39;])-&gt;flush();</span>
</code></pre></div>

<h2 id="cache-helpers">Cache Helpers</h2>
<h3 id="remember-pattern">Remember Pattern</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Remember pattern - get from cache or store</span>
<span class="x">$users = Cache::remember(&#39;users&#39;, 3600, function () {</span>
<span class="x">    return User::all();</span>
<span class="x">});</span>

<span class="x">// Remember forever</span>
<span class="x">$users = Cache::rememberForever(&#39;users&#39;, function () {</span>
<span class="x">    return User::all();</span>
<span class="x">});</span>

<span class="x">// Remember with tags</span>
<span class="x">$users = Cache::tags(&#39;users&#39;)-&gt;remember(&#39;all_users&#39;, 3600, function () {</span>
<span class="x">    return User::all();</span>
<span class="x">});</span>
</code></pre></div>

<h3 id="incrementdecrement">Increment/Decrement</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Increment counter</span>
<span class="x">Cache::increment(&#39;counter&#39;);</span>
<span class="x">Cache::increment(&#39;counter&#39;, 5);</span>

<span class="x">// Decrement counter</span>
<span class="x">Cache::decrement(&#39;counter&#39;);</span>
<span class="x">Cache::decrement(&#39;counter&#39;, 5);</span>
</code></pre></div>

<h2 id="model-caching">Model Caching</h2>
<h3 id="cache-model-queries">Cache Model Queries</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Cache query results</span>
<span class="x">$users = Cache::remember(&#39;users.active&#39;, 3600, function () {</span>
<span class="x">    return User::where(&#39;active&#39;, true)-&gt;get();</span>
<span class="x">});</span>

<span class="x">// Cache with model events</span>
<span class="x">class User extends Model</span>
<span class="x">{</span>
<span class="x">    protected static function boot()</span>
<span class="x">    {</span>
<span class="x">        parent::boot();</span>

<span class="x">        static::saved(function ($user) {</span>
<span class="x">            Cache::tags(&#39;users&#39;)-&gt;flush();</span>
<span class="x">        });</span>

<span class="x">        static::deleted(function ($user) {</span>
<span class="x">            Cache::tags(&#39;users&#39;)-&gt;flush();</span>
<span class="x">        });</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="cache-model-relationships">Cache Model Relationships</h3>
<div class="codehilite"><pre><span></span><code><span class="x">class User extends Model</span>
<span class="x">{</span>
<span class="x">    public function posts()</span>
<span class="x">    {</span>
<span class="x">        return $this-&gt;hasMany(Post::class);</span>
<span class="x">    }</span>

<span class="x">    public function getCachedPostsAttribute()</span>
<span class="x">    {</span>
<span class="x">        return Cache::remember(&quot;user.{$this-&gt;id}.posts&quot;, 3600, function () {</span>
<span class="x">            return $this-&gt;posts()-&gt;with(&#39;comments&#39;)-&gt;get();</span>
<span class="x">        });</span>
<span class="x">    }</span>
<span class="x">}</span>

<span class="x">// Usage</span>
<span class="x">$user = User::find(1);</span>
<span class="x">$posts = $user-&gt;cached_posts;</span>
</code></pre></div>

<h2 id="route-caching">Route Caching</h2>
<h3 id="cache-routes">Cache Routes</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Cache all routes</span>
php<span class="w"> </span>artisan<span class="w"> </span>route:cache

<span class="c1"># Clear route cache</span>
php<span class="w"> </span>artisan<span class="w"> </span>route:clear

<span class="c1"># List cached routes</span>
php<span class="w"> </span>artisan<span class="w"> </span>route:list
</code></pre></div>

<h3 id="cache-configuration">Cache Configuration</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Cache configuration</span>
php<span class="w"> </span>artisan<span class="w"> </span>config:cache

<span class="c1"># Clear config cache</span>
php<span class="w"> </span>artisan<span class="w"> </span>config:clear

<span class="c1"># Cache views</span>
php<span class="w"> </span>artisan<span class="w"> </span>view:cache

<span class="c1"># Clear view cache</span>
php<span class="w"> </span>artisan<span class="w"> </span>view:clear
</code></pre></div>

<h2 id="database-query-caching">Database Query Caching</h2>
<h3 id="cache-query-results">Cache Query Results</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Cache database queries</span>
<span class="x">$users = DB::table(&#39;users&#39;)</span>
<span class="x">    -&gt;where(&#39;active&#39;, true)</span>
<span class="x">    -&gt;remember(60)</span>
<span class="x">    -&gt;get();</span>

<span class="x">// Cache with tags</span>
<span class="x">$users = DB::table(&#39;users&#39;)</span>
<span class="x">    -&gt;where(&#39;active&#39;, true)</span>
<span class="x">    -&gt;remember(60, &#39;users.active&#39;)</span>
<span class="x">    -&gt;get();</span>
</code></pre></div>

<h3 id="cache-eloquent-queries">Cache Eloquent Queries</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Cache Eloquent queries</span>
<span class="x">$users = User::where(&#39;active&#39;, true)</span>
<span class="x">    -&gt;remember(60)</span>
<span class="x">    -&gt;get();</span>

<span class="x">// Cache with relationships</span>
<span class="x">$users = User::with(&#39;posts&#39;)</span>
<span class="x">    -&gt;where(&#39;active&#39;, true)</span>
<span class="x">    -&gt;remember(60, &#39;users.with_posts&#39;)</span>
<span class="x">    -&gt;get();</span>
</code></pre></div>

<h2 id="cache-events">Cache Events</h2>
<h3 id="listen-to-cache-events">Listen to Cache Events</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// In EventServiceProvider</span>
<span class="x">protected $listen = [</span>
<span class="x">    &#39;Illuminate\Cache\Events\CacheHit&#39; =&gt; [</span>
<span class="x">        &#39;App\Listeners\LogCacheHit&#39;,</span>
<span class="x">    ],</span>
<span class="x">    &#39;Illuminate\Cache\Events\CacheMissed&#39; =&gt; [</span>
<span class="x">        &#39;App\Listeners\LogCacheMissed&#39;,</span>
<span class="x">    ],</span>
<span class="x">    &#39;Illuminate\Cache\Events\KeyForgotten&#39; =&gt; [</span>
<span class="x">        &#39;App\Listeners\LogCacheForgotten&#39;,</span>
<span class="x">    ],</span>
<span class="x">    &#39;Illuminate\Cache\Events\KeyWritten&#39; =&gt; [</span>
<span class="x">        &#39;App\Listeners\LogCacheWritten&#39;,</span>
<span class="x">    ],</span>
<span class="x">];</span>
</code></pre></div>

<h3 id="custom-cache-events">Custom Cache Events</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Create custom cache events</span>
<span class="x">class CacheCleared</span>
<span class="x">{</span>
<span class="x">    public $tags;</span>

<span class="x">    public function __construct($tags = null)</span>
<span class="x">    {</span>
<span class="x">        $this-&gt;tags = $tags;</span>
<span class="x">    }</span>
<span class="x">}</span>

<span class="x">// Dispatch event</span>
<span class="x">event(new CacheCleared([&#39;users&#39;, &#39;posts&#39;]));</span>
</code></pre></div>

<h2 id="cache-middleware">Cache Middleware</h2>
<h3 id="cache-response-middleware">Cache Response Middleware</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Create cache middleware</span>
<span class="x">php artisan make:middleware CacheResponse</span>

<span class="x">class CacheResponse</span>
<span class="x">{</span>
<span class="x">    public function handle($request, Closure $next)</span>
<span class="x">    {</span>
<span class="x">        if ($request-&gt;isMethod(&#39;GET&#39;)) {</span>
<span class="x">            $cacheKey = &#39;page_cache_&#39; . sha1($request-&gt;fullUrl());</span>

<span class="x">            if (Cache::has($cacheKey)) {</span>
<span class="x">                return Cache::get($cacheKey);</span>
<span class="x">            }</span>

<span class="x">            $response = $next($request);</span>

<span class="x">            Cache::put($cacheKey, $response, 3600);</span>

<span class="x">            return $response;</span>
<span class="x">        }</span>

<span class="x">        return $next($request);</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="apply-to-routes">Apply to Routes</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Apply to specific routes</span>
<span class="x">Route::get(&#39;/posts&#39;, [PostController::class, &#39;index&#39;])</span>
<span class="x">    -&gt;middleware(&#39;cache.response&#39;);</span>

<span class="x">// Apply to route groups</span>
<span class="x">Route::middleware([&#39;cache.response&#39;])-&gt;group(function () {</span>
<span class="x">    Route::get(&#39;/posts&#39;, [PostController::class, &#39;index&#39;]);</span>
<span class="x">    Route::get(&#39;/users&#39;, [UserController::class, &#39;index&#39;]);</span>
<span class="x">});</span>
</code></pre></div>

<h2 id="advanced-caching-patterns">Advanced Caching Patterns</h2>
<h3 id="cache-aside-pattern">Cache-Aside Pattern</h3>
<div class="codehilite"><pre><span></span><code><span class="x">class UserService</span>
<span class="x">{</span>
<span class="x">    public function getUser($id)</span>
<span class="x">    {</span>
<span class="x">        return Cache::remember(&quot;user.{$id}&quot;, 3600, function () use ($id) {</span>
<span class="x">            return User::findOrFail($id);</span>
<span class="x">        });</span>
<span class="x">    }</span>

<span class="x">    public function updateUser($id, $data)</span>
<span class="x">    {</span>
<span class="x">        $user = User::findOrFail($id);</span>
<span class="x">        $user-&gt;update($data);</span>

<span class="x">        // Invalidate cache</span>
<span class="x">        Cache::forget(&quot;user.{$id}&quot;);</span>

<span class="x">        return $user;</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="write-through-pattern">Write-Through Pattern</h3>
<div class="codehilite"><pre><span></span><code><span class="x">class PostService</span>
<span class="x">{</span>
<span class="x">    public function createPost($data)</span>
<span class="x">    {</span>
<span class="x">        $post = Post::create($data);</span>

<span class="x">        // Update cache immediately</span>
<span class="x">        Cache::put(&quot;post.{$post-&gt;id}&quot;, $post, 3600);</span>
<span class="x">        Cache::tags(&#39;posts&#39;)-&gt;flush();</span>

<span class="x">        return $post;</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="cache-warming">Cache Warming</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Warm up cache on application start</span>
<span class="x">class WarmCache</span>
<span class="x">{</span>
<span class="x">    public function handle()</span>
<span class="x">    {</span>
<span class="x">        // Cache frequently accessed data</span>
<span class="x">        Cache::remember(&#39;popular_posts&#39;, 3600, function () {</span>
<span class="x">            return Post::popular()-&gt;take(10)-&gt;get();</span>
<span class="x">        });</span>

<span class="x">        Cache::remember(&#39;active_users&#39;, 3600, function () {</span>
<span class="x">            return User::active()-&gt;take(50)-&gt;get();</span>
<span class="x">        });</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h2 id="performance-optimization">Performance Optimization</h2>
<h3 id="cache-key-strategies">Cache Key Strategies</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Use descriptive cache keys</span>
<span class="x">Cache::put(&quot;user.{$user-&gt;id}.profile&quot;, $profile, 3600);</span>
<span class="x">Cache::put(&quot;user.{$user-&gt;id}.posts&quot;, $posts, 1800);</span>
<span class="x">Cache::put(&quot;user.{$user-&gt;id}.settings&quot;, $settings, 7200);</span>

<span class="x">// Use versioned cache keys</span>
<span class="x">$version = Cache::get(&#39;users_version&#39;, 1);</span>
<span class="x">Cache::put(&quot;users.v{$version}.all&quot;, $users, 3600);</span>

<span class="x">// Invalidate by incrementing version</span>
<span class="x">Cache::increment(&#39;users_version&#39;);</span>
</code></pre></div>

<h3 id="cache-size-management">Cache Size Management</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Monitor cache size</span>
<span class="x">$size = Cache::get(&#39;cache_size&#39;, 0);</span>
<span class="x">Cache::put(&#39;cache_size&#39;, $size + 1);</span>

<span class="x">// Implement cache size limits</span>
<span class="x">if ($size &gt; 1000) {</span>
<span class="x">    Cache::flush();</span>
<span class="x">    Cache::put(&#39;cache_size&#39;, 0);</span>
<span class="x">}</span>
</code></pre></div>

<h2 id="monitoring-and-debugging">Monitoring and Debugging</h2>
<h3 id="cache-statistics">Cache Statistics</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Get cache statistics</span>
<span class="x">$stats = Cache::getStats();</span>

<span class="x">// Monitor cache hit rate</span>
<span class="x">$hits = Cache::get(&#39;cache_hits&#39;, 0);</span>
<span class="x">$misses = Cache::get(&#39;cache_misses&#39;, 0);</span>
<span class="x">$hitRate = $hits / ($hits + $misses) * 100;</span>
</code></pre></div>

<h3 id="cache-debugging">Cache Debugging</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Enable cache debugging</span>
<span class="x">if (config(&#39;app.debug&#39;)) {</span>
<span class="x">    Cache::put(&#39;debug_key&#39;, &#39;value&#39;, 60);</span>
<span class="x">    Log::info(&#39;Cache debug: &#39; . Cache::get(&#39;debug_key&#39;));</span>
<span class="x">}</span>
</code></pre></div>

<h2 id="best-practices">Best Practices</h2>
<h3 id="1-choose-appropriate-ttl">1. Choose Appropriate TTL</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Short TTL for frequently changing data</span>
<span class="x">Cache::put(&#39;user_session&#39;, $session, 300); // 5 minutes</span>

<span class="x">// Long TTL for static data</span>
<span class="x">Cache::put(&#39;app_config&#39;, $config, 86400); // 24 hours</span>

<span class="x">// No TTL for rarely changing data</span>
<span class="x">Cache::forever(&#39;app_constants&#39;, $constants);</span>
</code></pre></div>

<h3 id="2-use-cache-tags-wisely">2. Use Cache Tags Wisely</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Group related data</span>
<span class="x">Cache::tags([&#39;users&#39;, &#39;profile&#39;])-&gt;put(&quot;user.{$id}&quot;, $user, 3600);</span>
<span class="x">Cache::tags([&#39;users&#39;, &#39;posts&#39;])-&gt;put(&quot;user.{$id}.posts&quot;, $posts, 1800);</span>

<span class="x">// Flush specific groups</span>
<span class="x">Cache::tags(&#39;users&#39;)-&gt;flush(); // Flushes all user-related cache</span>
</code></pre></div>

<h3 id="3-implement-cache-invalidation">3. Implement Cache Invalidation</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Invalidate cache on model changes</span>
<span class="x">class Post extends Model</span>
<span class="x">{</span>
<span class="x">    protected static function boot()</span>
<span class="x">    {</span>
<span class="x">        parent::boot();</span>

<span class="x">        static::saved(function ($post) {</span>
<span class="x">            Cache::tags([&#39;posts&#39;, &quot;user.{$post-&gt;user_id}&quot;])-&gt;flush();</span>
<span class="x">        });</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="4-monitor-cache-performance">4. Monitor Cache Performance</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Track cache performance</span>
<span class="x">$start = microtime(true);</span>
<span class="x">$data = Cache::get(&#39;key&#39;);</span>
<span class="x">$time = microtime(true) - $start;</span>

<span class="x">if ($time &gt; 0.1) {</span>
<span class="x">    Log::warning(&quot;Slow cache access: {$time}s&quot;);</span>
<span class="x">}</span>
</code></pre></div>

<h2 id="summary">Summary</h2>
<p>Laravel's caching system provides powerful tools for improving application performance:</p>
<ul>
<li><strong>Multiple Cache Drivers</strong>: Choose the right driver for your needs</li>
<li><strong>Cache Tags</strong>: Group and manage related cache items</li>
<li><strong>Model Caching</strong>: Cache database queries and relationships</li>
<li><strong>Route Caching</strong>: Cache routes and configuration</li>
<li><strong>Advanced Patterns</strong>: Implement cache-aside and write-through patterns</li>
<li><strong>Performance Monitoring</strong>: Track and optimize cache usage</li>
</ul>
<p>Understanding and implementing effective caching strategies is crucial for building high-performance Laravel applications.</p></div><div class="chapter" id="14-performance"><h1 id="performance-optimization">Performance Optimization</h1>
<h2 id="overview">Overview</h2>
<p>Performance optimization is crucial for building scalable Laravel applications. This chapter covers various techniques and best practices for improving application performance, from database optimization to application profiling and monitoring.</p>
<h2 id="performance-fundamentals">Performance Fundamentals</h2>
<h3 id="what-affects-performance">What Affects Performance?</h3>
<ol>
<li><strong>Database Queries</strong>: Slow queries, N+1 problems, missing indexes</li>
<li><strong>Memory Usage</strong>: Large datasets, memory leaks, inefficient data structures</li>
<li><strong>CPU Usage</strong>: Complex calculations, inefficient algorithms</li>
<li><strong>Network</strong>: Slow external API calls, large response sizes</li>
<li><strong>Caching</strong>: Missing cache opportunities, inefficient cache strategies</li>
</ol>
<h3 id="performance-metrics">Performance Metrics</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Measure execution time</span>
<span class="x">$start = microtime(true);</span>
<span class="x">// Your code here</span>
<span class="x">$executionTime = microtime(true) - $start;</span>

<span class="x">// Measure memory usage</span>
<span class="x">$memoryUsage = memory_get_usage(true);</span>
<span class="x">$peakMemory = memory_get_peak_usage(true);</span>
</code></pre></div>

<h2 id="database-optimization">Database Optimization</h2>
<h3 id="query-optimization">Query Optimization</h3>
<h4 id="n1-problem">N+1 Problem</h4>
<div class="codehilite"><pre><span></span><code><span class="x">// Bad: N+1 problem</span>
<span class="x">$users = User::all();</span>
<span class="x">foreach ($users as $user) {</span>
<span class="x">    echo $user-&gt;posts-&gt;count(); // Executes N queries</span>
<span class="x">}</span>

<span class="x">// Good: Eager loading</span>
<span class="x">$users = User::with(&#39;posts&#39;)-&gt;get();</span>
<span class="x">foreach ($users as $user) {</span>
<span class="x">    echo $user-&gt;posts-&gt;count(); // No additional queries</span>
<span class="x">}</span>

<span class="x">// Better: Count with relationship</span>
<span class="x">$users = User::withCount(&#39;posts&#39;)-&gt;get();</span>
<span class="x">foreach ($users as $user) {</span>
<span class="x">    echo $user-&gt;posts_count; // Pre-calculated</span>
<span class="x">}</span>
</code></pre></div>

<h4 id="select-specific-columns">Select Specific Columns</h4>
<div class="codehilite"><pre><span></span><code><span class="x">// Bad: Select all columns</span>
<span class="x">$users = User::all();</span>

<span class="x">// Good: Select only needed columns</span>
<span class="x">$users = User::select(&#39;id&#39;, &#39;name&#39;, &#39;email&#39;)-&gt;get();</span>

<span class="x">// Better: Use resource classes</span>
<span class="x">class UserResource extends JsonResource</span>
<span class="x">{</span>
<span class="x">    public function toArray($request)</span>
<span class="x">    {</span>
<span class="x">        return [</span>
<span class="x">            &#39;id&#39; =&gt; $this-&gt;id,</span>
<span class="x">            &#39;name&#39; =&gt; $this-&gt;name,</span>
<span class="x">            &#39;email&#39; =&gt; $this-&gt;email,</span>
<span class="x">        ];</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h4 id="use-database-indexes">Use Database Indexes</h4>
<div class="codehilite"><pre><span></span><code><span class="x">// Migration with indexes</span>
<span class="x">public function up()</span>
<span class="x">{</span>
<span class="x">    Schema::create(&#39;posts&#39;, function (Blueprint $table) {</span>
<span class="x">        $table-&gt;id();</span>
<span class="x">        $table-&gt;foreignId(&#39;user_id&#39;)-&gt;constrained()-&gt;onDelete(&#39;cascade&#39;);</span>
<span class="x">        $table-&gt;string(&#39;title&#39;);</span>
<span class="x">        $table-&gt;text(&#39;content&#39;);</span>
<span class="x">        $table-&gt;string(&#39;slug&#39;)-&gt;unique();</span>
<span class="x">        $table-&gt;boolean(&#39;is_published&#39;)-&gt;default(false);</span>
<span class="x">        $table-&gt;timestamps();</span>

<span class="x">        // Add indexes for frequently queried columns</span>
<span class="x">        $table-&gt;index([&#39;user_id&#39;, &#39;is_published&#39;]);</span>
<span class="x">        $table-&gt;index(&#39;created_at&#39;);</span>
<span class="x">        $table-&gt;fullText([&#39;title&#39;, &#39;content&#39;]);</span>
<span class="x">    });</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="query-scopes">Query Scopes</h3>
<div class="codehilite"><pre><span></span><code><span class="x">class Post extends Model</span>
<span class="x">{</span>
<span class="x">    // Local scopes for common queries</span>
<span class="x">    public function scopePublished($query)</span>
<span class="x">    {</span>
<span class="x">        return $query-&gt;where(&#39;is_published&#39;, true);</span>
<span class="x">    }</span>

<span class="x">    public function scopeByUser($query, $userId)</span>
<span class="x">    {</span>
<span class="x">        return $query-&gt;where(&#39;user_id&#39;, $userId);</span>
<span class="x">    }</span>

<span class="x">    public function scopeRecent($query, $days = 7)</span>
<span class="x">    {</span>
<span class="x">        return $query-&gt;where(&#39;created_at&#39;, &#39;&gt;=&#39;, now()-&gt;subDays($days));</span>
<span class="x">    }</span>

<span class="x">    // Usage</span>
<span class="x">    $posts = Post::published()-&gt;byUser($userId)-&gt;recent(30)-&gt;get();</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="database-connection-optimization">Database Connection Optimization</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// config/database.php</span>
<span class="x">&#39;mysql&#39; =&gt; [</span>
<span class="x">    &#39;driver&#39; =&gt; &#39;mysql&#39;,</span>
<span class="x">    &#39;host&#39; =&gt; env(&#39;DB_HOST&#39;, &#39;127.0.0.1&#39;),</span>
<span class="x">    &#39;port&#39; =&gt; env(&#39;DB_PORT&#39;, &#39;3306&#39;),</span>
<span class="x">    &#39;database&#39; =&gt; env(&#39;DB_DATABASE&#39;, &#39;forge&#39;),</span>
<span class="x">    &#39;username&#39; =&gt; env(&#39;DB_USERNAME&#39;, &#39;forge&#39;),</span>
<span class="x">    &#39;password&#39; =&gt; env(&#39;DB_PASSWORD&#39;, &#39;&#39;),</span>
<span class="x">    &#39;charset&#39; =&gt; &#39;utf8mb4&#39;,</span>
<span class="x">    &#39;collation&#39; =&gt; &#39;utf8mb4_unicode_ci&#39;,</span>
<span class="x">    &#39;prefix&#39; =&gt; &#39;&#39;,</span>
<span class="x">    &#39;strict&#39; =&gt; true,</span>
<span class="x">    &#39;engine&#39; =&gt; null,</span>
<span class="x">    &#39;options&#39; =&gt; extension_loaded(&#39;pdo_mysql&#39;) ? array_filter([</span>
<span class="x">        PDO::MYSQL_ATTR_SSL_CA =&gt; env(&#39;MYSQL_ATTR_SSL_CA&#39;),</span>
<span class="x">        PDO::ATTR_PERSISTENT =&gt; true, // Enable persistent connections</span>
<span class="x">    ]) : [],</span>
<span class="x">],</span>
</code></pre></div>

<h2 id="application-optimization">Application Optimization</h2>
<h3 id="route-caching">Route Caching</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Cache routes for production</span>
php<span class="w"> </span>artisan<span class="w"> </span>route:cache

<span class="c1"># Cache configuration</span>
php<span class="w"> </span>artisan<span class="w"> </span>config:cache

<span class="c1"># Cache views</span>
php<span class="w"> </span>artisan<span class="w"> </span>view:cache

<span class="c1"># Optimize autoloader</span>
composer<span class="w"> </span>install<span class="w"> </span>--optimize-autoloader<span class="w"> </span>--no-dev
</code></pre></div>

<h3 id="service-container-optimization">Service Container Optimization</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Use singleton for expensive services</span>
<span class="x">$this-&gt;app-&gt;singleton(ExpensiveService::class, function ($app) {</span>
<span class="x">    return new ExpensiveService();</span>
<span class="x">});</span>

<span class="x">// Use lazy loading for services</span>
<span class="x">$this-&gt;app-&gt;when(PostController::class)</span>
<span class="x">    -&gt;needs(PostService::class)</span>
<span class="x">    -&gt;give(function () {</span>
<span class="x">        return new PostService();</span>
<span class="x">    });</span>
</code></pre></div>

<h3 id="memory-management">Memory Management</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Use generators for large datasets</span>
<span class="x">function getLargeDataset()</span>
<span class="x">{</span>
<span class="x">    $query = DB::table(&#39;posts&#39;)-&gt;orderBy(&#39;id&#39;);</span>

<span class="x">    foreach ($query-&gt;cursor() as $post) {</span>
<span class="x">        yield $post;</span>
<span class="x">    }</span>
<span class="x">}</span>

<span class="x">// Usage</span>
<span class="x">foreach (getLargeDataset() as $post) {</span>
<span class="x">    // Process each post</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="chunk-processing">Chunk Processing</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Process large datasets in chunks</span>
<span class="x">User::chunk(1000, function ($users) {</span>
<span class="x">    foreach ($users as $user) {</span>
<span class="x">        // Process user</span>
<span class="x">    }</span>
<span class="x">});</span>

<span class="x">// Chunk by ID for better performance</span>
<span class="x">User::where(&#39;id&#39;, &#39;&gt;&#39;, 0)-&gt;chunkById(1000, function ($users) {</span>
<span class="x">    foreach ($users as $user) {</span>
<span class="x">        // Process user</span>
<span class="x">    }</span>
<span class="x">});</span>
</code></pre></div>

<h2 id="caching-strategies">Caching Strategies</h2>
<h3 id="model-caching">Model Caching</h3>
<div class="codehilite"><pre><span></span><code><span class="x">class User extends Model</span>
<span class="x">{</span>
<span class="x">    protected static function boot()</span>
<span class="x">    {</span>
<span class="x">        parent::boot();</span>

<span class="x">        // Cache frequently accessed data</span>
<span class="x">        static::saved(function ($user) {</span>
<span class="x">            Cache::tags(&#39;users&#39;)-&gt;flush();</span>
<span class="x">        });</span>
<span class="x">    }</span>

<span class="x">    public function getCachedPostsAttribute()</span>
<span class="x">    {</span>
<span class="x">        return Cache::remember(&quot;user.{$this-&gt;id}.posts&quot;, 3600, function () {</span>
<span class="x">            return $this-&gt;posts()-&gt;with(&#39;comments&#39;)-&gt;get();</span>
<span class="x">        });</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="query-result-caching">Query Result Caching</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Cache expensive queries</span>
<span class="x">$popularPosts = Cache::remember(&#39;popular_posts&#39;, 3600, function () {</span>
<span class="x">    return Post::with(&#39;user&#39;)</span>
<span class="x">        -&gt;where(&#39;views&#39;, &#39;&gt;&#39;, 1000)</span>
<span class="x">        -&gt;orderBy(&#39;views&#39;, &#39;desc&#39;)</span>
<span class="x">        -&gt;take(10)</span>
<span class="x">        -&gt;get();</span>
<span class="x">});</span>
</code></pre></div>

<h3 id="response-caching">Response Caching</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Cache entire responses</span>
<span class="x">Route::get(&#39;/posts&#39;, function () {</span>
<span class="x">    return Cache::remember(&#39;posts_page&#39;, 1800, function () {</span>
<span class="x">        return view(&#39;posts.index&#39;, [</span>
<span class="x">            &#39;posts&#39; =&gt; Post::with(&#39;user&#39;)-&gt;paginate(20)</span>
<span class="x">        ]);</span>
<span class="x">    });</span>
<span class="x">});</span>
</code></pre></div>

<h2 id="profiling-and-monitoring">Profiling and Monitoring</h2>
<h3 id="laravel-telescope">Laravel Telescope</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Install Laravel Telescope</span>
composer<span class="w"> </span>require<span class="w"> </span>laravel/telescope<span class="w"> </span>--dev

<span class="c1"># Publish configuration</span>
php<span class="w"> </span>artisan<span class="w"> </span>telescope:install

<span class="c1"># Access dashboard at /telescope</span>
</code></pre></div>

<h3 id="query-logging">Query Logging</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Enable query logging</span>
<span class="x">DB::enableQueryLog();</span>

<span class="x">// Your code here</span>
<span class="x">$users = User::with(&#39;posts&#39;)-&gt;get();</span>

<span class="x">// Get executed queries</span>
<span class="x">$queries = DB::getQueryLog();</span>

<span class="x">// Log slow queries</span>
<span class="x">DB::listen(function ($query) {</span>
<span class="x">    if ($query-&gt;time &gt; 100) {</span>
<span class="x">        Log::warning(&#39;Slow query detected&#39;, [</span>
<span class="x">            &#39;sql&#39; =&gt; $query-&gt;sql,</span>
<span class="x">            &#39;time&#39; =&gt; $query-&gt;time,</span>
<span class="x">            &#39;bindings&#39; =&gt; $query-&gt;bindings,</span>
<span class="x">        ]);</span>
<span class="x">    }</span>
<span class="x">});</span>
</code></pre></div>

<h3 id="performance-monitoring">Performance Monitoring</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Custom performance monitoring</span>
<span class="x">class PerformanceMonitor</span>
<span class="x">{</span>
<span class="x">    public static function measure($name, callable $callback)</span>
<span class="x">    {</span>
<span class="x">        $start = microtime(true);</span>
<span class="x">        $startMemory = memory_get_usage();</span>

<span class="x">        $result = $callback();</span>

<span class="x">        $executionTime = microtime(true) - $start;</span>
<span class="x">        $memoryUsed = memory_get_usage() - $startMemory;</span>

<span class="x">        Log::info(&quot;Performance: {$name}&quot;, [</span>
<span class="x">            &#39;execution_time&#39; =&gt; $executionTime,</span>
<span class="x">            &#39;memory_used&#39; =&gt; $memoryUsed,</span>
<span class="x">        ]);</span>

<span class="x">        return $result;</span>
<span class="x">    }</span>
<span class="x">}</span>

<span class="x">// Usage</span>
<span class="x">$users = PerformanceMonitor::measure(&#39;get_users&#39;, function () {</span>
<span class="x">    return User::with(&#39;posts&#39;)-&gt;get();</span>
<span class="x">});</span>
</code></pre></div>

<h2 id="frontend-optimization">Frontend Optimization</h2>
<h3 id="asset-optimization">Asset Optimization</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Mix configuration for asset optimization</span>
<span class="x">// webpack.mix.js</span>
<span class="x">const mix = require(&#39;laravel-mix&#39;);</span>

<span class="x">mix.js(&#39;resources/js/app.js&#39;, &#39;public/js&#39;)</span>
<span class="x">   .sass(&#39;resources/sass/app.scss&#39;, &#39;public/css&#39;)</span>
<span class="x">   .version() // Add versioning for cache busting</span>
<span class="x">   .sourceMaps() // Enable source maps for debugging</span>
<span class="x">   .minify() // Minify assets</span>
<span class="x">   .extract([&#39;vue&#39;, &#39;axios&#39;]); // Extract vendor libraries</span>
</code></pre></div>

<h3 id="blade-optimization">Blade Optimization</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Use @include instead of @component for simple includes</span>
<span class="x">@include(&#39;components.alert&#39;, [&#39;type&#39; =&gt; &#39;success&#39;])</span>

<span class="x">// Cache expensive blade operations</span>
<span class="x">@cache(&#39;expensive_calculation&#39;, 3600)</span>
<span class="x">    @php</span>
<span class="x">        $result = expensiveCalculation();</span>
<span class="x">    @endphp</span>
<span class="x">    {{ $result }}</span>
<span class="x">@endcache</span>
</code></pre></div>

<h3 id="response-optimization">Response Optimization</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Compress responses</span>
<span class="x">Route::get(&#39;/api/posts&#39;, function () {</span>
<span class="x">    return response()-&gt;json(Post::all())</span>
<span class="x">        -&gt;header(&#39;Content-Encoding&#39;, &#39;gzip&#39;);</span>
<span class="x">});</span>

<span class="x">// Use JSON resources for consistent API responses</span>
<span class="x">class PostResource extends JsonResource</span>
<span class="x">{</span>
<span class="x">    public function toArray($request)</span>
<span class="x">    {</span>
<span class="x">        return [</span>
<span class="x">            &#39;id&#39; =&gt; $this-&gt;id,</span>
<span class="x">            &#39;title&#39; =&gt; $this-&gt;title,</span>
<span class="x">            &#39;content&#39; =&gt; $this-&gt;when($request-&gt;show_content, $this-&gt;content),</span>
<span class="x">            &#39;user&#39; =&gt; new UserResource($this-&gt;whenLoaded(&#39;user&#39;)),</span>
<span class="x">        ];</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h2 id="queue-optimization">Queue Optimization</h2>
<h3 id="job-optimization">Job Optimization</h3>
<div class="codehilite"><pre><span></span><code><span class="x">class ProcessLargeDataset implements ShouldQueue</span>
<span class="x">{</span>
<span class="x">    use Dispatchable, InteractsWithQueue, Queueable, SerializesModels;</span>

<span class="x">    public $timeout = 300; // 5 minutes</span>
<span class="x">    public $tries = 3;</span>
<span class="x">    public $maxExceptions = 1;</span>

<span class="x">    public function handle()</span>
<span class="x">    {</span>
<span class="x">        // Process in chunks to avoid memory issues</span>
<span class="x">        User::chunk(1000, function ($users) {</span>
<span class="x">            foreach ($users as $user) {</span>
<span class="x">                ProcessUser::dispatch($user);</span>
<span class="x">            }</span>
<span class="x">        });</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="queue-configuration">Queue Configuration</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// config/queue.php</span>
<span class="x">&#39;connections&#39; =&gt; [</span>
<span class="x">    &#39;redis&#39; =&gt; [</span>
<span class="x">        &#39;driver&#39; =&gt; &#39;redis&#39;,</span>
<span class="x">        &#39;connection&#39; =&gt; &#39;default&#39;,</span>
<span class="x">        &#39;queue&#39; =&gt; env(&#39;REDIS_QUEUE&#39;, &#39;default&#39;),</span>
<span class="x">        &#39;retry_after&#39; =&gt; 90,</span>
<span class="x">        &#39;block_for&#39; =&gt; null,</span>
<span class="x">    ],</span>
<span class="x">],</span>

<span class="x">// Use multiple queues for different priorities</span>
<span class="x">ProcessUser::dispatch($user)-&gt;onQueue(&#39;high&#39;);</span>
<span class="x">ProcessUser::dispatch($user)-&gt;onQueue(&#39;low&#39;);</span>
</code></pre></div>

<h2 id="server-optimization">Server Optimization</h2>
<h3 id="php-configuration">PHP Configuration</h3>
<div class="codehilite"><pre><span></span><code><span class="c1">; php.ini optimizations</span>
<span class="na">memory_limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">512M</span>
<span class="na">max_execution_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">300</span>
<span class="na">opcache.enable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1</span>
<span class="na">opcache.memory_consumption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">128</span>
<span class="na">opcache.interned_strings_buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">8</span>
<span class="na">opcache.max_accelerated_files</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">4000</span>
<span class="na">opcache.revalidate_freq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">2</span>
<span class="na">opcache.fast_shutdown</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1</span>
</code></pre></div>

<h3 id="web-server-configuration">Web Server Configuration</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Nginx configuration for Laravel</span>
<span class="k">server</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">listen</span><span class="w"> </span><span class="mi">80</span><span class="p">;</span>
<span class="w">    </span><span class="kn">server_name</span><span class="w"> </span><span class="s">yourdomain.com</span><span class="p">;</span>
<span class="w">    </span><span class="kn">root</span><span class="w"> </span><span class="s">/var/www/your-app/public</span><span class="p">;</span>

<span class="w">    </span><span class="c1"># Enable gzip compression</span>
<span class="w">    </span><span class="kn">gzip</span><span class="w"> </span><span class="no">on</span><span class="p">;</span>
<span class="w">    </span><span class="kn">gzip_vary</span><span class="w"> </span><span class="no">on</span><span class="p">;</span>
<span class="w">    </span><span class="kn">gzip_min_length</span><span class="w"> </span><span class="mi">1024</span><span class="p">;</span>
<span class="w">    </span><span class="kn">gzip_types</span><span class="w"> </span><span class="s">text/plain</span><span class="w"> </span><span class="s">text/css</span><span class="w"> </span><span class="s">text/xml</span><span class="w"> </span><span class="s">text/javascript</span><span class="w"> </span><span class="s">application/javascript</span><span class="w"> </span><span class="s">application/xml+rss</span><span class="w"> </span><span class="s">application/json</span><span class="p">;</span>

<span class="w">    </span><span class="c1"># Cache static files</span>
<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="p">~</span><span class="sr">*</span><span class="w"> </span><span class="s">\.(jpg|jpeg|png|gif|ico|css|js)</span>$<span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">expires</span><span class="w"> </span><span class="s">1y</span><span class="p">;</span>
<span class="w">        </span><span class="kn">add_header</span><span class="w"> </span><span class="s">Cache-Control</span><span class="w"> </span><span class="s">&quot;public,</span><span class="w"> </span><span class="s">immutable&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1"># Laravel routing</span>
<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">try_files</span><span class="w"> </span><span class="nv">$uri</span><span class="w"> </span><span class="nv">$uri/</span><span class="w"> </span><span class="s">/index.php?</span><span class="nv">$query_string</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1"># PHP processing</span>
<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="p">~</span><span class="w"> </span><span class="sr">\.php$</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kn">fastcgi_pass</span><span class="w"> </span><span class="s">unix:/var/run/php/php8.1-fpm.sock</span><span class="p">;</span>
<span class="w">        </span><span class="kn">fastcgi_index</span><span class="w"> </span><span class="s">index.php</span><span class="p">;</span>
<span class="w">        </span><span class="kn">fastcgi_param</span><span class="w"> </span><span class="s">SCRIPT_FILENAME</span><span class="w"> </span><span class="nv">$realpath_root$fastcgi_script_name</span><span class="p">;</span>
<span class="w">        </span><span class="kn">include</span><span class="w"> </span><span class="s">fastcgi_params</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="performance-testing">Performance Testing</h2>
<h3 id="load-testing">Load Testing</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Simple load testing</span>
<span class="x">class LoadTest</span>
<span class="x">{</span>
<span class="x">    public static function test($url, $requests = 100, $concurrency = 10)</span>
<span class="x">    {</span>
<span class="x">        $start = microtime(true);</span>
<span class="x">        $successful = 0;</span>
<span class="x">        $failed = 0;</span>

<span class="x">        for ($i = 0; $i &lt; $requests; $i++) {</span>
<span class="x">            try {</span>
<span class="x">                $response = Http::get($url);</span>
<span class="x">                if ($response-&gt;successful()) {</span>
<span class="x">                    $successful++;</span>
<span class="x">                } else {</span>
<span class="x">                    $failed++;</span>
<span class="x">                }</span>
<span class="x">            } catch (Exception $e) {</span>
<span class="x">                $failed++;</span>
<span class="x">            }</span>
<span class="x">        }</span>

<span class="x">        $duration = microtime(true) - $start;</span>
<span class="x">        $rps = $requests / $duration;</span>

<span class="x">        return [</span>
<span class="x">            &#39;requests&#39; =&gt; $requests,</span>
<span class="x">            &#39;successful&#39; =&gt; $successful,</span>
<span class="x">            &#39;failed&#39; =&gt; $failed,</span>
<span class="x">            &#39;duration&#39; =&gt; $duration,</span>
<span class="x">            &#39;requests_per_second&#39; =&gt; $rps,</span>
<span class="x">        ];</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="benchmark-testing">Benchmark Testing</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Benchmark different approaches</span>
<span class="x">class BenchmarkTest</span>
<span class="x">{</span>
<span class="x">    public static function compare($name, array $tests)</span>
<span class="x">    {</span>
<span class="x">        $results = [];</span>

<span class="x">        foreach ($tests as $testName =&gt; $test) {</span>
<span class="x">            $start = microtime(true);</span>
<span class="x">            $startMemory = memory_get_usage();</span>

<span class="x">            $result = $test();</span>

<span class="x">            $executionTime = microtime(true) - $start;</span>
<span class="x">            $memoryUsed = memory_get_usage() - $startMemory;</span>

<span class="x">            $results[$testName] = [</span>
<span class="x">                &#39;execution_time&#39; =&gt; $executionTime,</span>
<span class="x">                &#39;memory_used&#39; =&gt; $memoryUsed,</span>
<span class="x">                &#39;result&#39; =&gt; $result,</span>
<span class="x">            ];</span>
<span class="x">        }</span>

<span class="x">        Log::info(&quot;Benchmark: {$name}&quot;, $results);</span>

<span class="x">        return $results;</span>
<span class="x">    }</span>
<span class="x">}</span>

<span class="x">// Usage</span>
<span class="x">BenchmarkTest::compare(&#39;User Queries&#39;, [</span>
<span class="x">    &#39;eager_loading&#39; =&gt; function () {</span>
<span class="x">        return User::with(&#39;posts&#39;)-&gt;get();</span>
<span class="x">    },</span>
<span class="x">    &#39;lazy_loading&#39; =&gt; function () {</span>
<span class="x">        return User::all();</span>
<span class="x">    },</span>
<span class="x">]);</span>
</code></pre></div>

<h2 id="best-practices">Best Practices</h2>
<h3 id="1-database-best-practices">1. Database Best Practices</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Use database transactions</span>
<span class="x">DB::transaction(function () {</span>
<span class="x">    $user = User::create($data);</span>
<span class="x">    $user-&gt;profile()-&gt;create($profileData);</span>
<span class="x">});</span>

<span class="x">// Use database indexes</span>
<span class="x">Schema::table(&#39;posts&#39;, function (Blueprint $table) {</span>
<span class="x">    $table-&gt;index([&#39;user_id&#39;, &#39;created_at&#39;]);</span>
<span class="x">});</span>

<span class="x">// Use database constraints</span>
<span class="x">Schema::table(&#39;posts&#39;, function (Blueprint $table) {</span>
<span class="x">    $table-&gt;foreign(&#39;user_id&#39;)-&gt;references(&#39;id&#39;)-&gt;on(&#39;users&#39;)-&gt;onDelete(&#39;cascade&#39;);</span>
<span class="x">});</span>
</code></pre></div>

<h3 id="2-code-best-practices">2. Code Best Practices</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Use lazy loading for expensive operations</span>
<span class="x">class User extends Model</span>
<span class="x">{</span>
<span class="x">    public function getExpensiveDataAttribute()</span>
<span class="x">    {</span>
<span class="x">        return $this-&gt;remember(&#39;expensive_data&#39;, 3600, function () {</span>
<span class="x">            return $this-&gt;calculateExpensiveData();</span>
<span class="x">        });</span>
<span class="x">    }</span>
<span class="x">}</span>

<span class="x">// Use collections efficiently</span>
<span class="x">$users = User::all();</span>
<span class="x">$activeUsers = $users-&gt;filter-&gt;isActive();</span>
<span class="x">$userNames = $users-&gt;pluck(&#39;name&#39;);</span>
</code></pre></div>

<h3 id="3-caching-best-practices">3. Caching Best Practices</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Use appropriate cache keys</span>
<span class="x">Cache::put(&quot;user.{$user-&gt;id}.profile&quot;, $profile, 3600);</span>
<span class="x">Cache::put(&quot;user.{$user-&gt;id}.posts&quot;, $posts, 1800);</span>

<span class="x">// Use cache tags for related data</span>
<span class="x">Cache::tags([&#39;users&#39;, &#39;posts&#39;])-&gt;put(&quot;user.{$user-&gt;id}&quot;, $user, 3600);</span>

<span class="x">// Implement cache warming</span>
<span class="x">class CacheWarming</span>
<span class="x">{</span>
<span class="x">    public function warm()</span>
<span class="x">    {</span>
<span class="x">        Cache::remember(&#39;popular_posts&#39;, 3600, function () {</span>
<span class="x">            return Post::popular()-&gt;take(10)-&gt;get();</span>
<span class="x">        });</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h2 id="summary">Summary</h2>
<p>Performance optimization in Laravel involves multiple aspects:</p>
<ul>
<li><strong>Database Optimization</strong>: Query optimization, indexing, eager loading</li>
<li><strong>Application Optimization</strong>: Caching, memory management, code efficiency</li>
<li><strong>Server Optimization</strong>: PHP configuration, web server settings</li>
<li><strong>Monitoring</strong>: Profiling, benchmarking, performance testing</li>
<li><strong>Best Practices</strong>: Following established patterns and guidelines</li>
</ul>
<p>By implementing these optimization techniques, you can significantly improve your Laravel application's performance and scalability.</p></div><div class="chapter" id="15-microservices"><h1 id="microservices">Microservices</h1>
<h2 id="overview">Overview</h2>
<p>Microservices architecture involves breaking down a monolithic application into smaller, independent services. This chapter covers building microservices with Laravel, including service design, communication patterns, and deployment strategies.</p>
<h2 id="what-are-microservices">What are Microservices?</h2>
<p>Microservices are small, autonomous services that work together to form a larger application. Each service:
- Has its own database
- Can be developed, deployed, and scaled independently
- Communicates with other services via APIs
- Has a single responsibility</p>
<h2 id="service-design-principles">Service Design Principles</h2>
<h3 id="1-single-responsibility">1. Single Responsibility</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// User Service - handles user management only</span>
<span class="x">class UserService</span>
<span class="x">{</span>
<span class="x">    public function createUser($data)</span>
<span class="x">    {</span>
<span class="x">        return User::create($data);</span>
<span class="x">    }</span>

<span class="x">    public function updateUser($id, $data)</span>
<span class="x">    {</span>
<span class="x">        return User::findOrFail($id)-&gt;update($data);</span>
<span class="x">    }</span>
<span class="x">}</span>

<span class="x">// Post Service - handles posts only</span>
<span class="x">class PostService</span>
<span class="x">{</span>
<span class="x">    public function createPost($data)</span>
<span class="x">    {</span>
<span class="x">        return Post::create($data);</span>
<span class="x">    }</span>

<span class="x">    public function getPostsByUser($userId)</span>
<span class="x">    {</span>
<span class="x">        return Post::where(&#39;user_id&#39;, $userId)-&gt;get();</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="2-service-independence">2. Service Independence</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Each service has its own database</span>
<span class="x">// User Service Database</span>
<span class="x">Schema::create(&#39;users&#39;, function (Blueprint $table) {</span>
<span class="x">    $table-&gt;id();</span>
<span class="x">    $table-&gt;string(&#39;name&#39;);</span>
<span class="x">    $table-&gt;string(&#39;email&#39;)-&gt;unique();</span>
<span class="x">    $table-&gt;timestamps();</span>
<span class="x">});</span>

<span class="x">// Post Service Database</span>
<span class="x">Schema::create(&#39;posts&#39;, function (Blueprint $table) {</span>
<span class="x">    $table-&gt;id();</span>
<span class="x">    $table-&gt;string(&#39;title&#39;);</span>
<span class="x">    $table-&gt;text(&#39;content&#39;);</span>
<span class="x">    $table-&gt;unsignedBigInteger(&#39;user_id&#39;);</span>
<span class="x">    $table-&gt;timestamps();</span>
<span class="x">});</span>
</code></pre></div>

<h2 id="service-communication">Service Communication</h2>
<h3 id="1-synchronous-communication-httprest">1. Synchronous Communication (HTTP/REST)</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Service-to-service communication</span>
<span class="x">class PostService</span>
<span class="x">{</span>
<span class="x">    protected $userServiceUrl;</span>

<span class="x">    public function __construct()</span>
<span class="x">    {</span>
<span class="x">        $this-&gt;userServiceUrl = config(&#39;services.user_service.url&#39;);</span>
<span class="x">    }</span>

<span class="x">    public function createPost($data)</span>
<span class="x">    {</span>
<span class="x">        // Verify user exists before creating post</span>
<span class="x">        $user = Http::get(&quot;{$this-&gt;userServiceUrl}/api/v1/users/{$data[&#39;user_id&#39;]}&quot;);</span>

<span class="x">        if (!$user-&gt;successful()) {</span>
<span class="x">            throw new UserNotFoundException();</span>
<span class="x">        }</span>

<span class="x">        return Post::create($data);</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="2-asynchronous-communication-eventsqueues">2. Asynchronous Communication (Events/Queues)</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// User Service - Publish events</span>
<span class="x">class UserCreated</span>
<span class="x">{</span>
<span class="x">    use Dispatchable, InteractsWithQueue, Queueable, SerializesModels;</span>

<span class="x">    public $user;</span>

<span class="x">    public function __construct($user)</span>
<span class="x">    {</span>
<span class="x">        $this-&gt;user = $user;</span>
<span class="x">    }</span>
<span class="x">}</span>

<span class="x">// Post Service - Listen to events</span>
<span class="x">class UserCreatedListener</span>
<span class="x">{</span>
<span class="x">    public function handle(UserCreated $event)</span>
<span class="x">    {</span>
<span class="x">        UserProfile::create([</span>
<span class="x">            &#39;user_id&#39; =&gt; $event-&gt;user[&#39;id&#39;],</span>
<span class="x">            &#39;name&#39; =&gt; $event-&gt;user[&#39;name&#39;],</span>
<span class="x">            &#39;email&#39; =&gt; $event-&gt;user[&#39;email&#39;],</span>
<span class="x">        ]);</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h2 id="api-gateway">API Gateway</h2>
<h3 id="basic-api-gateway">Basic API Gateway</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// API Gateway Service</span>
<span class="x">class ApiGateway</span>
<span class="x">{</span>
<span class="x">    protected $services = [</span>
<span class="x">        &#39;users&#39; =&gt; &#39;http://user-service:8000&#39;,</span>
<span class="x">        &#39;posts&#39; =&gt; &#39;http://post-service:8001&#39;,</span>
<span class="x">        &#39;comments&#39; =&gt; &#39;http://comment-service:8002&#39;,</span>
<span class="x">    ];</span>

<span class="x">    public function route($service, $path, $method = &#39;GET&#39;, $data = null)</span>
<span class="x">    {</span>
<span class="x">        $url = $this-&gt;services[$service] . $path;</span>

<span class="x">        $response = Http::withHeaders([</span>
<span class="x">            &#39;Authorization&#39; =&gt; request()-&gt;header(&#39;Authorization&#39;),</span>
<span class="x">            &#39;Content-Type&#39; =&gt; &#39;application/json&#39;,</span>
<span class="x">        ])-&gt;$method($url, $data);</span>

<span class="x">        return $response-&gt;json();</span>
<span class="x">    }</span>
<span class="x">}</span>

<span class="x">// Gateway Routes</span>
<span class="x">Route::prefix(&#39;api/v1&#39;)-&gt;group(function () {</span>
<span class="x">    Route::get(&#39;users&#39;, function () {</span>
<span class="x">        return app(ApiGateway::class)-&gt;route(&#39;users&#39;, &#39;/api/v1/users&#39;);</span>
<span class="x">    });</span>

<span class="x">    Route::get(&#39;posts&#39;, function () {</span>
<span class="x">        return app(ApiGateway::class)-&gt;route(&#39;posts&#39;, &#39;/api/v1/posts&#39;);</span>
<span class="x">    });</span>
<span class="x">});</span>
</code></pre></div>

<h2 id="circuit-breaker-pattern">Circuit Breaker Pattern</h2>
<div class="codehilite"><pre><span></span><code><span class="x">class CircuitBreaker</span>
<span class="x">{</span>
<span class="x">    protected $failures = 0;</span>
<span class="x">    protected $threshold = 5;</span>
<span class="x">    protected $timeout = 60;</span>
<span class="x">    protected $state = &#39;CLOSED&#39;;</span>

<span class="x">    public function call($callback)</span>
<span class="x">    {</span>
<span class="x">        if ($this-&gt;state === &#39;OPEN&#39;) {</span>
<span class="x">            throw new CircuitBreakerOpenException();</span>
<span class="x">        }</span>

<span class="x">        try {</span>
<span class="x">            $result = $callback();</span>
<span class="x">            $this-&gt;onSuccess();</span>
<span class="x">            return $result;</span>
<span class="x">        } catch (Exception $e) {</span>
<span class="x">            $this-&gt;onFailure();</span>
<span class="x">            throw $e;</span>
<span class="x">        }</span>
<span class="x">    }</span>

<span class="x">    private function onSuccess()</span>
<span class="x">    {</span>
<span class="x">        $this-&gt;failures = 0;</span>
<span class="x">        $this-&gt;state = &#39;CLOSED&#39;;</span>
<span class="x">    }</span>

<span class="x">    private function onFailure()</span>
<span class="x">    {</span>
<span class="x">        $this-&gt;failures++;</span>
<span class="x">        if ($this-&gt;failures &gt;= $this-&gt;threshold) {</span>
<span class="x">            $this-&gt;state = &#39;OPEN&#39;;</span>
<span class="x">        }</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h2 id="service-discovery">Service Discovery</h2>
<div class="codehilite"><pre><span></span><code><span class="x">// Service Registry</span>
<span class="x">class ServiceRegistry</span>
<span class="x">{</span>
<span class="x">    protected $services = [];</span>

<span class="x">    public function register($name, $url)</span>
<span class="x">    {</span>
<span class="x">        $this-&gt;services[$name] = [</span>
<span class="x">            &#39;url&#39; =&gt; $url,</span>
<span class="x">            &#39;registered_at&#39; =&gt; now(),</span>
<span class="x">        ];</span>
<span class="x">    }</span>

<span class="x">    public function get($name)</span>
<span class="x">    {</span>
<span class="x">        return $this-&gt;services[$name] ?? null;</span>
<span class="x">    }</span>
<span class="x">}</span>

<span class="x">// Service Registration</span>
<span class="x">Route::post(&#39;/register&#39;, function (Request $request) {</span>
<span class="x">    app(ServiceRegistry::class)-&gt;register(</span>
<span class="x">        $request-&gt;name,</span>
<span class="x">        $request-&gt;url</span>
<span class="x">    );</span>

<span class="x">    return response()-&gt;json([&#39;status&#39; =&gt; &#39;registered&#39;]);</span>
<span class="x">});</span>
</code></pre></div>

<h2 id="deployment-with-docker">Deployment with Docker</h2>
<div class="codehilite"><pre><span></span><code><span class="c1"># docker-compose.yml</span>
<span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">api-gateway</span><span class="p">:</span>
<span class="w">    </span><span class="nt">build</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./api-gateway</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8000:8000&quot;</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user-service</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">post-service</span>

<span class="w">  </span><span class="nt">user-service</span><span class="p">:</span>
<span class="w">    </span><span class="nt">build</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./user-service</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8001:8000&quot;</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DB_HOST=user-db</span>

<span class="w">  </span><span class="nt">post-service</span><span class="p">:</span>
<span class="w">    </span><span class="nt">build</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./post-service</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8002:8000&quot;</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DB_HOST=post-db</span>

<span class="w">  </span><span class="nt">user-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql:8.0</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">MYSQL_DATABASE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user_service</span>

<span class="w">  </span><span class="nt">post-db</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql:8.0</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">MYSQL_DATABASE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">post_service</span>
</code></pre></div>

<h2 id="monitoring-and-observability">Monitoring and Observability</h2>
<h3 id="health-checks">Health Checks</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Health check endpoint for each service</span>
<span class="x">Route::get(&#39;/health&#39;, function () {</span>
<span class="x">    return response()-&gt;json([</span>
<span class="x">        &#39;status&#39; =&gt; &#39;healthy&#39;,</span>
<span class="x">        &#39;timestamp&#39; =&gt; now(),</span>
<span class="x">        &#39;service&#39; =&gt; config(&#39;app.name&#39;),</span>
<span class="x">        &#39;version&#39; =&gt; config(&#39;app.version&#39;),</span>
<span class="x">    ]);</span>
<span class="x">});</span>
</code></pre></div>

<h3 id="service-metrics">Service Metrics</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Prometheus metrics</span>
<span class="x">class MetricsMiddleware</span>
<span class="x">{</span>
<span class="x">    public function handle($request, Closure $next)</span>
<span class="x">    {</span>
<span class="x">        $start = microtime(true);</span>

<span class="x">        $response = $next($request);</span>

<span class="x">        $duration = microtime(true) - $start;</span>

<span class="x">        // Record metrics</span>
<span class="x">        Log::info(&#39;request_metrics&#39;, [</span>
<span class="x">            &#39;method&#39; =&gt; $request-&gt;method(),</span>
<span class="x">            &#39;url&#39; =&gt; $request-&gt;url(),</span>
<span class="x">            &#39;duration&#39; =&gt; $duration,</span>
<span class="x">            &#39;status&#39; =&gt; $response-&gt;getStatusCode(),</span>
<span class="x">        ]);</span>

<span class="x">        return $response;</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h2 id="best-practices">Best Practices</h2>
<h3 id="1-service-design">1. Service Design</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Keep services small and focused</span>
<span class="x">class UserService</span>
<span class="x">{</span>
<span class="x">    // Only user-related operations</span>
<span class="x">    public function createUser($data) { }</span>
<span class="x">    public function updateUser($id, $data) { }</span>
<span class="x">    public function deleteUser($id) { }</span>
<span class="x">    public function getUser($id) { }</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="2-api-design">2. API Design</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Use consistent API patterns</span>
<span class="x">Route::prefix(&#39;api/v1&#39;)-&gt;group(function () {</span>
<span class="x">    Route::apiResource(&#39;users&#39;, UserController::class);</span>
<span class="x">    Route::get(&#39;users/{user}/profile&#39;, [UserController::class, &#39;profile&#39;]);</span>
<span class="x">});</span>
</code></pre></div>

<h3 id="3-error-handling">3. Error Handling</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Implement proper error handling</span>
<span class="x">class ServiceException extends Exception</span>
<span class="x">{</span>
<span class="x">    protected $service;</span>
<span class="x">    protected $statusCode;</span>

<span class="x">    public function __construct($message, $service, $statusCode = 500)</span>
<span class="x">    {</span>
<span class="x">        parent::__construct($message);</span>
<span class="x">        $this-&gt;service = $service;</span>
<span class="x">        $this-&gt;statusCode = $statusCode;</span>
<span class="x">    }</span>
<span class="x">}</span>

<span class="x">// Handle service failures gracefully</span>
<span class="x">try {</span>
<span class="x">    $user = $userService-&gt;getUser($id);</span>
<span class="x">} catch (ServiceException $e) {</span>
<span class="x">    return $this-&gt;getFallbackUser($id);</span>
<span class="x">}</span>
</code></pre></div>

<h3 id="4-security">4. Security</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Implement service-to-service authentication</span>
<span class="x">class ServiceAuthMiddleware</span>
<span class="x">{</span>
<span class="x">    public function handle($request, Closure $next)</span>
<span class="x">    {</span>
<span class="x">        $token = $request-&gt;header(&#39;X-Service-Token&#39;);</span>

<span class="x">        if (!$this-&gt;validateServiceToken($token)) {</span>
<span class="x">            return response()-&gt;json([&#39;error&#39; =&gt; &#39;Unauthorized&#39;], 401);</span>
<span class="x">        }</span>

<span class="x">        return $next($request);</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h2 id="data-consistency">Data Consistency</h2>
<h3 id="saga-pattern">Saga Pattern</h3>
<div class="codehilite"><pre><span></span><code><span class="x">// Saga Coordinator for distributed transactions</span>
<span class="x">class CreateUserSaga</span>
<span class="x">{</span>
<span class="x">    public function execute($userData)</span>
<span class="x">    {</span>
<span class="x">        try {</span>
<span class="x">            // Step 1: Create user</span>
<span class="x">            $user = $this-&gt;createUser($userData);</span>

<span class="x">            // Step 2: Create user profile</span>
<span class="x">            $profile = $this-&gt;createProfile($user);</span>

<span class="x">            // Step 3: Send welcome email</span>
<span class="x">            $this-&gt;sendWelcomeEmail($user);</span>

<span class="x">            return $user;</span>
<span class="x">        } catch (Exception $e) {</span>
<span class="x">            // Compensate for failures</span>
<span class="x">            $this-&gt;compensate($user);</span>
<span class="x">            throw $e;</span>
<span class="x">        }</span>
<span class="x">    }</span>

<span class="x">    private function compensate($user)</span>
<span class="x">    {</span>
<span class="x">        if ($user) {</span>
<span class="x">            $this-&gt;deleteUser($user);</span>
<span class="x">        }</span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>

<h2 id="summary">Summary</h2>
<p>Building microservices with Laravel involves:</p>
<ul>
<li><strong>Service Design</strong>: Breaking down applications into focused services</li>
<li><strong>Communication</strong>: Implementing service-to-service communication patterns</li>
<li><strong>API Gateway</strong>: Centralizing API management and routing</li>
<li><strong>Service Discovery</strong>: Managing service registration and discovery</li>
<li><strong>Circuit Breaker</strong>: Handling service failures gracefully</li>
<li><strong>Deployment</strong>: Using containerization and orchestration</li>
<li><strong>Monitoring</strong>: Implementing observability and health checks</li>
</ul>
<p>Microservices offer scalability and flexibility but require careful design and management to be successful.</p></div>
        </body>
        </html>
        